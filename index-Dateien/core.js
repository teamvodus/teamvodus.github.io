define("core/utils/addComponentPlugins/plugins/page",["lodash","constants","util"],function(t,e,i){"use strict";function n(e,i,n){t.forEach(n,function(n){var o=function(e,i,n){var o=i;return t.forEach(n,function(t){var i=e.components.getChildren(o);o=i[t]}),o}(e,i,n.pathToParent),r=e.theme.styles.createItem(n.style),s=e.documentServices.tpa.widget.add(n.appDefinitionId,{widgetId:n.widgetId,pageId:i.id,parentContainerRef:o,layout:n.layout,styleId:r});t.forOwn(n.data,function(t,i){e.documentServices.tpa.data.set(s,i,t)})})}function o(t,i,n,o){t.history.add("adding new popup",{actionType:e.DS_ACTIONS.ADD_PAGE,nextPage:i.id,currentPage:n}),t.documentServices.waitForChangesApplied(function(){var e=t.pages.popupPages.getPopupContainer(i.id);t.selection.selectComponentByCompRef(e),o(e)})}return function(e,r,s,a,u,c){if(a.data.isPopup){a.layout.x=0,a.layout.y=0,a.data.pageUriSEO=null;var l=t.omit(a,"tpaComps"),p=e.pages.popupPages.add(i.translate(l.data.title),l),d=e.documentServices.pages.getFocusedPageId();return e.pages.navigateTo(p.id),a.tpaComps?e.documentServices.waitForChangesApplied(function(){n(e,p,a.tpaComps),o(e,p,d,c)}):o(e,p,d,c),p}return null}}),define("core/utils/addComponentPlugins/plugins/anchor",["lodash","util"],function(t,e){"use strict";function i(e,i,n){var o=void 0,r=function(e,i,n){var o=new RegExp(n+"\\s(\\d+)"),r=[];return t.forEach(i,function(t){var i=e.components.data.get(t).name.match(o);i&&r.push(parseInt(i[1],10))}),r}(e,i,n);for(r.sort(function(t,e){return t-e}),o=0;o<r.length;++o)if(!t.includes(r,o+1))return o+1;return o+1}return function(t,n,o,r,s,a){var u=e.translate("component_label_anchor"),c=t.documentServices.pages.getReference(t.documentServices.pages.getPrimaryPageId()),l=i(t,t.components.get.byType("wysiwyg.common.components.anchor.viewer.Anchor",c),u);r.data.name=u+" "+l;var p=n(o,r);return a&&t.documentServices.waitForChangesApplied(function(){a(p)}),p}}),define("core/utils/updateDataPlugins/plugins/imageData",["util"],function(t){"use strict";return function(e){return e.title&&(e.title=t.media.fixMediaTitleLength(e.title,100)),e.description&&(e.description=t.media.fixMediaTitleLength(e.description,1200)),e}}),define("core/utils/updateDataPlugins/plugins/vectorImageData",["util"],function(t){"use strict";return function(e){return e.title&&(e.title=t.media.fixMediaTitleLength(e.title,100)),e}}),define("core/utils/updateDataPlugins/plugins/wixVideoData",["util"],function(t){"use strict";return function(e){return e.title&&(e.title=t.media.fixMediaTitleLength(e.title,100)),e}}),define("core/utils/updateDataPlugins/updateDataPlugins",["core/utils/updateDataPlugins/plugins/imageData","core/utils/updateDataPlugins/plugins/vectorImageData","core/utils/updateDataPlugins/plugins/wixVideoData"],function(t,e,i){"use strict";return{Image:t,VectorImage:e,WixVideo:i}}),define("core/utils/addComponentPlugins/plugins/commonUtils/addMultiple",["lodash","core/utils/updateDataPlugins/updateDataPlugins"],function(t,e){"use strict";return function(i,n,o,r,s,a,u,c){t.forEach(c,function(s,c){var l=void 0,p=void 0,d=void 0;c>0?(d=i.documentServices.pages.getFocusedPageId(),p=i.pasteLogic.addContext.getPastePosition(i,r.layout,d),l=c>0?t.merge({},r,{layout:p}):r):l=r;var g=u(l,s),h=g.data&&g.data.type;e[h]&&(g.data=e[h](g.data));var m=n(o,g);a&&i.documentServices.waitForChangesApplied(function(){a(m)})})}}),define("core/utils/addComponentPlugins/plugins/documentMedia",["lodash","core/utils/addComponentPlugins/plugins/commonUtils/addMultiple","util"],function(t,e,i){"use strict";function n(e,i){return t.merge({},e,{data:{title:i.title,link:{docId:t.last(i.fileUrl.split("/")),name:i.title,type:"DocumentLink"}}})}return function(t,o,r,s,a,u){if(s.data.link&&s.data.link.docId)return!1;var c=t.mediaServices;return c.mediaManager.open(c.mediaManager.categories.DOCUMENT,{callback:function(i){e(t,o,r,s,a,u,n,i),c.setFocusToEditor()},translation:{submitButton:i.translate("MMGR_submitbutton_addpanel_mydocs_add")}}),!0}}),define("core/utils/addComponentPlugins/plugins/commonUtils/addAudioPluginUtil",["lodash","core/utils/addComponentPlugins/plugins/commonUtils/addMultiple","util"],function(t,e,i){"use strict";return{handleAudioAdd:function(t,n,o,r,s,a,u){if(r.data.uri)return!1;var c=t.mediaServices;return c.mediaManager.open(c.mediaManager.categories.MUSIC,{callback:function(i){e(t,n,o,r,s,a,u,i),c.setFocusToEditor()},translation:{submitButton:i.translate("MMGR_submitbutton_addpanel_mytracks_add")}}),!0}}}),define("core/utils/addComponentPlugins/plugins/audioPlayer",["lodash","core/utils/addComponentPlugins/plugins/commonUtils/addAudioPluginUtil"],function(t,e){"use strict";function i(e,i){return t.merge({},e,{data:{uri:i.fileName,originalFileName:i.title}})}return function(t,n,o,r,s,a){return e.handleAudioAdd(t,n,o,r,s,a,i)}}),define("core/utils/addComponentPlugins/plugins/singleAudioPlayer",["lodash","core/utils/addComponentPlugins/plugins/commonUtils/addAudioPluginUtil"],function(t,e){"use strict";function i(e,i){return t.merge({},e,{data:{uri:i.fileName,originalFileName:i.title,artist:"Unknown Artist",track:"Unknown Track"}})}return function(t,n,o,r,s,a){return e.handleAudioAdd(t,n,o,r,s,a,i)}}),define("core/utils/componentPreviewReadyPlugins/formPlugin",["lodash"],function(t){"use strict";function e(e,i){var n=e.toEmailAddress,o=i.documentServices.generalInfo.getUserInfo().email;n||function(e){return t.endsWith(e,"@wix.com")}(o)||(e.toEmailAddress=o)}return{updateDataWithDefaults:e}}),define("core/utils/addComponentPlugins/plugins/contactForm",["lodash","util","core/utils/componentPreviewReadyPlugins/formPlugin"],function(t,e,i){"use strict";var n={successMessage:"Contact_Form_Settings_Messages_Success_message_default",validationErrorMessage:"Contact_Form_Settings_Messages_Error_message_mandatory_fields_default",errorMessage:"Contact_Form_Settings_Messages_Error_message_for_email_fields_default"};return function(o,r,s,a,u,c){!function(i){t.forOwn(n,function(t,n){i[n]=e.translate(t)})}(a.data),i.updateDataWithDefaults(a.data,o);var l=r(s,a);return c&&o.documentServices.waitForChangesApplied(function(){c(l)}),l}}),define("core/utils/addComponentPlugins/plugins/clipArt",["lodash","util","experiment"],function(t,e,i){"use strict";var n=e.imageTransform.fittingTypes;return function(e,o,r,s,a,u){s.props||(s=function(e){return t.merge(e,{data:{title:""},layout:{rotationInDegrees:0,scale:1,fixedPosition:!1,anchors:[]},props:{displayMode:i.isOpen("merge_clipart_and_image")?n.SCALE_TO_FILL:n.LEGACY_FULL,type:"WPhotoProperties"},style:e.style||"ca1"})}(s));var c=o(r,s);return u&&e.documentServices.waitForChangesApplied(function(){u(c)}),c}}),define("core/utils/addComponentPlugins/plugins/svgShape",["lodash"],function(t){"use strict";return function(e,i,n,o,r,s){var a=i(n,function(e){return t.defaults(e,{data:{link:null,type:"SvgShape"}})}(o));return s&&e.documentServices.waitForChangesApplied(function(){s(a)}),a}}),define("core/utils/addComponentPlugins/plugins/wPhoto",["lodash"],function(t){"use strict";return function(e,i,n,o,r,s){o.props||(o=function(e){return t.merge(e,{layout:{rotationInDegrees:0,scale:1,fixedPosition:!1,anchors:[]},props:{type:"WPhotoProperties"},style:e.style||"wp2"})}(o));var a=i(n,o);return s&&e.documentServices.waitForChangesApplied(function(){s(a)}),a}}),define("core/utils/addComponentPlugins/plugins/verticalAnchorsMenu",["lodash","constants"],function(t,e){"use strict";return function(t,i,n,o,r,s){var a=o.layout;a.fixedPosition&&(a.docked.right.px+=e.SECTIONS_REORGANIZE.STRIP_WIDTH,a.docked.right.px+=t.isVerticalScrollbarHidden()?.01*window.innerWidth:e.SECTIONS_REORGANIZE.STRIP_WIDTH,delete a.x,delete a.y);var u=i(n,o);return s&&t.documentServices.waitForChangesApplied(function(){s(u)}),u}}),define("core/utils/addComponentPlugins/plugins/stripContainer",[],function(){"use strict";return function(t,e,i,n){n.layout.x=0}}),define("core/utils/addComponentPlugins/plugins/appControllerAddPlugin",["lodash","platformEvents"],function(t,e){"use strict";return function(t,i,n){var o=t.components.data.get(i),r=t.documentServices.platform.getAppDataByAppDefId(o.applicationId);r&&t.documentServices.platform.notifyApplication(r.applicationId,e.factory.controllerAdded({controllerRef:i,origin:n}))}}),define("core/utils/addComponentPlugins/plugins/vectorImageBefore",["lodash"],function(t){"use strict";return function(e,i,n,o){var r=o.data.svgId;e.media.vectorImage.fetchSvg(r,t.noop)}}),define("core/utils/addComponentPlugins/plugins/vectorImageAfter",["constants","lodash"],function(t,e){"use strict";return function(i,n){var o=i.components.properties.get(n);if("fit"===o.displayMode||"legacyFit"===o.displayMode){var r=i.media.vectorImage.getSvgOriginalAspectRatio(n);i.components.layout.resetCompLayoutToAspectRatio(n,r)}var s=i.components.data.get(n),a=i.media.vectorImage.getSvgInfoFromCache(s.svgId),u=e.get(a,"svgType");if(e.includes(["shape","tint"],u)){var c=i.components.design.get(n),l=e.get(c,"overrideColors");if(e.isEmpty(l)){var p=t.VECTOR_IMAGE_DEFAULTS.VECTOR_SHAPE_COLOR_DEFAULT.color1,d=e.assign({},c,{overrideColors:{color1:p}});i.components.design.update(n,d,!0,!0)}}}}),define("core/utils/addComponentPlugins/plugins/wTwitterTweet",[],function(){"use strict";return function(t,e,i,n){n.data.urlFormat=t.documentServices.generalInfo.urlFormat.get()}}),define("core/utils/addComponentPlugins/addComponentPlugins",["core/utils/addComponentPlugins/plugins/page","core/utils/addComponentPlugins/plugins/anchor","core/utils/addComponentPlugins/plugins/documentMedia","core/utils/addComponentPlugins/plugins/audioPlayer","core/utils/addComponentPlugins/plugins/singleAudioPlayer","core/utils/addComponentPlugins/plugins/contactForm","core/utils/addComponentPlugins/plugins/clipArt","core/utils/addComponentPlugins/plugins/svgShape","core/utils/addComponentPlugins/plugins/wPhoto","core/utils/addComponentPlugins/plugins/verticalAnchorsMenu","core/utils/addComponentPlugins/plugins/stripContainer","core/utils/addComponentPlugins/plugins/appControllerAddPlugin","core/utils/addComponentPlugins/plugins/vectorImageBefore","core/utils/addComponentPlugins/plugins/vectorImageAfter","core/utils/addComponentPlugins/plugins/wTwitterTweet"],function(t,e,i,n,o,r,s,a,u,c,l,p,d,g,h){"use strict";return{before:{"mobile.core.components.Page":t,"wysiwyg.common.components.anchor.viewer.Anchor":e,"wysiwyg.viewer.components.documentmedia.DocumentMedia":i,"wysiwyg.viewer.components.AudioPlayer":n,"wysiwyg.common.components.singleaudioplayer.viewer.SingleAudioPlayer":o,"wysiwyg.viewer.components.ClipArt":s,"wysiwyg.viewer.components.ContactForm":r,"wysiwyg.viewer.components.DynamicContactForm":r,"wysiwyg.viewer.components.svgshape.SvgShape":a,"wysiwyg.viewer.components.WPhoto":u,"wysiwyg.viewer.components.StripContainer":l,"wysiwyg.common.components.verticalanchorsmenu.viewer.VerticalAnchorsMenu":c,"wysiwyg.viewer.components.WTwitterTweet":h,"wysiwyg.viewer.components.VectorImage":d},after:{"platform.components.AppController":p,"wysiwyg.viewer.components.VectorImage":g}}}),define("core/utils/addUtil",["core/utils/addComponentPlugins/addComponentPlugins","core/utils/updateDataPlugins/updateDataPlugins"],function(t,e){"use strict";return{addComponent:function(i,n,o,r,s,a,u){var c=r.componentType,l=r.data&&r.data.type;if(e[l]&&(r.data=e[l](r.data)),t.before[c]){var p=t.before[c](i,n,o,r,s,a);if(p)return p}var d=n(o,r,s);return i.documentServices.waitForChangesApplied(function(){a&&a(d),t.after[c]&&t.after[c](i,d,u)}),d},componentsWithPlugins:Object.keys(t)}}),define("core/utils/scrollUtils",["lodash"],function(t){"use strict";function e(){return window.document.getElementById("scrollableEditorStage")}return{getScroll:function(){var i=e();return t.pick(i,["scrollLeft","scrollTop","scrollHeight","scrollWidth"])},setScroll:function(i){var n=e();t.isUndefined(i.scrollTop)||(n.scrollTop=i.scrollTop),t.isUndefined(i.scrollLeft)||(n.scrollLeft=i.scrollLeft)}}}),define("core/utils/stageUtils",["lodash","constants","core/utils/scrollUtils"],function(t,e,i){"use strict";var n={top:e.UI.VIEWPORT_VERTICAL_MARGINS,bottom:e.UI.VIEWPORT_VERTICAL_MARGINS,left:72,right:60},o={getViewPort:function(t,e){var r=o.getStageLayout();if(!r)return null;var s=i.getScroll(),a={y:n.top,minY:n.top,bottomY:r.height-n.bottom,maxBottomY:s.scrollHeight-n.bottom,marginBottom:n.bottom,x:n.left,rightX:r.width-n.right,height:r.height-(n.top+n.bottom),width:r.width-(n.left+n.right),scrollTop:s.scrollTop,scrollLeft:s.scrollLeft,stageLayout:r};t&&(a.y+=s.scrollTop,a.bottomY+=s.scrollTop,a.x+=s.scrollLeft,a.rightX+=s.scrollLeft);var u=e&&e.right+10;if(u&&u>a.x){var c=u-a.x;a.x=u,a.width-=c}return a},getStageLayout:function(){var e=window.document.getElementById("stageContainer"),i={top:0,right:0,bottom:0,left:0,x:0,y:0,width:0,height:0};if(!e)return i;var n=e.getBoundingClientRect();return t.pick(n,t.keys(i))},getStageRect:function(){var t=o.getStageLayout(),e=i.getScroll();return{top:e.scrollTop,bottom:e.scrollTop+t.height,left:e.scrollLeft,right:e.scrollLeft+t.width}}};return o}),define("core/utils/AttachHandler",["lodash"],function(t){"use strict";function e(t,e){return t.components.layout.getRelativeToScreenConsideringScroll(e)}function i(i,n,o){var r=i.documentServices.siteSegments.getHeader(),s=i.documentServices.pages.getFocusedPageId(),a=i.components.getAllComponents(s);(function(t){return t.isMobileEditor()})(i,n.comp)&&(a=a.concat(i.documentServices.siteSegments.getSiteStructure()));return o===l.COMP&&(!i.components.isShowOnAllPages(n.comp)||i.siteSegments.isUsingSectionsLayout()&&function(t,e){var i=t.siteSegments.getSiteStructure();return t.utils.isSameRef(t.components.getContainer(e),i)}(i,n.comp))&&(a=function(e,i){var n=e.documentServices.siteSegments.getFooter();return t.filter(i,function(t){var i=e.components.isDescendantOfComp(t,n);return!e.utils.isSameRef(t,n)&&!i})}(i,a)),t(a).filter(function(t){return!i.utils.isSameRef(t,n.comp)&&d[o].isContainable(i,n.comp,t)}).filter(function(t){return i.components.isRenderedOnSite(t)}).map(function(t){return{layout:e(i,t),comp:t}}).filter(function(t){var e=i.utils.isSameRef(t.comp,r);return i.utils.isSameRef(t.comp,i.pages.getPrimaryContainer())||t.layout.width>=n.layout.width&&(e||t.layout.height>=n.layout.height)}).value()}function n(t,e,i,n){var o=t.components.is.fullWidth(e),r=t.utils.isSameRef(e,t.documentServices.siteSegments.getHeader());return(o||i.x>=n.x)&&(o||i.x+i.width<=n.x+n.width)&&(r||i.y>=n.y)&&i.y+i.height<=n.y+n.height}function o(e,i){var o=i.layout,r=i.comp,s=e.layout,a=d[this.type].getContainer(this.editorAPI,this.comp);return!(t.isEmpty(a)&&this.editorAPI.utils.isSiteStructure(r))&&!function(e,i,n){return!t.isEmpty(i)&&e.utils.isSiteStructure(i)&&e.utils.isPage(n)}(this.editorAPI,a,r)&&!function(e,i,n){return!t.isEmpty(i)&&!e.components.isShowOnAllPages(i)&&e.utils.isSiteStructure(n)}(this.editorAPI,a,r)&&!function(e,i,n){return!t.isEmpty(i)&&!e.components.isShowOnAllPages(i)&&"wysiwyg.viewer.components.FooterContainer"===e.components.getType(n)}(this.editorAPI,a,r)&&!this.editorAPI.utils.isSameRef(a,r)&&n(this.editorAPI,i.comp,s,o)}function r(t,e){return!(t.x>=e.x+e.width||e.x>=t.x+t.width||t.y>=e.y+e.height||e.y>=t.y+t.height)}function s(s,a){t.has(this,"attachCandidates")||(this.attachCandidates=i(this.editorAPI,this.initialCompWithLayout,this.type));var u=t.find(this.attachCandidates,t.bind(function(t){return t.layout=function(t,i,n){return t.components.is.repeatedComponent(n)?e(t,i.comp):i.layout}(this.editorAPI,t,this.comp),a?n(this.editorAPI,t.comp,s,t.layout):r(s,t.layout)},this));return u&&o.call(this,{layout:s},u)?u.comp:null}function a(e,i){var n=e||d[this.type].getCompLayout(this.editorAPI,this.comp),o=function(e){var i=d[this.type].getContainer(this.editorAPI,this.comp);return!(!t.isEmpty(i)&&d[this.type].getCompLayout&&r(e,d[this.type].getCompLayout(this.editorAPI,i)))}.call(this,n),a=s.call(this,n,o),u=t.find(i,t.isEqual.bind(t,a)),c={candidateRef:null,candidateStatus:p.SAME};return a&&!u?(c.candidateRef=a,c.candidateStatus=p.VALID):function(t,e,i,n){var o=d[n].getContainer(t,i);return!t.utils.isPage(o)&&(t.isMobileEditor()?e&&!d[n].isShowOnAllPages(t,i):e)}(this.editorAPI,o,this.comp,this.type)&&(c.candidateRef=this.editorAPI.pages.getFocusedPage(),c.candidateStatus=p.VALID),c.candidateRef&&!this.editorAPI.components.is.allowedToContainMoreChildren(c.candidateRef)&&(c.candidateStatus=p.INVALID),c}function u(e){(e=function(e,i,n){var o=void 0,r=e.documentServices.pages.popupPages.getCurrentPopupId();if(r)if(n){if(n.id===r)return null}else if(o=e.pages.popupPages.getPopupContainer(),t.find(i,["comp.id",o.id]))return o;return n}(this.editorAPI,this.attachCandidates,e))&&this.editorAPI.utils.isSiteStructure(e)||this.editorAPI.setAttachCandidate(e,this.type===l.STRUCTURE)}function c(t,e,n){t&&(this.editorAPI=t,this.type=n,this.initialCompWithLayout=e,this.comp=e.comp,this.attachCandidates=i(t,e,n))}var l={COMP:"comp",STRUCTURE:"structure"},p={SAME:"same",VALID:"valid",INVALID:"invalid"},d={comp:{getContainer:function(t,e){return t.components.getContainer(e)},isContainable:function(t,e,i){return t.components.is.containable(e,i)&&!t.components.is.group(i)},getCompLayout:function(t,e){return t.components.layout.getRelativeToScreenConsideringScroll(e).bounding},getCompType:function(t,e){return t.components.getType(e)},isShowOnAllPages:function(t,e){return t.components.isShowOnAllPages(e)}},structure:{getCompType:function(){return""},getContainer:function(){return{}},isContainable:function(t,e,i){return t.components.is.containableByStructure(e,i)&&!t.components.is.group(i)},isShowOnAllPages:function(){return!1}}};return c.prototype={getCurrentAttachCandidate:a,highlightAttachCandidate:u,clearHighlightAttachCandidate:function(t){this.editorAPI.setAttachCandidate(null,!!t)}},c.TYPES=l,c.ATTACH_CANDIDATE_STATUSES=p,c}),define("core/utils/mediaManagerPresetUtil",["lodash","stateManagement"],function(t,e){"use strict";function i(e){var n=t.get(e,"data",{});switch(n.type){case"VectorImage":return n.svgId;case"Image":return n.uri;case"WixVideo":return(n=t.get(e,"design",{})).videoId||"";case"BackgroundMedia":return n=t.get(e,"design",{}),i(n.mediaRef)||"";default:return""}}var n=e.editorPlugins.userPreferences.actions.setSessionUserPreferences;return{getIdByDataType:i,storePath:function(t,e,i){i&&t.store.dispatch(n("last_media_path_"+e,i))}}}),define("core/utils/gridLinesUtil",[],function(){"use strict";return{getPageGridLines:function(t,e){return function(t,e){var i=t.y+t.height,n=t.x+t.width,o={x1:t.x,y1:0,x2:t.x,y2:"100%"},r={x1:n,y1:0,x2:n,y2:"100%"},s={x1:0,y1:t.y,x2:"100%",y2:t.y};return e?[o,r]:[o,r,s,{x1:0,y1:i,x2:"100%",y2:i}]}(function(t){var e=t.siteSegments.getPagesContainerAbsLayout(),i=t.getSiteScale();if(!i||1===i)return e;var n={y:e.y*i,width:e.width*i,height:e.height*i},o=e.width-n.width;return n.x=e.x+o/2,n}(t),e)},getContainerGridLines:function(t,e){"wysiwyg.viewer.components.StripColumnsContainer"===t.components.getType(e)&&(e=t.components.getChildren(e)[0]);var i=t.components.layout.getCompMargin(e),n=t.components.layout.getRelativeToScreen(e),o=n.y+n.height,r=n.x+i.left,s=n.x+n.width-i.right;return[{x1:r,y1:n.y,x2:r,y2:o},{x1:s,y1:n.y,x2:s,y2:o}]}}}),define("core/utils/SnapToHandler",["lodash","core/utils/gridLinesUtil","stateManagement","util"],function(t,e,i,n){"use strict";function o(e,i,n,o){return i||t.isEqual(n,e)||t.isEqual(o,e)}function r(t,e,i,n,r){var s=o(e,i,n,r);return t.components.layout.getRelativeToScreen(e,s).bounding}function s(t,e){return e&&t.components.is.page(e)}function a(n,o,a){var u=n.documentServices.siteSegments.getHeader(),c=n.documentServices.siteSegments.getFooter();return t(o).map(function(e){var i=s(n,e);return{layout:r(n,e,i,u,c),isDynamicLayout:function(e,i,n,o){return n||t.isEqual(o,i)||e.components.isDescendantOfComp(i,o)}(n,e,i,c),comp:e}}).concat(function(i){var n=i.store.getState(),o=C(n);if(!o||!i.components.is.showMarginsIndicator(o))return[];return t(o).thru(e.getContainerGridLines.bind(null,i)).map(function(t){return{layout:{x:t.x1,y:t.y1,height:t.y2-t.y1,width:0},isDynamicLayout:!1}}).value()}(n)).filter(function(t){return a(t.layout)}).concat(function(e){if(!i.editorPlugins.rulers.selectors.isRulersEnabled(e.store.getState()))return[];var n=function(e){var n=e.store.getState(),o=i.editorPlugins.rulers.selectors.getHorizontalGuides(n),r=S(n);return t.map(o,function(t){return{id:t.guideId,x:r.left,y:t.guidePosition,height:0,width:r.right}})}(e);return n=n.concat(function(e){var n=e.store.getState(),o=i.editorPlugins.rulers.selectors.getVerticalGuides(n),r=S(n);return t.map(o,function(t){var n=i.editorPlugins.rulers.selectors.getVerticalGuideRealPosition(e.dsRead,t.guidePosition);return{id:t.guideId,x:n,y:r.top,height:r.bottom,width:0}})}(e)),t.map(n,function(t){return{layout:t,isDynamicLayout:!1}})}(n)).value()}function u(t){var e=t.layout;return this.right>=e.x&&e.x+e.width>=this.left&&this.bottom>=e.y&&e.y+e.height>=this.top}function c(e,i){return t.filter(e,t.bind(u,i))}function l(e,i,n){var r=e.documentServices.siteSegments.getHeader(),a=e.documentServices.siteSegments.getFooter();return t.filter(n,function(t){var n=t.comp,u=s(e,n),c=t.layout;return!o(n,u,r,a)&&(i===c.y||i===c.y+c.height)})}function p(e,i,n){var r=e.documentServices.siteSegments.getHeader(),a=e.documentServices.siteSegments.getFooter();return t.filter(n,function(t){var n=t.comp,u=s(e,n),c=t.layout;return!o(n,u,r,a)&&(i===c.x||i===c.x+c.width)})}function d(e,i){return t.map(i,function(i){return t(i.layout).pick(["x","y","width","height"]).assign({isOnMasterPage:i.comp&&(e.components.isShowOnAllPages(i.comp)||e.components.isShowOnSomePages(i.comp))}).value()})}function g(e,i,n,o,r){var s=t.map(o,"layout"),a=[n].concat(s),u=function(e){return t.minBy(e,"x")}(a.concat(r)),c=function(e){return t.maxBy(e,function(t){return t.x+t.width})}(a.concat(r)),l=d(e,o);return{line:[{x:u.x,y:i},{x:c.x+c.width,y:i}],rectanglesDrawData:l}}function h(e,i,n,o,r){var s=t.map(o,"layout"),a=[n].concat(s),u=function(e){return t.minBy(e,"y")}(a.concat(r)),c=function(e){return t.maxBy(e,function(t){return t.y+t.height})}(a.concat(r)),l=d(e,o);return{line:[{x:i,y:u.y},{x:i,y:c.y+c.height}],rectanglesDrawData:l}}function m(e,i){var n=e.documentServices.pages.getFocusedPageId();return e.components.getAllComponents(n,function(e,i,n){return!(e.selection.isComponentSelected(n)||e.components.is.groupedComponent(n)||t.includes(v,n.id)||!e.components.isRenderedOnSite(n)||e.components.layout.isRenderedInFixedPosition(n)||i&&e.components.isAscendantOfComp(i,n)||e.documentServices.pages.isWidgetPage(n.id))}.bind(null,e,i))}function f(t,e){t&&(this.editorAPI=t,this.compRefs=e)}function y(i,n){var o=function(i){var n=S(i.store.getState()).right;return t(i).thru(e.getPageGridLines).filter({x2:"100%"}).map(function(t){return{x:t.x1,y:t.y1,width:n}}).value()}(i);return t.filter(o,{y:n})}function P(i,n){var o=function(i){var n=S(i.store.getState()).bottom;return t(i).thru(e.getPageGridLines).filter({y2:"100%"}).map(function(t){return{x:t.x1,y:t.y1,height:n}}).value()}(i);return t.filter(o,{x:n})}var v=["SITE_PAGES","PAGES_CONTAINER"],S=i.domMeasurements.selectors.getStageRect,C=i.editorPlugins.selection.selectors.getFocusedContainer;return f.prototype.getSnapCandidates=function(e){if(!t.has(this,"snapCandidates")){var i=m(this.editorAPI,this.compRefs),o=t.isFunction(e)?e:function(){return!0};this.snapCandidates=a(this.editorAPI,i,o),t.get(this.compRefs,"0")&&n.recommendedMobileHeaderHeightUtils.isMobileHeader(this.compRefs[0])&&this.snapCandidates.push(n.recommendedMobileHeaderHeightUtils.getSnapCandidate(this.editorAPI.ui.stage.getEditingAreaLayout)),this.compRefs=null}return this.snapCandidates},f.prototype.getClosestLayoutDistance=function(e,i,n,a){var u=this.getSnapCandidates(a);!function(e,i){t.forEach(i,function(t){t.layout=t.isDynamicLayout?r(e,t.comp):t.layout})}(e,u);var l=c(u,S(e.store.getState()));return{x:function(e,i,n,r){var a=e.documentServices.siteSegments.getHeader(),u=e.documentServices.siteSegments.getFooter(),c=t.reduce(n,function(t,n){var c=n.layout,l=n.comp;return o(l,s(e,l),a,u)||(r.left&&(t.push(c.x-i.x),t.push(c.x+c.width-i.x)),r.right&&(t.push(c.x-(i.x+i.width)),t.push(c.x+c.width-(i.x+i.width)))),r.centerX&&t.push((c.x+(c.x+c.width))/2-(i.x+(i.x+i.width))/2),t},[]),l=function(t,e,i){var n=t.siteSegments.getPagesContainerAbsLayout(),o=[];return i.left&&(o.push(n.x-e.x),o.push(n.x+n.width-e.x)),i.right&&(o.push(n.x-(e.x+e.width)),o.push(n.x+n.width-(e.x+e.width))),o}(e,i,r);return t.minBy(c.concat(l),function(t){return Math.abs(t)})}(e,i,l,n),y:function(e,i,n,r){var a=e.documentServices.siteSegments.getHeader(),u=e.documentServices.siteSegments.getFooter(),c=t.reduce(n,function(t,n){var c=n.layout,l=n.comp;return o(l,s(e,l),a,u)||(r.top&&(t.push(c.y-i.y),t.push(c.y+c.height-i.y)),r.bottom&&(t.push(c.y-(i.y+i.height)),t.push(c.y+c.height-(i.y+i.height)))),r.centerY&&t.push((c.y+(c.y+c.height))/2-(i.y+(i.y+i.height))/2),t},[]),l=function(t,e,i){var n=t.siteSegments.getPagesContainerAbsLayout(),o=[];return i.top&&(o.push(n.y-e.y),o.push(n.y+n.height-e.y)),i.bottom&&(o.push(n.y-(e.y+e.height)),o.push(n.y+n.height-(e.y+e.height))),o}(e,i,r);return t.minBy(c.concat(l),function(t){return Math.abs(t)})}(e,i,l,n)}},f.prototype.getSnapData=function(e,i,n){var o=[],r=S(this.editorAPI.store.getState()),s=c(this.getSnapCandidates(),r),a=[],u=[],d=i.centerY&&function(e,i){return t.filter(i,function(t){var i=t.layout;return e===(i.y+(i.y+i.height))/2})}((e.y+e.y+e.height)/2,s);if(d&&d.length>0)o.push(g(this.editorAPI,(e.y+e.y+e.height)/2,e,d,a));else{var m=[];if(i.top&&(m=l(this.editorAPI,e.y,s),a=n?[]:y(this.editorAPI,e.y),(m.length>0||a.length>0)&&o.push(g(this.editorAPI,e.y,e,m,a))),i.bottom){var f=e.y+e.height;m=l(this.editorAPI,f,s),a=n?[]:y(this.editorAPI,f),(m.length>0||a.length>0)&&o.push(g(this.editorAPI,f,e,m,a))}}var v=i.centerX&&function(e,i){return t.filter(i,function(t){var i=t.layout;return e===(i.x+(i.x+i.width))/2})}((e.x+e.x+e.width)/2,s);if(v&&v.length>0)o.push(h(this.editorAPI,(e.x+e.x+e.width)/2,e,v,u));else{var C=[];if(i.right){var T=e.x+e.width;C=p(this.editorAPI,T,s),u=n?[]:P(this.editorAPI,T),(C.length>0||u.length>0)&&o.push(h(this.editorAPI,T,e,C,u))}i.left&&(C=p(this.editorAPI,e.x,s),u=n?[]:P(this.editorAPI,e.x),(C.length>0||u.length>0)&&o.push(h(this.editorAPI,e.x,e,C,u)))}return o},f}),define("core/utils/AddPanelDragHandler",["lodash","zepto","util","experiment","constants","coreBi","core/utils/stageUtils","core/utils/AttachHandler","core/utils/mediaManagerPresetUtil","stateManagement","core/utils/SnapToHandler"],function(t,e,i,n,o,r,s,a,u,c,l){"use strict";function p(e,n,a,u,c,l,p){e&&(this.editorAPI=e,this.initialEvent=n,this.item=a,this.panelElm=u,this.dragBoxClass=c,this.onItemDragStart=l,this.onItemDragEnd=p,this.ignoreTouchingGridLines=e.documentServices.pages.isWidgetPage(e.pages.getFocusedPageId()),this.isFirstDragEvent=!0,this.originalDragPosition={x:this.initialEvent.pageX,y:this.initialEvent.pageY},this.item.onDrop=this.item.onDrop||function(e,n,s,a){t.assign(s.structure.layout,n),e.components.add(a,s.structure,void 0,function(n){if(!t.isEmpty(e.components.modes.getModes(a))&&n.id){var u=e.components.modes.getComponentActiveModeIds(a);e.components.modes.showComponentOnlyInModesCombination(n,t.keys(u)),e.tabIndicationState.activateAddAnimation(!0),e.components.modes.addDefaultSingleModeAnimations(n)}"Page"!==s.structure.type&&e.history.add("component dragged to stage from add panel");var c=e.components.getType(a),l=e.components.is.repeatedComponent(a);if(e.selection.selectComponentByCompRef(n),e.openFirstTimePanel(n),e.bi.event(r.events.addPanel.COMPONENT_ADDED_TO_STAGE,{origin:"add_panel",category:s.categoryId,section:s.sectionTitle,component_type:s.structure.componentType,component_id:n.id,preset_id:s.itemId||"",adding_method:"drag",preset_data_skin:s.structure.style.skin||s.structure.skin||s.structure.style,preset_data_tags:s.tags||"",page_id:e.pages.getFocusedPage()&&e.pages.getFocusedPage().id,target_component:c,is_target_repeated:l}),e.openCompOutOfGridPanelIfNeeded(n),s.appDefinitionId){var p=e.documentServices.platform.getAppDataByAppDefId(s.appDefinitionId);p&&p.applicationId&&e.documentServices.platform.notifyApplication(p.applicationId,{eventType:o.EVENTS.ADD_PANEL.COMPONENT_ADDED_TO_STAGE,eventPayload:{compRef:n}})}i.fedopsLogger.interactionEnded(i.fedopsLogger.INTERACTIONS.ADD_COMP_FROM_ADD_PANEL)})}.bind(null,this.editorAPI),this.stageLayout=s.getStageLayout(),this.editorAPI.components.is.fullWidthByStructure(this.item.structure)?(this.isFullWidth=!0,this.allowedSnapDirections=y):(this.allowedSnapDirections=f,this.isFullWidth=!1),this.init())}var d=c.editorPlugins.domMeasurements.selectors,g=d.translateToViewerCoordinates,h=d.getPreviewPosition,m=d.getSiteScale,f={top:!0,bottom:!0,left:!0,right:!0,centerX:!0,centerY:!0},y={top:!0,bottom:!0,left:!1,right:!1,centerX:!1,centerY:!0},P=8;return p.prototype={init:function(){this.snapToHandler=new l(this.editorAPI),this.attachHandler=new a(this.editorAPI,{comp:this.item.structure,layout:t.pick(this.item.structure.layout,["width","height"])},a.TYPES.STRUCTURE)},getFixedDragPosition:function(t){return{x:t.clientX,y:t.clientY}},onDrag:function(t){var e=this.editorAPI.store.getState(),n=g(e,t);if(this.isFirstDragEvent){if(!function(t,e){return Math.abs(e.x-t.pageX)>=P||Math.abs(e.y-t.pageY)>=P}(n,this.originalDragPosition))return;i.fedopsLogger.interactionStarted(i.fedopsLogger.INTERACTIONS.ADD_COMP_FROM_ADD_PANEL),this.onInitialDrag(),this.isFirstDragEvent=!1}this.lastDragPosition={x:n.pageX,y:n.pageY},this.lastDragFixedPosition=this.getFixedDragPosition(t);var o=this.isInPanelArea();o?this.handleDragInPanelArea():this.handleDragOutsidePanelArea(t),this.setDragBox(o)},onInitialDrag:function(){t.isFunction(this.onItemDragStart)&&this.onItemDragStart()},isInPanelArea:function(){var t=this.getPanelClientRect();return this.lastDragFixedPosition.x>=t.left&&this.lastDragFixedPosition.x<=t.right&&this.lastDragFixedPosition.y>=t.top&&this.lastDragFixedPosition.y<=t.bottom},getPanelClientRect:function(){return this._panelClientRect||(this._panelClientRect=this.panelElm.getBoundingClientRect()),this._panelClientRect},handleDragOutsidePanelArea:function(){var t=this.getDragBoxStageLayout(),e=this.getDragBoxStageLayout(!0);if("popup"!==this.item.categoryId){this.snapDragBoxToCompIfNeeded(t);var i=this.attachHandler.getCurrentAttachCandidate(e),n=i.candidateRef;i.candidateStatus===a.ATTACH_CANDIDATE_STATUSES.VALID&&this.attachHandler.highlightAttachCandidate(n)}},handleDragInPanelArea:function(){this.editorAPI.snapData.clear(!0),this.attachHandler.clearHighlightAttachCandidate(!0)},getDragBoxStageLayout:function(t){var e={x:this.lastDragPosition.x+this.getBoxOffset().left*this.item.structure.layout.width,y:this.lastDragPosition.y+this.getBoxOffset().top*this.item.structure.layout.height,width:this.item.structure.layout.width,height:this.item.structure.layout.height};if(t){var i=this.editorAPI.ui.scroll.getScroll();e.x-=i.scrollLeft,e.y-=i.scrollTop}return e},getBoxOffset:function(){if(!this._boxOffset){var t=this.getRectSize();this._boxOffset={left:(this.item.rect.left+e(window).scrollLeft()-this.originalDragPosition.x)/t.width,top:(this.item.rect.top+e(window).scrollTop()-this.originalDragPosition.y)/t.height}}return this._boxOffset},getRectSize:function(){return{width:this.item.rect.width,height:this.item.rect.height}},setDragBox:function(e){var i=this.editorAPI.store.getState(),n=m(i),o={key:"dragToStageDragBox",coords:{left:this.lastDragFixedPosition.x,top:this.lastDragFixedPosition.y},boxOffset:this.getBoxOffset()};if(e)o.boxSize=this.getRectSize();else if("popup"===this.item.categoryId)(o=function(e,i,n){var o=i.structure.components[0],r=o.layout,s=o.props.alignmentType,a=o.props.verticalAlignment,u=o.props.horizontalAlignment,c={fullHeight:function(){return{left:"left"===u?n.left:n.right-r.width,top:n.top,height:n.height,width:r.width}},fullWidth:function(){return{left:n.left,top:"bottom"===a?n.bottom-r.height:n.top,height:r.height,width:n.width}},nineGrid:function(){return{left:(n.width-r.width)/2,top:(n.height-r.height)/2,height:r.height,width:r.width}}}[s]();return e.coords=t.pick(c,["left","top"]),e.boxSize=t.pick(c,["height","width"]),e.boxOffset={left:0,top:0},e}(o,this.item,this.stageLayout)).boxSize.height*=n;else if(o.boxSize=t.pick(this.item.structure.layout,["width","height"]),o.boxSize.height*=n,this.isFullWidth){var r=h(i);o=function(e,i,n){return e.boxOffset=t.assign({},e.boxOffset,{left:0}),e.coords.left=n.left,i&&(e.boxSize.width=i),e}(o,this.stageLayout.width,r)}var s={props:o,componentType:this.item.structure.componentType,reactClass:this.dragBoxClass};this.editorAPI.setPortalChildren("addPanel",[s])},snapDragBoxToCompIfNeeded:function(t){var e=this.snapToHandler.getClosestLayoutDistance(this.editorAPI,t,this.allowedSnapDirections);Math.abs(e.x)<=5&&(this.lastDragPosition.x+=e.x,this.lastDragFixedPosition.x+=e.x,t.x+=e.x),Math.abs(e.y)<=5&&(this.lastDragPosition.y+=e.y,this.lastDragFixedPosition.y+=e.y,t.y+=e.y);var i=this.snapToHandler.getSnapData(t,this.allowedSnapDirections,this.ignoreTouchingGridLines);this.editorAPI.snapData.set(i,!0)},clearDrag:function(){this.editorAPI.snapData.clear(!0),this.attachHandler.clearHighlightAttachCandidate(!0)},endDrag:function(t){if(this.clearDrag(),this.editorAPI.setPortalChildren("addPanel",null),this.isFirstDragEvent)return!1;var e=this.editorAPI.store.getState(),n=g(e,t);return this.lastDragPosition={x:n.pageX,y:n.pageY},this.isInPanelArea()?i.fedopsLogger.interactionEnded(i.fedopsLogger.INTERACTIONS.ADD_COMP_FROM_ADD_PANEL):this.onDrop(t),this.onItemDragEnd&&this.onItemDragEnd(),!0},getCompPositionRelativeToContainer:function(t,e){return{x:this.lastDragPosition.x-t.x-e.x+this.getBoxOffset().left*this.item.structure.layout.width,y:this.lastDragPosition.y-t.y-e.y+this.getBoxOffset().top*this.item.structure.layout.height}},onDrop:function(){var e=this.getDropContainer(this.getDragBoxStageLayout(!0));if(e){var i=this.editorAPI.components.layout.getRelativeToStructure(e),o=function(t){var e=t.documentServices.siteSegments.getPagesContainer();return{x:t.components.layout.getRelativeToScreen(e).x,y:0}}(this.editorAPI),r=this.getCompPositionRelativeToContainer(o,i);this.item.onDrop&&(t.defer(function(){n.isOpen("newBlogIntegration")||n.isOpen("changeNewBlogButtonBehaviour")?this.item.onDrop(r,this.item,e,this.editorAPI):this.item.onDrop(r,this.item,e)}.bind(this)),u.storePath(this.editorAPI,u.getIdByDataType(this.item.structure),t.get(this.item,["mediaManager","path"])))}},getDropContainer:function(t){var e=this.attachHandler.getCurrentAttachCandidate(t),i=e.candidateRef;return e.candidateStatus===a.ATTACH_CANDIDATE_STATUSES.INVALID?null:i}},p}),define("core/utils/layoutSymmetryUtil",["lodash"],function(t){"use strict";function e(e){return{horizontal:function(t){return Boolean(t.docked&&t.docked.hCenter||t.symmetry&&t.symmetry.horizontal)}(e)||function(e){var i=t.chain(e).get("docked.left.vw").isFinite().value(),n=t.chain(e).get("docked.right.vw").isFinite().value();return i&&n}(e),vertical:function(t){return Boolean(t.docked&&t.docked.vCenter||t.symmetry&&t.symmetry.vertical)}(e)}}return{getLayoutSymmetry:e}}),define("core/utils/layoutTransitionsUtil",["lodash","core/utils/layoutSymmetryUtil"],function(t,e){"use strict";function i(t,e){return Math.atan2(t.y-e.y,t.x-e.x)}function n(t,e,i){return 0===e?t:{x:(t.x-i.x)*Math.cos(e)-(t.y-i.y)*Math.sin(e)+i.x,y:(t.x-i.x)*Math.sin(e)+(t.y-i.y)*Math.cos(e)+i.y}}function o(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function r(e,i,n){if(!e)return null;var o=t.clone(e),r=n.x-i.x,s=n.y-i.y;return n.isShiftPressed&&(Math.abs(r)>=Math.abs(s)?s=0:r=0),o.x+=r,o.y+=s,o}function s(e,i,n){e&&(this.initLayout=e,this.boundCompsPositionRelativeToLayout=t.map(n,function(t){return{x:t.x-e.x,y:t.y-e.y}}),this.initMouseLocation=i,this.getLayout=r.bind(null,this.initLayout,this.initMouseLocation),this.getBoundComponentLayouts=function(e,i){return t.map(e,function(t){return{x:i.x+t.x,y:i.y+t.y}})}.bind(null,this.boundCompsPositionRelativeToLayout))}function a(t,e,i,n){var o=0,r=i?Math.floor(e/2):e;return 1===t?o=Math.max(-r,n):-1===t&&(o=Math.min(r,n)),o}function u(i,r,s,u,c){i&&(this.initLayout=i,this.initMouseLocation=r,this.direction=s,this.proportional=u,this.rotationInRad=l*i.rotationInDegrees,this.ratio=c||1,this.initLayoutAspectRatio=i.width/i.height,this.getCorrectXYAfterTransformOriginChange=function(e){var i=t.pick(e,["x","y"]);return i=n(i,-this.rotationInRad,o(e)),n(i,this.rotationInRad,o(this.initLayout))},this.getLayoutAfterProportionalHorizontalResize=function(e,i){var n=t.clone(e),o=void 0;this.direction.x===p.LEFT?(o=-Math.min(i.x,e.width),n.x-=o):this.direction.x===p.RIGHT&&(o=Math.max(i.x,-e.width)),n.width+=o,n.height=n.width/this.initLayoutAspectRatio;var r=n.height-this.initLayout.height;return n.y-=r/2,t.assign(n,this.getCorrectXYAfterTransformOriginChange(n)),n},this.getLayoutAfterProportionalVerticalResize=function(e,i){var n=t.clone(e),o=0;this.direction.y===p.TOP?(o=-Math.min(i.y,e.height),n.y-=o):this.direction.y===p.BOTTOM&&(o=Math.max(i.y,-e.height)),n.height+=o,n.width=n.height*this.initLayoutAspectRatio;var r=n.width-this.initLayout.width;return n.x-=r/2,t.assign(n,this.getCorrectXYAfterTransformOriginChange(n)),n},this.getLayoutAfterStandardResize=function(i,n){var o=e.getLayoutSymmetry(i);return this.direction.x&&(o.horizontal?function(t,e,i){var n=a(i,t.width,!0,e.x);1===i?(t.x-=n,t.width+=2*n):-1===i&&(t.x+=n,t.width-=2*n)}(i,n,this.direction.x):(n.x/=this.ratio,function(t,e,i){var n=a(i,t.width,!1,e.x);1===i?t.width+=n:-1===i&&(t.x+=n,t.width-=n)}(i,n,this.direction.x))),this.direction.y&&(o.vertical?function(t,e,i){var n=a(i,t.height,!0,e.y);1===i?(t.y-=n,t.height+=2*n):-1===i&&(t.y+=n,t.height-=2*n)}(i,n,this.direction.y):(n.y/=this.ratio,function(t,e,i){var n=a(i,t.height,!1,e.y);1===i?t.height+=n:-1===i&&(t.y+=n,t.height-=n)}(i,n,this.direction.y))),t.assign(i,this.getCorrectXYAfterTransformOriginChange(i)),this.direction.x||delete i.width,this.direction.y||delete i.height,i},this.getLayout=function(e){var i=t.cloneDeep(this.initLayout),o=void 0,r={x:e.x-this.initMouseLocation.x,y:e.y-this.initMouseLocation.y};return r=function(t,e){return n(t,e,{x:0,y:0})}(r,-this.rotationInRad),this.proportional?(!function(t){return t.y===p.NONE&&t.x!==p.NONE}(this.direction)?!function(t){return t.x===p.NONE&&t.y!==p.NONE}(this.direction)?(r=function(t,e,i){var n={x:i.x>0?e.x:e.x+e.width,y:i.y>0?e.y:e.y+e.height},o={x:i.x<0?e.x:e.x+e.width,y:i.y<0?e.y:e.y+e.height},r=(o.y-n.y)/(o.x-n.x),s=r,a=-1,u=n.y-r*n.x,c={x:o.x+t.x,y:o.y+t.y};return{x:(a*(a*c.x-s*c.y)-s*u)/(s*s+1)-o.x,y:(s*(s*c.y-a*c.x)-a*u)/(s*s+1)-o.y}}(r,i,this.direction),o=this.getLayoutAfterStandardResize(i,r)):o=this.getLayoutAfterProportionalVerticalResize(i,r):o=this.getLayoutAfterProportionalHorizontalResize(i,r),o=t.mapValues(o,Math.round)):o=this.getLayoutAfterStandardResize(i,r),o})}var c=180/Math.PI,l=1/c,p={TOP:-1,BOTTOM:1,LEFT:-1,RIGHT:1,NONE:0};return{Drag:s,Rotate:function(e,n,r){e&&(this.initLayout=e,this.initMouseLocation=n,this.center=o(r),this.initMouseAngle=i(this.initMouseLocation,this.center),this.getLayout=function(e){var n=t.clone(this.initLayout),o=i(e,this.center);return n.rotationInDegrees+=(o-this.initMouseAngle)*c,n})},Resize:u,dragLayout:r,resizeLayout:function(t,e,i,n,o){return t?new u(t,e,i,n).getLayout(o):null}}}),define("core/utils/compsSectionsAnalyzer",["lodash"],function(t){"use strict";function e(e,i){return t(i).reject(function(t){return e.components.layout.isPinned(t)}).map(function(t){var i=e.components.layout.get(t);return i.bounding&&(i=i.bounding),i.bottomY=i.y+i.height,{layout:i,comp:t}}).sortBy("layout.y").value()}function i(e,i){return t.filter(e,function(t){return function(t,e){var i=e?g:d;return t.layout.width>=i}(t,i)})}function n(e,i,n){return t.forEach(e,function(e){var o=function(t){return{y:t.position.top,bottomY:t.position.bottom,height:r(t)}}(e),s=t.filter(i,function(t){return function(t,e,i){i=i||1;var n=e.y>=t.y&&e.y<=t.bottomY,o=e.bottomY>=t.y&&e.bottomY<=t.bottomY,r=e.y<=t.y&&e.bottomY>=t.bottomY;return n&&t.bottomY-e.y>=e.height*i||o&&e.bottomY-t.y>=e.height*i||r&&t.height>=e.height*i}(o,t.layout,n)});i=t.difference(i,s),e.comps=t.union(e.comps,t.map(s,"comp"))}),e}function o(t,e){for(var i=[],n=0;n<t.length;n++){var o=t[n],r={position:{top:o.layout.y,bottom:o.layout.bottomY},comps:[]};r.position.top=o.layout.y,r.comps.push(o.comp);for(var s=!1;!s;){var a=t[n+1];!a||a.layout.y>r.position.bottom+e?s=!0:(r.comps.push(a.comp),r.position.bottom=Math.max(r.position.bottom,a.layout.bottomY),n++)}i.push(r)}return i}function r(t){return t.position.bottom-t.position.top}function s(t,e,i){var n=t[e],o=t[i];o.comps=o.comps.concat(n.comps),o.position.top=Math.min(o.position.top,n.position.top),o.position.bottom=Math.max(o.position.bottom,n.position.bottom),t.splice(e,1)}function a(t){for(var e=void 0,i=void 0,n=void 0,o=void 0,a=0;a<t.length;a++)if(o=!1,e=t[a],r(e)<h){n=t[a-1],i=t[a+1];var u=n?e.position.top-n.position.bottom:Number.POSITIVE_INFINITY,c=i?i.position.top-e.position.bottom:Number.POSITIVE_INFINITY;u<c&&u<=m?(s(t,a,a-1),o=!0):c<u&&c<=m&&(s(t,a,a+1),o=!0),o&&a--}return t}function u(t){for(var e=0;e<t.length;){t[e+1]&&t[e+1].position.top<=t[e].position.bottom+f?s(t,e+1,e):e++}return t}function c(t){return t.position.bottom<0}function l(e,i){return t.map(i,function(i){var n=t.some(i.comps,function(t){return!e.components.is.removable(t)});return i.isRemovable=!n,i})}function p(r,s){var p=e(r,r.components.getChildren(s)),d=i(p,r.isMobileEditor()),g=t.difference(p,d),h=o(d,f),m=o(g=function(e,i){var n=t(i).flatMap("comps").keyBy("id").value();return t.reject(e,function(t){return!!n[t.comp.id]})}(g,h=n(h,g,.5)),y);return t(h).union(m).sortBy("position.top").thru(a).thru(u).reject(c).thru(t.partial(l,r)).value()}var d=700,g=300,h=30,m=30,f=-3,y=30;return{analyzeContainer:p,getSortedComponentsWithLayout:e}}),define("core/utils/sectionsReorganizeUtil",["lodash","core/utils/compsSectionsAnalyzer"],function(t,e){"use strict";function i(t){return t.position.top}function n(t){return t.position.bottom-t.position.top}function o(e,i,n){t.forEach(i,function(t){var i=e.components.layout.get(t);e.components.layout.update(t,{y:i.y+n},!0)})}function r(e,i){var o=t.clone(e.position),r=t.clone(i.position),s=n(e),a=n(i),u=s-a;e.position.top=r.top-u,e.position.bottom=e.position.top+s,i.position.top=o.top,i.position.bottom=i.position.top+a}function s(e,i,n){var o=t.findIndex(e,i),r=t.findIndex(e,n);e[o]=n,e[r]=i}function a(t,e,i){e.position.top+=i,e.position.bottom+=i,e.comps&&o(t,e.comps,i)}function u(i,n){n=n||i.pages.getFocusedPage();var o=e.analyzeContainer(i,n),r=i.components.layout.getRelativeToScreen(n);return t.forEach(o,function(t){t.position.top+=r.y,t.position.bottom+=r.y}),i.isMobileEditor()?(o=t.union(function(i,n){var o=i.documentServices.siteSegments.getSiteStructure(n),r=t.filter(i.documentServices.components.get.byType("wysiwyg.viewer.components.SiteRegionContainer",o)||[],i.documentServices.components.is.exist);if(!r.length)return[];var s=e.getSortedComponentsWithLayout(i,r);return t.map(s,function(t){return{position:{top:t.layout.y,bottom:t.layout.bottomY},comps:[t.comp],isStaticSection:!0}})}(i,"MOBILE"),o),t.sortBy(o,"position.top")):o}return{addSectionByPosition:function(e,i){var n=t.findIndex(e,function(t){return t.position.top>i.position.top});return n?e.splice(n,0,i):e.push(i),e},getSectionSizeForBI:function(t){return t>500?"large":t>61?"medium":"small"},getPageSections:u,getHeaderSection:function(t){var e=t.components.layout.getRelativeToScreen(t.documentServices.siteSegments.getHeader());return{position:{top:e.y,bottom:e.height}}},duplicateSection:function(t,e,i){for(var o=e[i],r=t.components.layout.getRelativeToStructure(o.comps),s=n(o),u=i+1;u<e.length;u++)a(t,e[u],s);var c=t.copyPaste.duplicate(o.comps);t.documentServices.waitForChangesApplied(function(){t.components.layout.updateRelativeToStructure(c,{x:r.x,y:o.position.bottom})})},deleteSection:function(t,e,i){for(var o=e[i],r=n(o),s=i+1;s<e.length;s++)a(t,e[s],-1*r);return t.components.remove(o.comps)},shiftSection:a,switchSectionsByDrag:function(t,e,n,a){var u=void 0,c=void 0;n.position.top<a.position.top?(u=n,c=a):(u=a,c=n);var l=i(u),p=i(c);r(u,c),s(e,u,c),a===c?o(t,a.comps,i(c)-p):o(t,a.comps,i(u)-l)},switchSections:function(t,e,n,a){var u=i(n),c=i(a);r(n,a),s(e,n,a),o(t,a.comps,i(a)-c),o(t,n.comps,i(n)-u)},isAtSectionsSwitchPoint:function(t,e,i){var o=n(e),r=e.position.top+o/2;return 1===i?t.y+t.height>=r:t.y<=r}}}),define("core/utils/mouseMoveActions/sectionDrag",["lodash","core/utils/layoutTransitionsUtil","core/utils/sectionsReorganizeUtil","constants"],function(t,e,i,n){"use strict";function o(t,e){return t.clientY+h.ui.scroll.getScroll().scrollTop/(e||1)}function r(t){var e={x:0,y:t},i=v.getLayout(e);return i.y=Math.max(i.y,I),i}function s(e){for(var i=v.getBoundComponentLayouts(e),n=0;n<f.comps.length;n++)h.components.layout.updateRelativeToScreen(f.comps[n],t.pick(i[n],"y"),!0)}function a(e,n){var o=function(t){return t>y?1:-1}(e);y=e;var r=t.findIndex(m,f)+o;if(r>=m.length||r<0)return!1;var s=m[r];return!(!s||!i.isAtSectionsSwitchPoint(n,s,o))&&(i.switchSectionsByDrag(h,m,f,s),t.defer(c),!0)}function u(t,e){return e.position.top<t.position.bottom}function c(){var e=t.findIndex(m,f),n=m[e-1],o=m[e+1],r=0,s=0;if(o&&u(f,o)&&(s=f.position.bottom-o.position.top),n&&u(n,f)&&(s+=r=n.position.bottom-f.position.top),r&&i.shiftSection(h,f,r),s)for(var a=e+1;a<m.length;a++)i.shiftSection(h,m[a],s)}function l(i,n){if(T=!1,P=!0,h=i,f=n.draggedSection){var r={x:0,y:o(n.evt,h.getSiteScale())};y=r.y,m=t.sortBy(n.sections,"position.top"),S=n.onDragEnd,C=n.onDragStart,I=n.minY||0;var s={y:f.position.top,height:f.position.bottom-f.position.top},a=t.map(f.comps,function(t){return h.components.layout.getRelativeToScreen(t)});v=new e.Drag(s,r,a)}}function p(e){if(f)if(P)P=!1,function(){var e=t.map(f.comps,"id");t.isEmpty(e)||(h.documentServices.renderPlugins.setCompsToShowOnTop(e),h.documentServices.renderPlugins.setCompsToShowWithOpacity(e,.5)),t.isFunction(C)&&C(),window.setTimeout(function(){c(),T=!0},g)}();else if(T){var i=o(e,h.getSiteScale()),n=r(i);s(n),a(i,n)}}function d(e){var i=o(e);f&&!P&&(!function(t){var e=r({y:t,x:0});e.y=f.position.top,s(e)}(i),h.history.add("Dragged Components Section"),h.documentServices.renderPlugins.setCompsToShowOnTop(null),h.documentServices.renderPlugins.setCompsToShowWithOpacity(null)),t.isFunction(S)&&S(f)}var g=0,h=void 0,m=void 0,f=void 0,y=void 0,P=void 0,v=void 0,S=void 0,C=void 0,T=void 0,I=void 0;return{start:l,on:p,end:d,type:n.MOUSE_ACTION_TYPES.SECTION_DRAG}}),define("core/utils/AddPanelSectionDragHandler",["lodash","core/utils/AddPanelDragHandler","core/utils/mouseMoveActions/sectionDrag","core/utils/sectionsReorganizeUtil"],function(t,e,i,n){"use strict";function o(t,i,n,o,r,s,a){e.call(this,t,i,n,o,r,s,a)}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,t.assign(o.prototype,{init:t.noop,getFixedDragPosition:function(t){return{x:t.clientX,y:t.clientY}},handleDragOutsidePanelArea:function(t){var e=this.getDragBoxStageLayout();this.handleSectionDrag(t,e)},handleDragInPanelArea:function(){this.cancelSectionDragIfNeeded()},handleSectionDrag:function(t,e){this.isSectionDrag||(this.initSectionDrag(t,e),this.isSectionDrag=!0),this.draggedSection.layout.y=e.y,i.on(t)},initSectionDrag:function(e,o){this.draggedSection=function(e,i){var n=function(t){var e=t.pages.getFocusedPage();return t.components.layout.getRelativeToScreen(e)}(e),o=Math.max(n.y-i.y,0);return{origin:"addPanel",comps:[],layout:t.pick(i,["y","height"]),position:{top:i.y+o,bottom:i.y+i.height+o}}}(this.editorAPI,o);var r=n.getPageSections(this.editorAPI);r=n.addSectionByPosition(r,this.draggedSection),this.editorAPI.setPageSections(r,null),i.start(this.editorAPI,{sections:r,evt:e,draggedSection:this.draggedSection})},cancelSectionDragIfNeeded:function(){this.isSectionDrag&&(this.isSectionDrag=!1,this.editorAPI.history.add("sections reorganize"),this.editorAPI.history.undo(),this.editorAPI.clearPageSections())},clearDrag:function(){this.isSectionDrag&&this.editorAPI.clearPageSections()},getDropContainer:function(){return this.editorAPI.pages.getFocusedPage()},getCompPositionRelativeToContainer:function(t,i){var n=e.prototype.getCompPositionRelativeToContainer.call(this,t,i),o=this.draggedSection.position.top-this.draggedSection.layout.y;return n.y+=o,n}}),o}),define("core/utils/layoutConstraintsUtil/boundariesConstraintsUtil",["lodash"],function(t){"use strict";function e(e,i,n){!function(e,i,n){var o=i.x,r=i.x+i.width,s=e.left;s&&(t.isNumber(s.compLeftX)&&(n.x&&o<s.compLeftX&&(i.x+=s.compLeftX-o),n.width&&o<s.compLeftX&&(i.width-=s.compLeftX-o)),t.isNumber(s.compRightX)&&(n.x&&r<s.compRightX&&(i.x+=s.compRightX-r),n.width&&r<s.compRightX&&(i.width+=s.compRightX-r)))}(e,i,n),function(e,i,n){var o=i.x,r=i.x+i.width,s=e.right;s&&(t.isNumber(s.compRightX)&&(n.x&&r>s.compRightX&&(i.x+=s.compRightX-r),n.width&&r>s.compRightX&&(i.width+=s.compRightX-r)),t.isNumber(s.compLeftX)&&(n.x&&o>s.compLeftX&&(i.x+=s.compLeftX-o),n.width&&o>s.compLeftX&&(i.width-=s.compLeftX-o)))}(e,i,n)}function i(e,i,n){!function(e,i,n){var o=i.y,r=i.y+i.height,s=e.top;s&&(t.isNumber(s.compTopY)&&(n.y&&o<s.compTopY&&(i.y+=s.compTopY-o),n.height&&o<s.compTopY&&(i.height-=s.compTopY-o)),t.isNumber(s.compBottomY)&&(n.y&&r<s.compBottomY&&(i.y+=s.compBottomY-r),n.height&&r<s.compBottomY&&(i.height+=s.compBottomY-r)))}(e,i,n),function(e,i,n){var o=i.y,r=i.y+i.height,s=e.bottom;s&&(t.isNumber(s.compBottomY)&&(n.y&&r>s.compBottomY&&(i.y+=s.compBottomY-r),n.height&&r>s.compBottomY&&(i.height+=s.compBottomY-r)),t.isNumber(s.compTopY)&&(n.y&&o>s.compTopY&&(i.y+=s.compTopY-o),n.height&&o>s.compTopY&&(i.height-=s.compTopY-o)))}(e,i,n)}function n(n,o,r,s,a){var u=function(e,i){return t(e).pick(["x","y","width","height"]).pickBy(function(e,n){return!t.isEqual(e,i[n])}).mapValues(function(t,e){return e}).value()}(s,a);(n.left||n.right)&&e(n,s,u),(n.top||n.bottom)&&i(n,s,u)}return{applyBoundariesConstraintOnLayout:n}}),define("core/utils/layoutConstraintsUtil/LayoutConstraintsUtil",["lodash","core/utils/layoutConstraintsUtil/boundariesConstraintsUtil"],function(t,e){"use strict";function i(i,n,o){return t(o).filter(function(e){return function(e){return t.isFunction(e.applyConstraint)||t.isFunction(e.getBoundaries)}(e)&&(!t.isFunction(e.shouldConstrain)||e.shouldConstrain(i,n))}).map(function(o){var r=t.clone(o);return r.applyConstraint||(r.applyConstraint=e.applyBoundariesConstraintOnLayout.bind(null,r.getBoundaries(i,n))),r}).value()}function n(t,e,n){this.constraintsToApply=i(t,e,n)}return n.prototype.applyConstraints=function(e,i,n,o){var r=t.assign({},o,n);t.forEach(this.constraintsToApply,function(t){t.applyConstraint(e,i,r,o)}),t.assign(n,t.pick(r,t.keys(n)))},n.prototype.getConstraintArea=function(e,i){var n=t(this.constraintsToApply).filter(function(e){return t.isFunction(e.getConstraintArea)}).invokeMap("getConstraintArea",e,i).compact().flatten().value();return t.isEmpty(n)?null:n},n.prototype.hasConstraints=function(){return!t.isEmpty(this.constraintsToApply)},n}),define("core/utils/layoutConstraintsUtil/layoutConstraints/stretchToScreenConstraints",["lodash","stateManagement"],function(t,e){"use strict";function i(e,i,r,s){var a=e.store.getState(),u=n(a).width,c=function(e,i){return t(e).pick(["x","y","width","height"]).pickBy(function(e,n){return!t.isEqual(e,i[n])}).mapValues(function(t,e){return e}).value()}(r,s),l=void 0;if(c.x){var p=r.x,d=o;(l=t.min([d-p,0]))&&(r.x+=l)}if(c.width){var g=r.x+r.width,h=u-o;(l=t.max([h-g,0]))&&(r.width+=l)}}var n=e.editorPlugins.domMeasurements.selectors.getPreviewPosition,o=80;return{shouldConstrain:function(t,e){return t.components.layout.isHorizontallyStretchedToScreen(e)},applyConstraint:i}}),define("core/utils/layoutConstraintsUtil/layoutConstraints/constraintsUtil",["lodash"],function(t){"use strict";return{isShownOnAllPagesComponent:function(e,i){var n=t.isArray(i)?i:[i];return t.some(n,function(t){return e.components.isShowOnAllPages(t)&&!e.utils.isSameRef(t,e.documentServices.siteSegments.getFooter())})}}}),define("core/utils/layoutConstraintsUtil/layoutConstraints/mobileBoundariesConstraints",["lodash","core/utils/layoutConstraintsUtil/layoutConstraints/constraintsUtil","stateManagement","constants"],function(t,e,i,n){"use strict";function o(t,e){var i=t.siteSegments[e].call(t.siteSegment);return t.components.layout.getRelativeToScreen(i)}function r(t,e){return{left:t.x,width:t.width,height:t.height-e.height}}function s(e,i){var n=o(e,d.HEADER);return t.assign(r(i,n),{top:i.y+n.height})}function a(t,e){return t.utils.isSameRef(e,t.documentServices.siteSegments.getHeader())}function u(t,e){return t.utils.isSameRef(e,t.documentServices.siteSegments.getFooter())}function c(t,e){return"SiteRegionContainer"===g.getCompTypeSuffix(e,t.documentServices)}function l(t){var e=o(t,d.SITE_STRUCTURE);return{top:{compBottomY:n.SIZE_LIMITS.MOBILE_DRAG_CONSTRAINT_MARGINS},bottom:{},left:{compRightX:e.x+n.SIZE_LIMITS.MOBILE_DRAG_CONSTRAINT_MARGINS},right:{compLeftX:e.x+e.width-n.SIZE_LIMITS.MOBILE_DRAG_CONSTRAINT_MARGINS}}}function p(t,e){var i=t.components.getType(e);return m[i]||h}var d={SITE_STRUCTURE:"getSiteStructure",HEADER:"getHeader",FOOTER:"getFooter"},g=i.editorPlugins.components.selectors,h={getBoundaries:function(i,n){var r=i.components.getContainer(n);if(c(i,r))return function(t,e){var i=t.components.layout.getRelativeToScreen(e);return{top:{compTopY:i.y},bottom:{compBottomY:i.y+i.height},left:{compLeftX:i.x},right:{compRightX:i.x+i.width}}}(i,r);var s=l(i);if(!e.isShownOnAllPagesComponent(i,n))return t.assign(s.bottom,{compBottomY:5e5}),s;var p=o(i,d.FOOTER);if(t.assign(s.bottom,{compBottomY:p.y+p.height}),a(i,r)){var g=o(i,d.HEADER);return t.assign(s.bottom,{compBottomY:g.height}),s}return u(i,r)&&t.assign(s.top,{compTopY:p.y}),s},getConstraintArea:function(i,n){var l=i.components.getContainer(n),p=o(i,d.SITE_STRUCTURE);return c(i,l)?function(e,i,n){var s=o(e,d.HEADER),a={left:s.x,width:s.width,height:s.height,top:s.y},u=e.components.layout.getRelativeToScreen(n),c=t.assign(r(i,u),{top:i.y+u.height+u.y});return t.concat(a,c)}(i,p,l):e.isShownOnAllPagesComponent(i,n)?a(i,l)?s(i,p):u(i,l)?function(e,i){var n=o(e,d.FOOTER);return t.assign(r(i,n),{bottom:i.y+n.y})}(i,p):null:null}},m={"wysiwyg.viewer.components.HeaderContainer":{getBoundaries:function(e,i){var o=e.documentServices.components.getChildren(t.isArray(i)?i[0]:i),r=l(e);return t.isEmpty(o)?r:t.assign(r,{top:{compBottomY:n.SIZE_LIMITS.MOBILE_HEADER_MIN_HEIGHT}})},getConstraintArea:function(){return null}},"wysiwyg.viewer.components.mobile.TinyMenu":{getBoundaries:function(t){var e=o(t,d.SITE_STRUCTURE),i=o(t,d.HEADER);return{top:{compTopY:e.y},bottom:{compBottomY:i?Math.min(i.height,n.SIZE_LIMITS.FIXED_TINY_MENU_MAX_Y):n.SIZE_LIMITS.FIXED_TINY_MENU_MAX_Y},left:{compLeftX:e.x},right:{compRightX:e.x+e.width}}},getConstraintArea:function(e){var i=o(e,d.SITE_STRUCTURE),r=o(e,d.HEADER),a=s(e,i);return t.assign(a,{top:i.y+Math.min(n.SIZE_LIMITS.FIXED_TINY_MENU_MAX_Y,r.height)}),a}}};return{shouldConstrain:function(t){return t.isMobileEditor()},getConstraintArea:function(t,e){return p(t,e).getConstraintArea(t,e)},getBoundaries:function(t,e){return p(t,e).getBoundaries(t,e)}}}),define("core/utils/layoutConstraintsUtil/layoutConstraints/desktopBoundariesConstraints",["lodash","core/utils/layoutConstraintsUtil/layoutConstraints/constraintsUtil","experiment"],function(t,e,i){"use strict";function n(t,n){var s={};return s.top=i.isOpen("removeDesktopTopConstraintExp")?{compBottomY:o}:{compTopY:0},t.isCurrentPageLandingPage()||(s.bottom={compBottomY:function(t,i){if(e.isShownOnAllPagesComponent(t,i)&&(!t.siteSegments.isUsingSectionsLayout()||!function(t,e){var i=t.siteSegments.getSiteStructure();return t.utils.isSameRef(t.components.getContainer(e),i)}(t,i))){var n=t.components.layout.getRelativeToScreen(t.documentServices.siteSegments.getFooter());return n.y+n.height}return r}(t,n)}),s}var o=20,r=5e5;return{shouldConstrain:function(t){return!t.isMobileEditor()},getBoundaries:n}}),define("core/utils/layoutConstraintsUtil/layoutConstraints/repeaterElementsBoundariesConstraints",["stateManagement"],function(t){"use strict";var e=t.editorPlugins.components.selectors,i=20;return{shouldConstrain:function(t,i){return t.isMobileEditor()&&t.components.is.descendantOfRepeaterItem(i)&&!e.isRepeaterItem(i,t.documentServices)},getBoundaries:function(t,e){var n=t.components.getAncestorRepeaterItem(e),o=t.components.layout.getRelativeToScreen(e),r=t.components.layout.getRelativeToScreen(n);return{left:{compLeftX:r.x-o.width+i},right:{compRightX:r.x+r.width+o.width-i},top:{compTopY:r.y},bottom:{compBottomY:r.y+r.height}}}}}),define("core/utils/layoutConstraintsUtil/editorConstraintsRegistry",["core/utils/layoutConstraintsUtil/layoutConstraints/stretchToScreenConstraints","core/utils/layoutConstraintsUtil/layoutConstraints/mobileBoundariesConstraints","core/utils/layoutConstraintsUtil/layoutConstraints/desktopBoundariesConstraints","core/utils/layoutConstraintsUtil/layoutConstraints/repeaterElementsBoundariesConstraints"],function(t,e,i,n){"use strict";return[t,e,i,n]}),define("core/utils/layoutConstraintsUtil/EditorLayoutConstraintsUtil",["core/utils/layoutConstraintsUtil/LayoutConstraintsUtil","core/utils/layoutConstraintsUtil/editorConstraintsRegistry"],function(t,e){"use strict";function i(i,n){t.call(this,i,n,e)}return i.prototype=t.prototype,i}),define("core/utils/updateLayoutUtil",["lodash","core/utils/layoutConstraintsUtil/EditorLayoutConstraintsUtil"],function(t,e){"use strict";function i(e,i,n,o){if(!e)return e;var r=t.pick(e,["width","height"]);return t.isNumber(e.x)&&(r.x=i.x+e.x,n&&(r.x+=o)),t.isNumber(e.y)&&(r.y=i.y+e.y),r}function n(e,i){return t.some(e,function(e,n){return!t.isEqual(e,i[n])})}function o(o,r,s,a){if(n(s,a)&&!o.utils.isPage(r)){var u=new e(o,r);if(u.hasConstraints()){var c=o.components.layout.isHorizontallyStretchedToScreen(r),l=o.site.getSiteX(),p=function(t,e){var i=t.components.getContainer(e);return t.components.layout.getRelativeToScreen(i)}(o,r),d=i(s,p,c,l),g=i(a,p,c,l);u.applyConstraints(o,r,d,g);var h=function(e,i,n,o){if(!e)return e;var r=t.pick(e,["width","height"]);return t.isNumber(e.x)&&(r.x=e.x-i.x,n&&(r.x-=o)),t.isNumber(e.y)&&(r.y=e.y-i.y),r}(d,p,c,l);t.assign(s,t.pick(h,t.keys(s)))}}return s}return{getLayoutAfterConstraints:o,getLayoutRelativeToScreenAfterConstraints:function(t,i,o,r){if(n(o,r)&&!t.utils.isPage(i)){var s=new e(t,i);s.hasConstraints()&&s.applyConstraints(t,i,o,r)}return o}}}),define("core/utils/updateDataUtil",["lodash","core/utils/updateDataPlugins/updateDataPlugins"],function(t,e){"use strict";function i(n){return e[n.type]&&e[n.type](n),t.forEach(n,function(e){t.isPlainObject(e)&&e.type&&i(e)}),n}return{fixData:i}}),define("core/utils/updatePropertiesPlugins/plugins/wPhotoPropertiesPlugin",["lodash"],function(t){"use strict";return function(e,i,n,o){return o||function(e,i,n){var o=t.pick(e,"effectName");if(!t.isEmpty(o)){var r=n.viewMode.VIEW_MODES.MOBILE,s=n.components.getPage(i).id,a=n.components.get.byId(i.id,s,r);a&&n.components.is.exist(a)&&n.components.properties.mobile.isForked(a)&&n.components.properties.update(a,o)}}(e,i,n),e}}),define("core/utils/updatePropertiesPlugins/updatePropertiesPlugins",["core/utils/updatePropertiesPlugins/plugins/wPhotoPropertiesPlugin"],function(t){"use strict";return{WPhotoProperties:t}}),define("core/utils/updatePropertiesUtil",["lodash","core/utils/updatePropertiesPlugins/updatePropertiesPlugins"],function(t,e){"use strict";return{fixProperties:function(t,i,n,o){var r=t.type||"DefaultProperties";return e[r]&&e[r](t,i,n,o),t}}}),define("core/utils/DragConstraintsHandler",["lodash","core/utils/layoutConstraintsUtil/EditorLayoutConstraintsUtil"],function(t,e){"use strict";function i(t,i){if(t){this.editorAPI=t,this.comp=i;var n=new e(t,i);this.constraintArea=n.getConstraintArea(t,i)}}return i.prototype.highlightDragConstraints=function(){this.editorAPI.setConstraintArea(this.constraintArea)},i.prototype.removeHighlightDragConstraints=function(){this.editorAPI.setConstraintArea(null)},i}),define("core/utils/compControlsMeasurer",["lodash","zepto","constants"],function(t,e,i){"use strict";function n(t){return{y:t.y,x:t.x,width:t.width,height:t.height,bottomY:t.y+t.height,rightX:t.x+t.width}}function o(t,e){var i=e.viewPortForChildOfFocused||e.viewPort;return t.y>=i.y?P.COMP_TOP:t.bottomY<=i.bottomY?P.COMP_BOTTOM:P.VIEWPORT_TOP}function r(t,i,n){var o=i.viewPort,r=o.bottomY-t.y,s=t.bottomY-o.y,a=n?e(n).height():0,u=t.y<o.y,c=a<=r,l=t.bottomY>o.bottomY,p=a<=s,d=a<=o.bottomY-o.y;return u||!d?P.VIEWPORT_TOP:c?P.COMP_TOP:l?P.VIEWPORT_BOTTOM:p?P.COMP_BOTTOM:P.VIEWPORT_TOP}function s(t,e,i){return{gfpp:o(t,e),compPanel:r(t,e,i)}}function a(t,e,i,n,o){var r=Math.max(f,o&&o.top||0)+n,s=n+f,a=Math.max(f,o&&o.bottom||0);switch(t){case P.COMP_TOP:return Math.max(e.y-r,i.y-s);case P.COMP_BOTTOM:return e.bottomY+a;case P.VIEWPORT_TOP:return i.y-s}}function u(t,e,i,n){switch(t){case P.COMP_BOTTOM:return e.bottomY-n;case P.COMP_TOP:return e.y;case P.VIEWPORT_BOTTOM:return i.bottomY-n}return i.y}function c(t,e,i,n,o){if(m(e,i.width)){return Math.max(o,i.x)}switch(t){case P.COMP_LEFT:return e.x;case P.VIEWPORT_LEFT:return i.x;case P.VIEWPORT_RIGHT:return i.rightX-n}}function l(t,i,n,o,s){var l=s.gfppSize,p=s.viewPort,d=s.rotateKnobMargins,g=s.pageXBoundary,h=s.alignToPageBoundaries,v={gfpp:{top:0,left:0},compPanel:{top:0,left:0}},S=l.height,C=l.width,T=o?e(o).height():0,I=o?e(o).width():0;if(v.gfpp.top=a(t.gfpp,n,p,S,d),v.gfpp.left=c(i.gfpp,n,p,C,g),h||m(n,p.width)){var x=Math.max(g,p.x),A=function(t,i,n,o,s,a,c){var l={left:0,top:0},p=n?e(n).height():0,d=n?e(n).width():0;if(0===d||0===p)return{left:0,top:0};var g=u(r(t,{viewPort:i},n),t,i,p),h=d<=s-i.x,m=p<=i.bottomY-c,v=a===P.COMP_TOP&&p<=c-i.y-y,S=a===P.COMP_BOTTOM&&p<=i.bottomY-(c+o)-y;h?(l.left=s-(d+y/2),l.top=m?c:i.bottomY-p):v?(l.left=s,l.top=c-(p+f)):S?(l.left=s,l.top=c+o+f):(l.left=i.rightX-d,l.top=g);return l}(n,p,o,l.height,x,t.gfpp,v.gfpp.top);v.compPanel=A}else v.compPanel.top=u(t.compPanel,n,p,T),v.compPanel.left=function(t,e,i,n,o,r,s){var a=e.rightX-e.x;switch(t){case P.COMP_LEFT:return e.x-n-Math.max(y,s&&s.left||0);case P.COMP_RIGHT:return e.x+a+Math.max(y,s&&s.right||0);case P.VIEWPORT_LEFT:return i.x;case P.VIEWPORT_RIGHT:return i.rightX-n-y;case P.GFPP_LEFT:return r-n-y;case P.GFPP_RIGHT:return r+o+y}}(i.compPanel,n,p,I,C,v.gfpp.left,d);return v}function p(t,e,i){return t.x>=e.x?i+t.x<=e.rightX?P.COMP_LEFT:P.VIEWPORT_RIGHT:P.VIEWPORT_LEFT}function d(t,e,n){var o={},r=function(t){var e=t.x+i.UI.CUSTOM_GFPP_POS.X_OFFSET_FROM_CLICK,n=t.y;return{y:n,x:e,width:0,height:0,bottomY:n,rightX:e}}(t),u=s(r,{viewPort:e}).gfpp,l=p(r,e,n.width);return o.top=a(u,r,e,n.height),o.left=c(l,r,e,n.width,0),o}function g(t,n,o,r){var s=r.gfppSize,a=r.viewPort,u=r.navControlsSize,c=s.width,l=o?e(o).width():0,d=t.rightX-t.x,g={},h=void 0,m=void 0;return g.gfpp=p(t,a,c),g.navControls=function(t,e,n){return t.x>=e.x?n+t.x+i.UI.NAVIGATION_CONTROLS_POS.LEFT<=e.rightX?P.COMP_LEFT:P.VIEWPORT_RIGHT:P.VIEWPORT_LEFT}(t,a,u.width),n.gfpp===n.compPanel?(h=t.rightX+l+y<=a.rightX,m=t.x-l-y>=a.x,t.rightX<a.x?g.compPanel=P.VIEWPORT_LEFT:g.compPanel=h?P.COMP_RIGHT:m?P.COMP_LEFT:P.VIEWPORT_RIGHT):g.gfpp===P.COMP_LEFT?c<=d?(h=t.x+d+y+l<a.rightX,m=t.x-y-l>=a.x,g.compPanel=h?P.COMP_RIGHT:m?P.COMP_LEFT:P.VIEWPORT_RIGHT):(m=t.x-y-l>=a.x,g.compPanel=m?P.COMP_LEFT:P.GFPP_RIGHT):g.gfpp===P.VIEWPORT_RIGHT?g.compPanel=P.GFPP_LEFT:g.gfpp===P.VIEWPORT_LEFT&&((h=Math.max(a.x+c,t.x+d)+l<=a.rightX)?a.x+c>t.x+d?g.compPanel=P.GFPP_RIGHT:g.compPanel=P.COMP_RIGHT:g.compPanel=P.VIEWPORT_RIGHT),g}function h(t,e,n){var o=s(t,n,e),r=g(t,o,e,n),a=l(o,r,t,e,n),u=function(t,e,n,o){var r=o.navControlsSize,s=o.viewPort,a=o.pageXBoundary,u={};if(m(n,s.width)){var c=Math.max(a,s.x);u.left=c-n.x+i.UI.NAVIGATION_CONTROLS_POS.LEFT}else switch(e.navControls){case P.VIEWPORT_LEFT:u.left=s.x-n.x+i.UI.NAVIGATION_CONTROLS_POS.LEFT;break;case P.VIEWPORT_RIGHT:u.left=s.rightX-(n.x+r.width+i.UI.NAVIGATION_CONTROLS_POS.LEFT);break;case P.COMP_LEFT:u.left=i.UI.NAVIGATION_CONTROLS_POS.LEFT}switch(t.gfpp){case P.COMP_BOTTOM:u.top=i.UI.NAVIGATION_CONTROLS_POS.BOTTOM;break;case P.COMP_TOP:case P.VIEWPORT_TOP:u.top=i.UI.NAVIGATION_CONTROLS_POS.TOP}return u}(o,r,t,n),c=function(t,e){return e.navControlsSize.width?t.left+e.navControlsSize.width+i.UI.MARGIN_BETWEEN_FOCUS_TAB_AND_COMP_LABELS:0}(u,n);return{gfppStyle:a.gfpp,compPanelStyle:a.compPanel,navControlsStyle:u,editBoxLabelsOffset:c}}function m(t,e){return t.x<1&&t.width>=e}var f=void 0,y=i.UI.compPanelMargins,P={COMP_TOP:"compTop",COMP_BOTTOM:"compBottom",COMP_LEFT:"compLeft",COMP_RIGHT:"compRight",VIEWPORT_TOP:"viewPortTop",VIEWPORT_BOTTOM:"viewPortBottom",VIEWPORT_LEFT:"viewPortLeft",VIEWPORT_RIGHT:"viewPortRight",GFPP_LEFT:"gfppLeft",GFPP_RIGHT:"gfppRight"};return{getCompControlsPositions:function(e,o,r,s,a,u){s=t(s).pickBy().defaults({gfppSize:{width:0,height:0},navControlsSize:{width:0,height:0},pageXBoundary:0,rotateKnobMargins:{},alignToPageBoundaries:!1}).value();var c=void 0,l=void 0,p=n(r.layout),g=e&&e.id!==r.id;if(f=i.UI.gfppMargins,u?f=u:e&&!g?f=i.UI.navControlsGfppMargins:r.hasLabels&&(f=i.UI.componentLabelsGfppMargins),c=e?h(l=n(e.layout),o,s):h(p,o,s),e&&g){var m=function(e,n,o){if(n.height<o.height+2*i.UI.VIEWPORT_VERTICAL_MARGINS)return e;var r={y:Math.max(e.y,n.y+i.UI.VIEWPORT_VERTICAL_MARGINS),height:Math.min(e.height,n.height-2*i.UI.VIEWPORT_VERTICAL_MARGINS),bottomY:Math.min(e.bottomY,n.bottomY-i.UI.VIEWPORT_VERTICAL_MARGINS)};return t.assign({},e,r)}(s.viewPort,l,p),y=h(p,o,t.defaults({viewPortForChildOfFocused:m},s));c.gfppStyle=y.gfppStyle,c.compPanelStyle=y.compPanelStyle,c.editBoxLabelsOffset=0}return a&&(c.gfppStyle=d(a,s.viewPort,s.gfppSize)),c},getGfppPosition:function(t,e,r){f=i.UI.gfppMargins;var s=n(e),u=o(s,{viewPort:r}),l=p(s,r,t.width);return{top:a(u,s,r,t.height),left:c(l,s,r,t.width,0)}}}}),define("core/utils/fixedPositionPlugins/tinyMenuFixedPositionPlugin",["lodash","constants"],function(t,e){"use strict";function i(i,n,o){var r=i.components.layout.getRelativeToStructure(n),s={fixedPosition:o},a=e.SIZE_LIMITS.FIXED_TINY_MENU_MAX_Y;r.y>a&&(!function(e,i){var n=e.components.getContainer(i),o=e.documentServices.siteSegments.getHeader();t.isEqual(n,o)||e.components.setContainer(i,o)}(i,n),t.merge(s,i.mobile.mobileOnlyComponents.getTinyMenuDefaultPosition())),i.components.layout.update(n,s)}return i}),define("core/utils/fixedPositionPlugins/fixedPositionPlugins",["lodash","core/utils/fixedPositionPlugins/tinyMenuFixedPositionPlugin"],function(t,e){"use strict";var i={"wysiwyg.viewer.components.mobile.TinyMenu":e};return{registerPlugin:function(t,e){i[t]=e},setFixedPosition:function(e,n,o){var r=e.components.getType(n);return i[r]&&t.isFunction(i[r])?i[r].call(null,e,n,o):function(t,e,i){t.components.layout.updateFixedPosition(e[0]||e,i)}(e,n,o),o}}}),define("core/utils/social",["lodash","util","require","coreUtilsLib"],function(t,e,i,n){"use strict";function o(t){window.open(t)}var r="https://twitter.com/intent/tweet?url=",s="135c3d92-0fea-1f9d-2ba5-2a1dfb04297e",a="feedb3b8-0b1a-413f-bcab-73e805d0f554",u=t.once(function(e){var i=void 0,n=function(){var t=window.location.hostname.match(/editor\.(.*)/);return t?"www."+t[1]:"www.wix.com"}(),o={appId:i=t.includes(n,"wix.com")?"304553036307597":"394905507233800",status:!0,cookie:!0,xfbml:1};e.init(o)});return{openShoutout:function(t){o(["//www.wix.com/my-account/sites/",t,"/app/",s,"?referralInfo=ed_prem_promo","&appState=%3Fdl%3Dmessage%26messageId%3D",a].join(""))},openTwitter:function(t,i){o(function(e,i,n){return e=decodeURIComponent(e),r+t+"&text="+e+"&related="+i+"&hashtags="+n}(i?e.translate("TWITTER_CHECK_OUT_MY_SITE_MSG_PREMIUM"):e.translate("TWITTER_CHECK_OUT_MY_SITE_MSG_NON_PREMIUM"),e.translate("TWITTER_RELATED_WIX_ACCOUNTS"),e.translate("TWITTER_WIX_HASHTAGS")))},openFacebook:function(o,r,s,a){i(["facebook"],function(i){u(i);var n=function(t){return"http://"+r+".wix.com/html5webbuilder/share?utm_campaign=vir_fb_pub_h_"+r+"&experiment_id="+t.replace(/https?:\/\//,"")}(t.clone(o)),c={method:"feed",name:s,description:a,link:o,actions:[{name:e.translate("FACEBBOK_SHARE_MESSAGE"),link:n}]};i.ui(c)},function(t){n.log.error(t)})}}}),define("core/utils/spotifyUtils",["util"],function(t){"use strict";var e=["tracks","albums","artists"],i=t.url.joinURL(t.editorModel.editorBase,"app/external/SpotifySearch/index.html?id=");return{openIframe:function(t,n,o){var r=t.getLanguageCode(),s="spotifySearch_"+Date.now();n=n||e;var a=t.selection.getSelectedComponentType();t.panelManager.openPanel("panels.focusPanels.spotifySearchFocusPanel",{panelName:"Spotify Search",iframeSrc:function(t,e,n){return i+t+"&lang="+n+"&tabs="+JSON.stringify(e)+"&default_tab="+e[0]+"&fontFaceUrl=https://static.parastorage.com/services/wix-public/1.160.0/css/Helvetica/fontFace.css"}(s,n,r),id:s,selectedComponentType:a,callback:o},!1)},validateSpotifyUri:function(t){return function(t){return t&&0===t.indexOf("spotify:")}(t)&&function(t){var e=t.split(":");return e.length>2&&e[e.length-1].length>0}(t)},validateFollowUri:function(t){return 0===t.toLowerCase().indexOf("spotify:artist:")}}}),define("core/utils/uiControlsBIUtil",["lodash","coreBi"],function(t,e){"use strict";var i=e.CONTROLS_TO_EVENTS;return{getEventDefinition:function(t){return i[t]},getParams:function(e,n){var o=t(i[e].fields).keys().union(["value"]).value();return t(n).pick(o).mapValues(function(t){return"boolean"==typeof t?t.toString():t}).value()}}}),define("core/utils/componentPreviewReadyPlugins/componentPastePlugins",["lodash"],function(t){"use strict";function e(e,i){return t.isEqual(i.controllerRef,e.controllerRef)&&t.isEqual(i.role,e.role)}function i(i,n){var o=function(e,i){var n=i.id&&e.components.get.byId(i.id);return n&&e.components.is.exist(n)?t.omit(i,"id"):i}(i,t.cloneDeep(n)),r=i.documentServices.platform.serialization.getConnectedComponents(o),s=t.transform(r,function(n,o,r){n[r]=function(i,n,o){var r=i.components.get.byId(n,i.documentServices.pages.getFocusedPageId());if(!r)return[];var s=i.documentServices.platform.controllers.connections.get(r);return t.reject(o,function(i){return t.find(s,t.partial(e,i))})}(i,r,o)},{});return i.documentServices.platform.serialization.setConnectedComponents(o,s)}var n="platform.components.AppController";return{removeConnectedComponentsIfAlreadyExist:i,removeSerializedDataId:function(e,i){return i.componentType===n?i:t.omit(i,"id")}}}),define("core/utils/componentPreviewReadyPlugins/componentPreviewReadyPlugins",["lodash","core/utils/componentPreviewReadyPlugins/formPlugin","core/utils/componentPreviewReadyPlugins/componentPastePlugins"],function(t,e,i){"use strict";return[function(i,n){var o=n.components.get.byType(i);t.forEach(o,function(i){var o=n.components.data.get(i),r=t.clone(o);e.updateDataWithDefaults(o,n),t.isEqual(o,r)||n.components.data.update(i,o)})}.bind(null,["wysiwyg.viewer.components.ContactForm","wysiwyg.viewer.components.DynamicContactForm","wysiwyg.common.components.subscribeform.viewer.SubscribeForm"]),function(t){t.registerPasteComponentPlugin("platform.components.AppController",i.removeConnectedComponentsIfAlreadyExist),t.registerPasteComponentPlugin("*",i.removeSerializedDataId)}]}),define("core/utils/pageUtils/blogTypeUtils",[],function(){"use strict";var t={isBlog:function(t,e){return!!e.appInnerID&&"blog"===t.documentServices.wixapps.classics.getPackageName(e.appInnerID)},isBlogSpecialPage:function(t){return"7326bfbb-4b10-4a8e-84c1-73f776051e10"===t.appPageId},isBlogSectionPage:function(e,i){return t.isBlog(e,i)&&!t.isBlogSpecialPage(i)}};return t}),define("core/utils/pageUtils/dynamicTypeUtils",["lodash"],function(t){"use strict";function e(e,i){return t.isObject(function(e,i){var n=t.get(i,"id")&&e.documentServices.pages.getReference(i.id);return n&&e.documentServices.routers.getRouterRef.byPage(n)}(e,i))}return{isDynamicPage:e}}),define("core/utils/pageUtils/tpaTypeUtils",[],function(){"use strict";var t={isTPA:function(t){return!!t.tpaApplicationId},isTPASpecialPage:function(e,i,n){if(!t.isTPA(i))return!1;var o=e.pages.isContainsCompWithType(i.id,e.tpa.constants.COMP_TYPES.TPA_MULTI_SECTION),r=!n||!e.routers.getRouterDataForPageIfExist(i.id);return o&&r},isPageNotVisibleInPagesMenu:function(t,e){return t.tpa.isPageMarkedAsHideFromMenu(e.tpaApplicationId,e.tpaPageId)}};return t}),define("core/utils/pageUtils/wixStoreTypeUtils",["lodash","core/utils/pageUtils/tpaTypeUtils"],function(t,e){"use strict";function i(t,i,n){return function(t,i){if(e.isTPA(i)){var n=t.documentServices.tpa.section.getPageData(i.id).appData;return n&&n.appDefinitionId}}(i,n)===t}function n(t,e){return e.tpaPageId===t}var o={PRODUCT_PAGE:"product_page",SHOPPING_CART_PAGE:"shopping_cart",THANK_YOU_PAGE:"thank_you_page"};return{isWixStore:t.partial(i,"1380b703-ce81-ff05-f115-39571d94dfcd"),isWixStoreCartPage:t.partial(n,o.SHOPPING_CART_PAGE),isWixStoreThankYouPage:t.partial(n,o.THANK_YOU_PAGE),isWixStoreProductPage:t.partial(n,o.PRODUCT_PAGE)}}),define("core/mixins/editorAPIMixin",["prop-types"],function(t){"use strict";return{contextTypes:{editorAPI:t.object},getEditorAPI:function(){return this.context.editorAPI}}}),define("core/app/lazyComponent",["react","create-react-class","lodash","coreUtilsLib"],function(t,e,i,n){"use strict";var o={},r={};return e({displayName:"LazyLoader",statics:{isLoaded:function(t){return i.has(o,t)}},componentWillMount:function(){},componentWillReceiveProps:function(t){this.props.moduleName!==t.moduleName&&(r[this.props.moduleName]=i.without(r[this.props.moduleName],this))},componentWillUnmount:function(){r[this.props.moduleName]=i.without(r[this.props.moduleName],this)},render:function(){var e=this.props.moduleName;if(e&&!o.hasOwnProperty(e)){var s=function(t){return t.split(".")[0]}(this.props.moduleName),a=function(t){return t.split(".").slice(1)}(this.props.moduleName);if(require.defined(s)){var u=i.get(require(s),a);u?o[e]=u:n.log.warn("(lazyComponent.js) -> Module [["+e+"]] has not yet loaded. It is possible that this has not yet been implemented in the editor.")}else r.hasOwnProperty(e)||(r[e]=[]),i.includes(r[e],this)||r[e].push(this),require([s],function(t,e,s){for(var a=s,u=0;u<e.length;u++){if(!a.hasOwnProperty(e[u]))return void n.log.warn("(lazyComponent.js) -> Module [["+t+"]] has not yet loaded. It is possible that this has not yet been implemented in the editor.");a=a[e[u]]}o[t]=a,i.forEach(r[t],function(t){i.has(t.props,"onModuleLoaded")?t.props.onModuleLoaded():t.forceUpdate()})}.bind(null,e,a))}if(!this.props.placeHolder&&o[e]){var c=i.omit(this.props,["moduleName","onModuleLoaded"]);return t.createElement(o[e],c)}return null}})}),define("core/app/styleManager",["lodash"],function(t){"use strict";function e(e,i){return t.isEqual(e,i)}function i(e){var i=e.styles.getAllIds();return t.map(i,e.styles.get)}function n(e,n,o){var r=i(e);return t.filter(r,function(e){return(e.componentClassName===n||o&&o.length>0&&t.includes(o,e.componentClassName))&&"custom"===e.styleType})}function o(e,i){var n=function(e,i){var n=t.find(e,function(t){return t.styles[i]});return n&&n.styles[i]}(e,i);return n?{id:i,compId:"",componentClassName:"",pageId:"",styleType:"system",type:"TopLevelStyle",skin:n,style:{groups:{},properties:{},propertiesSource:{}}}:null}function r(e){var i=t.map(e,function(t,e){return[e,t]});return t.sortBy(i,t.head)}return{getStyleIdByDef:function(n,o,r,s){if("system"===r.styleType)return r.id;var a=function(e,n){var o=i(e);return t.filter(o,{skin:n})}(n,r.skin),u=t.find(a,function(i){if(t.isUndefined(i.style)&&r.style)return!1;if(i.style&&r.style){var n=o.COMPONENT_DEFINITION_MAP[s]?t.keys(o.COMPONENT_DEFINITION_MAP[s].styles):[];return!(!t.includes(n,i.id)&&i.componentClassName!==s)&&e(i.style.properties,r.style.properties)}return!0});return u?u.id:this.createNewStyleByDef(n,r,r.componentClassName)},createNewStyleByDef:function(e,i,n){var o=t.cloneDeep(i);return o.styleType="custom",o.componentClassName=o.componentClassName||n,e.styles.createAndAddItem(o).id},getStyleById:function(t,e,i){var n=t.styles.get(i);return n||(n=o(e.COMPONENT_DEFINITION_MAP,i)),n},getUniqueCustomStyleList:function(e,i,o){var s=n(e,o),a=this.getUniqueThemeStyleList(e,i,o),u=t.uniqBy(s,function(t){return JSON.stringify(t.style?r(t.style.properties):{})});return t.remove(u,t.bind(function(e){return t.find(a,t.bind(function(t){return this.isEqualWithoutTypeConsideration(e,t)},this))},this)),t.sortBy(u,"skin")},getUniqueThemeStyleList:function(e,i,n){var o=this.getThemedStyleForComp(e,i,n),s=t.uniqBy(o,function(t){return JSON.stringify(t.style?r(t.style.properties):{})+t.skin});return t.sortBy(s,"skin")},getThemedStyleForComp:function(e,i,n){var o=i.COMPONENT_DEFINITION_MAP[n]?t.keys(i.COMPONENT_DEFINITION_MAP[n].styles):[];return t.map(o,t.bind(function(t){return this.getStyleById(e,i,t)},this))},getDuplicateToStyleList:function(e,i,o,r,s){var a=this.getThemedStyleForComp(e,i,r),u=n(e,r,s),c=a.concat(u);return t(c).reject({id:o.id}).filter(this.isEqualWithoutTypeConsideration.bind(this,o)).value()},getUniqueStyleList:function(t,e,i){var n=this.getUniqueCustomStyleList(t,e,i);return this.getUniqueThemeStyleList(t,e,i).concat(n)},isEqual:function(t,i){if(!t||!i)throw new Error("Style is not defined");return t.skin===i.skin&&t.styleType===i.styleType&&("system"===t.styleType?t.id===i.id:!t.style||!i.style||e(t.style.properties,i.style.properties))},isEqualWithoutTypeConsideration:function(t,i){if(!t||!i)throw new Error("Style is not defined");return t.skin===i.skin&&(!t.style||!i.style||e(t.style.properties,i.style.properties))},getTempStyleId:function(t,e){var i=this.createNewStyleByDef(t,e);return t.styles.setExcluded(i),i},prepareTempStyleValue:function(t){t.styleType="custom"}}}),define("core/app/designManager",["lodash"],function(t){"use strict";function e(e,i){return!t.isUndefined(o[e])&&!t.isUndefined(o[e][i.charas])}function i(i,n){return t(i.components.getAllComponents()).filter(t.flow(i.components.getType,t.partial(t.includes,n))).map(function(t){return{compRef:t,design:i.components.design.get(t)}}).reject(function(n){var o=i.components.getType(n.compRef),r=n.design;return function(e){var i=(e=e||this.props.compDesign).cssStyle;return t(i).keys().every(function(e){return t.isNull(i[e])})}(r)||e(o,r)}).uniqBy("design.charas").value()}var n={},o={};return{getPersonalizedDesigns:i,addPersonalizedDesign:function(e,i){t.isUndefined(n[e])&&(n[e]={}),n[e][i.charas]=i},removePersonalizedDesign:function(e,i){delete n[e][i.charas],t.isEmpty(n[e])&&delete n[e]},addThemePresetDesign:function(e,i){t.isUndefined(o[e])&&(o[e]={}),o[e][i.charas]=i},isThemeDesign:e}}),define("core/app/premiumServicesAPI",["coreUtilsLib","lodash","util"],function(t,e,i){"use strict";function n(i,n,a){t.requestsUtil.fetchJson(s+i,{contentType:"application/json",credentials:"same-origin",method:"GET"}).then(function(t){var i=function(t){return e.has(t,"payload.domain.domainName")&&e.has(t,"payload.domain.checkStatus")&&t.payload.domain.checkStatus===o}(t),s=function(t){var i=e.get(t,"payload.domain.domainName","");return e.isEmpty(i)||e.includes(i,r)||(i=r+i),e.isEmpty(i)?null:i}(t),a=function(t){return!e.isNil(e.get(t,"payload.plan.cycle"))}(t);n({isDomainConnected:i,sitePublishedDomain:s,isSitePremium:a})}).catch(a)}var o=0,r="http://",s=i.serviceTopology.premiumStateApiUrl;return s=s?s.replace(/wix\/getTpaPremiumState/,"premium-management/external/getDocPremiumState?siteGuid="):"//editor.wix.com/_api/premium-management/external/getDocPremiumState?siteGuid=",{getSiteDomainInfo:n}}),define("core/utils/menuUtils/tpaPages",["lodash","core/utils/pageUtils/tpaTypeUtils"],function(t,e){"use strict";function i(e,i,n){return t.includes(i,n.tpaApplicationId)&&!t.has(e,n.id)}var n={getSectionPagesDataList:function(n,o){var r=function(i,n){return t(i).filter(t.partial(e.isTPASpecialPage,n.dsRead)).keyBy("id").value()}(o,n),s=function(e,i){return t(e).filter(function(e){return t.has(i,e.id)}).map("tpaApplicationId").uniq().value()}(o,r);return t.filter(o,t.partial(i,r,s))},getSpecialPagesDataList:function(i,n){return t.filter(n,t.partial(e.isTPASpecialPage,i.dsRead))},getSpecialPagesDataListByTPAId:function(e,i,o){return t.filter(n.getSpecialPagesDataList(e,o||e.documentServices.pages.getPagesData()),["tpaApplicationId",i])}};return n}),define("core/utils/menuUtils/blogPages",["lodash","core/utils/pageUtils/blogTypeUtils"],function(t,e){"use strict";return{getSectionPagesDataList:function(i,n){return t.filter(n,t.partial(e.isBlogSectionPage,i))},getSpecialPagesDataList:function(i,n){return t.filter(n,e.isBlogSpecialPage)}}}),define("core/utils/menuUtils/menuLogic",["lodash","core/utils/menuUtils/tpaPages","core/utils/menuUtils/blogPages","core/utils/pageUtils/blogTypeUtils","core/utils/pageUtils/tpaTypeUtils","core/utils/pageUtils/dynamicTypeUtils"],function(t,e,i,n,o,r){"use strict";var s=n.isBlog,a=o.isTPA;return{isSpecialPage:function(e,i,s){return n.isBlogSpecialPage(i)||o.isTPASpecialPage(e.dsRead,i)||function(e,i,n){return n?t.has(n,i.id):r.isDynamicPage(e,i)}(e,i,s)},isSubPageMenuItem:function(t,e){return this.isSpecialPage(t,e)&&!o.isPageNotVisibleInPagesMenu(t.dsRead,e)},getSectionPagesIds:function(n,o){var r=e.getSectionPagesDataList(n,o),s=i.getSectionPagesDataList(n,o);return t.union(t.map(r,"id"),t.map(s,"id"))},getSpecialPagesListBySectionPageOrBySibling:function(t,n,o){if(n){if(s(t,n))return function(t,e){return i.getSpecialPagesDataList(t,e||t.documentServices.pages.getPagesData())}(t,o);if(a(n))return function(t,i,n){return e.getSpecialPagesDataListByTPAId(t,i,n)}(t,n.tpaApplicationId,o)}return[]}}}),define("core/utils/toolbarPositioning/toolbarPositioning",["lodash","react","reactDOM","prop-types","zepto","core/utils/stageUtils","util","constants","create-react-class"],function(t,e,i,n,o,r,s,a,u){"use strict";return u({displayName:"toolbarPositioning",propTypes:{children:n.func.isRequired,isCustomPosition:n.bool,isHidden:n.bool,initialPos:n.object.isRequired,dragRightLimit:n.number.isRequired,lastCustomXPosition:n.number,className:n.string,registerMeasureFunc:n.func.isRequired,measuredRes:n.shape({shouldCompSlideRight:n.bool,dragLimits:n.shape({x:n.arrayOf(n.number),y:n.arrayOf(n.number)}),position:n.shape({left:n.number,top:n.number})})},getDefaultProps:function(){return{dragRightLimit:0,initialPos:{right:0,top:0},lastCustomXPosition:null}},getInitialState:function(){return this.props.registerMeasureFunc(this.measureComp),{}},fitPositionToScreen:function(t){var e=i.findDOMNode(this).getBoundingClientRect(),n=e.top,o=this.props.lastCustomXPosition||e.left,r=t.x[1]-e.width;return{left:s.math.ensureWithinLimits(o,t.x[0],r),top:s.math.ensureWithinLimits(n,t.y[0],t.y[1])}},getDragLimits:function(){var t=r.getStageLayout(),e=a.PANELS.PANEL_SIZE_TO_KEEP_IN_VIEW,n=i.findDOMNode(this).clientHeight;return{x:[t.left+this.props.dragRightLimit,t.right-this.props.dragRightLimit],y:[t.top+this.props.dragRightLimit,t.bottom+n-e]}},getComponentPosition:function(t){return this.props.isCustomPosition?this.fitPositionToScreen(t):this.props.initialPos},measureComp:function(){if(this.props.isHidden)return this.props.measuredRes;var t=this.getDragLimits();return{shouldCompSlideRight:this.shouldSlideRight(),dragLimits:t,position:this.getComponentPosition(t)}},shouldSlideRight:function(){var t=o(i.findDOMNode(this));return t.offset().left+t.width()/2>o(window).width()/2},getClassNames:function(){var e=this.props.measuredRes&&this.props.measuredRes.shouldCompSlideRight,i={"hide-tools":this.props.isHidden,"show-tools":!this.props.isHidden,"slide-right":e,"slide-left":!e};return t(i).keys().filter(function(t){return i[t]}).join(" ").concat(" "+this.props.className)},render:function(){var t={},i={};this.props.measuredRes&&(t=this.props.measuredRes.position,i=this.props.measuredRes.dragLimits);var n=this.getClassNames();return e.createElement("div",{style:t,className:n},this.props.children(i))}})}),define("core/utils/pageUtils/pageTitleUtils",["util"],function(t){"use strict";var e=40;return{generateDuplicatedTitle:function(i){var n=new RegExp(/copy\s(\d+\s|)of\s/i),o=void 0;return n.test(i)?(o=RegExp.$1?parseInt(RegExp.$1,10)+1:2,i.replace(n,"Copy "+o+" of ")):((i=t.translate("Pages_Actions_Duplicate_CopyOf")+" "+i).length>e&&(i=i.substr(0,e-3)+"..."),i)},convertPageNameToUrl:function(e){var i=e.replace(/\s/g,"-");return t.validate.byInvalidCharacters(t.validationExpressions.invalidUrlCharacters)(i)?i.toLowerCase():"blank"}}}),define("core",["core/utils/addUtil","core/utils/AddPanelDragHandler","core/utils/AddPanelSectionDragHandler","core/utils/AttachHandler","core/utils/updateLayoutUtil","core/utils/layoutConstraintsUtil/LayoutConstraintsUtil","core/utils/updateDataUtil","core/utils/updatePropertiesUtil","core/utils/DragConstraintsHandler","core/utils/layoutTransitionsUtil","core/utils/SnapToHandler","core/utils/stageUtils","core/utils/scrollUtils","core/utils/compControlsMeasurer","core/utils/fixedPositionPlugins/fixedPositionPlugins","core/utils/social","core/utils/spotifyUtils","core/utils/uiControlsBIUtil","core/utils/componentPreviewReadyPlugins/componentPreviewReadyPlugins","core/utils/compsSectionsAnalyzer","core/utils/sectionsReorganizeUtil","core/utils/pageUtils/blogTypeUtils","core/utils/pageUtils/dynamicTypeUtils","core/utils/pageUtils/tpaTypeUtils","core/utils/pageUtils/wixStoreTypeUtils","core/utils/mouseMoveActions/sectionDrag","core/utils/gridLinesUtil","core/mixins/editorAPIMixin","core/app/lazyComponent","core/app/styleManager","core/app/designManager","core/app/premiumServicesAPI","core/utils/menuUtils/menuLogic","core/utils/toolbarPositioning/toolbarPositioning","core/utils/mediaManagerPresetUtil","core/utils/pageUtils/pageTitleUtils"],function(t,e,i,n,o,r,s,a,u,c,l,p,d,g,h,m,f,y,P,v,S,C,T,I,x,A,w,E,R,_,O,D,b,M,L,U){"use strict";return{utils:{pageTitleUtils:U,menuLogic:b,addUtil:t,AddPanelDragHandler:e,AddPanelSectionDragHandler:i,AttachHandler:n,DragConstraintsHandler:u,updateLayoutUtil:o,LayoutConstraintsUtil:r,updateDataUtil:s,updatePropertiesUtil:a,layoutTransitionsUtil:c,SnapToHandler:l,stageUtils:p,scrollUtils:d,fixedPositionUtils:h,social:m,spotifyUtils:f,compControlsMeasurer:g,uiControlsBIUtil:y,compsSectionsAnalyzer:v,sectionsReorganizeUtil:S,componentPreviewReadyPlugins:P,blogTypeUtils:C,dynamicTypeUtils:T,tpaTypeUtils:I,wixStoreTypeUtils:x,gridLinesUtil:w,mediaManagerPresetUtil:L,toolbarPositioning:M,sectionDrag:A},mixins:{editorAPIMixin:E},lazyComponent:R,styleManager:_,designManager:O,premiumServicesAPI:D}});
//# sourceMappingURL=core.min.js.map