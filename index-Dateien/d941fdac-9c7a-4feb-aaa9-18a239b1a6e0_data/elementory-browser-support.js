(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.elementorySupport=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var elementorySupportFactory=require("./with-xhr");module.exports=elementorySupportFactory()},{"./with-xhr":2}],2:[function(require,module,exports){"use strict";var wireFormat=require("./../common/wire-format");var getPathWithBaseUrl=require("./../common/paths");var executeConsoleLogs=require("./../common/execute-console-logs");module.exports=function(baseUrl,queryParameters,currentPath){var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};return{baseUrl:baseUrl,queryParameters:queryParameters,currentPath:currentPath,options:options,wireFormatParser:wireFormat.wireFormatParser,getJSON:function getJSON(path,args){var pathWithBaseUrl=this.currentPath?location.href.replace(this.currentPath,path):getPathWithBaseUrl(this.baseUrl,path,this.queryParameters);var withCredentials=this.options.withCredentials===true;var requestHeaders=this.options.headers||{};return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;if(withCredentials){xhr.withCredentials=true}xhr.open("POST",pathWithBaseUrl,true);xhr.onreadystatechange=function(){try{if(xhr.readyState===4){if(xhr.status===200){var response=wireFormat.fromJson(xhr.responseText);executeConsoleLogs(response.consoleMethodCalls);if(!response.isError){resolve(response.payload)}else{reject(response.payload)}}else{if(xhr.status&&xhr.statusText){reject(xhr.status+": "+xhr.statusText)}else{reject("Error: connection refused")}}}}catch(err){reject(err)}};xhr.onerror=function(e){if(e&&e.error){reject(e.error)}};Object.keys(requestHeaders).forEach(function(headerKey){return xhr.setRequestHeader(headerKey,requestHeaders[headerKey])});xhr.setRequestHeader("Content-type","application/json");if(args&&args.length>0){xhr.send(wireFormat.toArgsFormat(args))}else{xhr.send()}})}}}},{"./../common/execute-console-logs":3,"./../common/paths":4,"./../common/wire-format":7}],3:[function(require,module,exports){"use strict";module.exports=function executeConsoleLogs(consoleLogCalls){for(var i=0;i<consoleLogCalls.length;++i){var consoleLog=consoleLogCalls[i];if(console.serverLog){console.serverLog(consoleLog)}else{console[consoleLog[0]](consoleLog[1])}}}},{}],4:[function(require,module,exports){"use strict";module.exports=function getPathWithBaseUrl(baseUrl,path,queryParameters){if(!queryParameters){return baseUrl+path}if(queryParameters.startsWith("?")||queryParameters.startsWith("&")){queryParameters=queryParameters.substr(1)}if(path.indexOf("?")===-1){queryParameters="?"+queryParameters}else{queryParameters="&"+queryParameters}return baseUrl+path+queryParameters}},{}],5:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var NullSerializer=function(){function NullSerializer(){_classCallCheck(this,NullSerializer)}_createClass(NullSerializer,[{key:"canSerialize",value:function canSerialize(){return true}},{key:"serialize",value:function serialize(obj){return obj}},{key:"canDeserialize",value:function canDeserialize(){return true}},{key:"deserialize",value:function deserialize(obj){return obj}}]);return NullSerializer}();module.exports=function(){function SerializerRegistry(){_classCallCheck(this,SerializerRegistry);for(var _len=arguments.length,serializers=Array(_len),_key=0;_key<_len;_key++){serializers[_key]=arguments[_key]}this.serializers=[].concat(serializers,[new NullSerializer])}_createClass(SerializerRegistry,[{key:"serialize",value:function serialize(obj){var parents=arguments.length>1&&arguments[1]!==undefined?arguments[1]:new Set;if(isAnObjectButNotNull(obj)){if(parents.has(obj)){throw new TypeError("Converting circular structure to JSON")}else{parents.add(obj)}}var serialized=this.findSerializer(obj).serialize(obj);if(Array.isArray(obj)){return this._serializeArray(obj,parents)}else if(isAnObjectButNotNull(obj)){return this._serializeObject(serialized,obj,parents)}else if(serialized===undefined){return null}else{return serialized}}},{key:"_serializeObject",value:function _serializeObject(serialized,obj,parents){var _this=this;var result=void 0;if(typeof serialized.toJSON==="function"){result=mapValues(serialized.toJSON(),function(value){return _this.serialize(value,parents)})}else{result=mapValues(serialized,function(value){return _this.serialize(value,parents)})}parents.delete(obj);return result}},{key:"_serializeArray",value:function _serializeArray(obj,parents){var _this2=this;var result=obj.map(function(arrayMember){return _this2.serialize(arrayMember,parents)});parents.delete(obj);return result}},{key:"deserialize",value:function deserialize(obj){var _this3=this;var preprocessedObj=obj;if(Array.isArray(obj)){preprocessedObj=obj.map(function(arrayMember){return _this3.deserialize(arrayMember)})}else if(isAnObjectButNotNull(obj)){preprocessedObj=mapValues(obj,this.deserialize.bind(this))}return this.findDeserializer(preprocessedObj).deserialize(preprocessedObj)}},{key:"findDeserializer",value:function findDeserializer(obj){return this.serializers.find(function(candidate){return candidate.canDeserialize(obj)})}},{key:"findSerializer",value:function findSerializer(obj){return this.serializers.find(function(candidate){return candidate.canSerialize(obj)})}}]);return SerializerRegistry}();function isAnObjectButNotNull(obj){return obj!==null&&(typeof obj==="undefined"?"undefined":_typeof(obj))==="object"}function mapValues(object,fn){var result={};Object.keys(object).forEach(function(key){result[key]=fn(object[key])});return result}},{}],6:[function(require,module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var OBJECT_TAG_FIELD="__ctorName";exports.DateSerializer=function(){function DateSerializer(){_classCallCheck(this,DateSerializer)}_createClass(DateSerializer,[{key:"canSerialize",value:function canSerialize(obj){return obj instanceof Date}},{key:"serialize",value:function serialize(date){return{$date:date.toISOString()}}},{key:"canDeserialize",value:function canDeserialize(obj){return obj&&(typeof obj==="undefined"?"undefined":_typeof(obj))==="object"&&"$date"in obj}},{key:"deserialize",value:function deserialize(obj){return new Date(obj.$date)}}]);return DateSerializer}();exports.ObjectTaggingSerializer=function(){function ObjectTaggingSerializer(className,classConstructor){_classCallCheck(this,ObjectTaggingSerializer);this.className=className;this.classConstructor=classConstructor}_createClass(ObjectTaggingSerializer,[{key:"canSerialize",value:function canSerialize(obj){return obj&&obj[OBJECT_TAG_FIELD]===this.className}},{key:"serialize",value:function serialize(obj){return Object.assign(obj.toJSON(),_defineProperty({},OBJECT_TAG_FIELD,this.className))}},{key:"canDeserialize",value:function canDeserialize(obj){return obj&&obj[OBJECT_TAG_FIELD]===this.className}},{key:"deserialize",value:function deserialize(obj){return this.classConstructor.fromJSON(obj)}}]);return ObjectTaggingSerializer}()},{}],7:[function(require,module,exports){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}else{return Array.from(arr)}}var SerializerRegistry=require("./serializer-registry");var _require=require("./serializers"),DateSerializer=_require.DateSerializer,ObjectTaggingSerializer=_require.ObjectTaggingSerializer;var _require2=require("wix-data-webmethod-structures"),Ref=_require2.Ref;var registry=new SerializerRegistry(new DateSerializer,new ObjectTaggingSerializer("Ref",Ref));exports.wireFormatParser=function(obj){return registry.deserialize(obj)};exports.fromJson=function(responseText){var rawResponseObject=JSON.parse(responseText);var response=exports.wireFormatParser(rawResponseObject);return{consoleMethodCalls:response.consoleMethodCalls||[],isError:!!response.exception,payload:convertResult(response.result)};function convertResult(result){if(!result){return result}if(result._elementoryError){var err=new Error(result.message);err.stack=result.stack;err.name=result.name;err.code=result.code;return err}return result}};exports.toJson=function(obj){return registry.serialize(obj)};exports.toArgsFormat=function(args){if(args&&Object.prototype.toString.call(args)==="[object Arguments]"){return JSON.stringify(registry.serialize([].concat(_toConsumableArray(args))))}return JSON.stringify([])}},{"./serializer-registry":5,"./serializers":6,"wix-data-webmethod-structures":8}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Ref=function(){function Ref(object){_classCallCheck(this,Ref);this.__ctorName="Ref";this._id=null;this._item=null;if(typeof object==="string"){this._id=object}else if(object!=null&&typeof object==="object"&&object.hasOwnProperty("_id")){this._id=object._id;this._item=object}}_createClass(Ref,[{key:"get",value:function get(){return this._item}},{key:"toJSON",value:function toJSON(){if(this._item){return{ref:this._id,item:this._item}}else{return{ref:this._id}}}},{key:"id",get:function get(){return this._id}}],[{key:"fromJSON",value:function fromJSON(obj){var ref=new Ref(obj.ref);ref._item=obj.item||null;return ref}}]);return Ref}();exports.Ref=Ref},{}]},{},[1])(1)});