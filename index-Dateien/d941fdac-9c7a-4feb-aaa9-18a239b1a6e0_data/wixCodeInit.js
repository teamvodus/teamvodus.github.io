define("wixCodeInit/utils/urlBuilder",["lodash"],function(e){"use strict";function i(e){return Object.keys(e).map(function(i){return encodeURIComponent(i)+"="+encodeURIComponent(e[i])}).join("&")}function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t="undefined"!=typeof window&&!window.clientSideRender,n="undefined"==typeof window||window.isPseudoWindow,r={deviceType:i.isMobileView?"mobile":"desktop",renderCycle:t&&!n?2:1,renderingEnv:n?"backend":"browser",userWarmup:e.userWarmup,locale:e.rendererModel.languageCode};return i.sdkSource&&(r.sdkSource=i.sdkSource),i.applications&&(r.applications=JSON.stringify(i.applications)),r}return{buildUrl:function(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=!!n.publicModel;return function(e,i,t,n){var r=n?"pub":"dev",o="//"+i.instanceId+"."+r+".",a=e.serviceTopology.wixCloudBaseDomain,s="node_modules/santa-wix-code/"+(t.useWixCodeFallback?"fallback.html":"index.html");return o+function(){for(var e=arguments[0],i=1;i<arguments.length;++i)e=e.replace(/\/$/,"")+"/"+arguments[i].replace(/^\//,"");return e}(a,"_partials",function(e,i){var t,n,r=e.serviceTopology,o=(n=e.santaBase,/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(n)||(t=e.santaBase,/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/(.+)\/SNAPSHOT\/santa?$/.test(t))?r.scriptsLocationMap.santa:e.santaBase);return o=function(e,i){var t=e.lastIndexOf("/");return/^\d+\.\d+\.\d+$/.test(i)?e.substring(0,t+1)+i:e}(o,i),/(.*\/services\/)?(.*)/.exec(o)[2]}(e,t.runtimeSource),s)}(n,r,o,a)+"?"+i(e.merge(t(n,o),{compId:"wixCode_"+r.appDefinitionId,viewMode:a?"site":"preview","wix-code-platform":n.serviceTopology.scriptsLocationMap["wix-code-platform"],initialTimestamp:n.wixBiSession.initialTimestamp}))},buildStaticUrl:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.santaBase+"/node_modules/santa-wix-code/"+(r.useWixCodeFallback?"fallback.html":"index.html"),a=!!n.publicModel;return o+"?"+i(e.merge(t(n,r),{viewMode:a?"site":n.renderFlags.componentViewMode||"preview"}))}}}),define("wixCodeInit/utils/iFrameUtils",["lodash"],function(e){"use strict";return{getIFrameForApp:function(i,t){var n=window.document.createElement("iframe");return n.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 1px; height: 1px; background: transparent; border: 0",n.tabIndex=-1,n.setAttribute("aria-hidden","true"),n.src=i,e.get(t,"applicationId")&&e.get(t,"appDefinitionId")&&(n.setAttribute("data-app-id",t.applicationId),n.setAttribute("data-app-definition-id",t.appDefinitionId)),n},isIFrameEvent:function(e,i){return i.source===e.contentWindow}}}),define("wixCodeInit/api/wixCodeAppApi",["lodash","platformInit","coreUtils","wixCodeInit/utils/urlBuilder","wixCodeInit/utils/iFrameUtils"],function(e,i,t,n,r){"use strict";function o(i){var t=i.rendererModel.clientSpecMap.toJS?i.rendererModel.clientSpecMap.toJS():i.rendererModel.clientSpecMap;return!!i.rendererModel.wixCodeModel&&e.some(t,{type:"siteextension"})}return{getApi:function(){var e=[],a=[],s=i.messageProxy.get(),d=!1,c=!0,p=null,l=null,u=null,m=void 0;return{init:function(a,c,p){if(d)console.warn("Wix code is already initiated");else{var l=i.appsUtils.getAppsBaseInfo({clientSpecMap:c,serviceTopology:a.serviceTopology,rendererModel:a.rendererModel}).length>0,u=void 0;if(o(a)){var g=i.specMapUtils.getAppSpec(c);u=n.buildUrl(a,g,p),m=r.getIFrameForApp(u,g)}else{if(!l)return;u=n.buildStaticUrl(a,p),m=r.getIFrameForApp(u,{})}var f=function(t,n){if(r.isIFrameEvent(t,n)){"PLATFORM_IFRAME"!==(o=n.data).intent&&"WIX_CODE"!==o.intent||"wix_code_iframe_loaded"!==o.type||s.setMessageHandler(function(e){t.contentWindow.postMessage(e,"*")});var o;i.biUtils.shouldUseFallbackReportBI(n.data,e)&&i.biUtils.reportBiWithWixBiSession(n.data),e.forEach(function(e){e(n.data)})}}.bind(null,m);window.addEventListener("message",f,!1),function(e){"loading"!==window.document.readyState?i():window.document.addEventListener("DOMContentLoaded",function(){i()});function i(){var i=window.document.body;i.insertBefore(e,i.firstChild),t.loggingUtils.performance.mark("platform-iframe-added-to-dom")}}(m),d=!0}},destroyAppsContainer:function(){m&&(m.parentNode.removeChild(m),d=!1,s=i.messageProxy.get(),m=void 0)},sendMessage:function(e){e&&s.sendOrHoldMessage((i=e,a.reduce(function(e,i){return i(e)},i)));var i},registerMessageHandler:function(i){e.push(i)},registerMessageModifier:function(e){a.push(e)},unregisterMessageHandler:function(i){var t=e.indexOf(i);-1!==t&&e.splice(t,1)},preLoadWidgets:function(e,t){!p&&o(e)&&i.widgetsPreLoader.asyncGetPreLoadMessage(e,t,function(e){c&&!p&&(p=e,s.sendOrHoldMessage(p))})},preLoadUserCode:function(e,t){(!l&&o(e)||i.appsUtils.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}))&&i.widgetsPreLoader.asyncGetPreLoadUserCodeMessage(e,t,function(e){l||(l=e,s.sendOrHoldMessage(l))})},preInitWidgets:function(e,t){!u&&o(e)&&i.widgetsPreLoader.asyncGetPreInitMessage(e,t,function(e){u||(u=e,s.sendOrHoldMessage(u))})},isAppInitiated:function(){return d},getAppsIframe:function(){return m}}}}}),define("wixCodeInit/api/initMainR",["lodash","platformInit"],function(e,i){"use strict";var t="//static.parastorage.com/services/semi-native-sdk/1.7.0/lib/wix.min.js",n="//unpkg.parastorage.com/react@16.0.0/umd/react",r="//unpkg.parastorage.com/react-dom@16.0.0/umd/react-dom";return function(o){var a=o.appApi,s=o.siteModel,d=o.isMobileView,c=o.queryUtil,p=o.currentUrl,l=o.isBot;p=p||window.document.location.href;var u=e.trimEnd(s.serviceTopology.scriptsLocationMap["js-wixcode-sdk"],"/")+"/lib/"+(c.getParameterByName("debug")?"wix.js":"wix.min.js"),m=e.trimEnd(s.serviceTopology.scriptsLocationMap["wixcode-namespaces"],"/")+"/"+(c.getParameterByName("debug")?"wixcode-namespaces.js":"wixcode-namespaces.min.js"),g=t||e.trimEnd(s.serviceTopology.scriptsLocationMap["semi-native-sdk"],"/")+"/lib/"+(c.getParameterByName("debug")?"wix.js":"wix.min.js"),f=(b=c.getParameterByName("useWixCodeFallback"),"false"!==b&&("true"===b||!window.Worker||l)),w=n+(c.getParameterByName("debug")?".development.js":".production.min.js"),M=r+(c.getParameterByName("debug")?".development.js":".production.min.js"),v={isMobileView:d,sdkSource:u,namespacesSdkSource:m,semiNativeSDKSource:g,runtimeSource:c.getParameterByName("WixCodeRuntimeSource"),ReactLibSource:w,ReactDomSource:M,ReactSource:c.getParameterByName("ReactSource"),useWixCodeFallback:f},x=c.getParameterByName("viewerPlatformAppSources");var b;v.applications=i.appsUtils.getAppsBaseInfo({rendererModel:s.rendererModel,clientSpecMap:s.rendererModel.clientSpecMap,serviceTopology:s.serviceTopology,viewerPlatformAppSources:x,santaBase:s.santaBase}),function(e){a.init(s,e,v),t=e,(i.specMapUtils.getAppSpec(t)||v.applications.length)&&(a.preLoadUserCode(s,p),s.publicModel&&a.preLoadWidgets(s,p));var t}(s.rendererModel.clientSpecMap)}}),define("wixCodeInit",["wixCodeInit/api/wixCodeAppApi","wixCodeInit/api/initMainR","platformInit"],function(e,i,t){"use strict";return{getAppApi:e.getApi,initMainR:i,appsUtils:t.appsUtils,specMapUtils:t.specMapUtils,registerDeps:t.registerDeps}});
//# sourceMappingURL=wixCodeInit.min.js.map