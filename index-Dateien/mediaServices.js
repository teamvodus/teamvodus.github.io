define("mediaServices",["lodash","constants","util","core","stateManagement","media-manager-api","coreBi","imageClientApi"],function(e,t,a,o,i,n,r,s){"use strict";var c=a.backgroundPanelUtils,d=r.events.singleVideoPlayer,p=i.editorPlugins.userPreferences.actions.setSessionUserPreferences,g=i.editorPlugins.userPreferences.selectors.getSessionUserPreferences,l=i.editorPlugins.userPreferences.selectors.getMediaPath,m=t.UI,u=t.LEGACY_FIT_DISPLAY_MODE,h=t.CLIPART_DATA_KEYS,_=m.IMAGE_DATA_KEYS,v=t.VECTOR_IMAGE_DEFAULTS,f=v.VECTOR_IMAGE_CATEGORY,y=v.VECTOR_SHAPE_DEFAULT_STYLE,S=v.VECTOR_SHAPE_COLOR_DEFAULT,T=v.VECTOR_SHAPE_DEFAULT_PATH,C=v.VECTOR_ART_DEFAULT_PATH;return{create:function(t){function r(o){var i=a.imageTransform.fittingTypes,n=t.components.data.get(o),r=t.store,c=r.dispatch,d=(0,r.getState)(),g=l(n.uri)(d);t.mediaServices.mediaManager.open(t.mediaServices.mediaManager.categories.IMAGE,{translation:{title:a.translate("Image_Media_Choose_Image"),submitButton:a.translate("MMGR_submitbutton_onstage_image_uploads_choose")},path:g,multiSelect:!1,callback:function(n,r){if(n){var d=t.components.layout.get(o),g=e.pick(n[0],_),l=t.components.properties.get(o).displayMode;g.uri=n[0].fileName,g.originalImageDataRef=null,g.crop=function(t,a,o,i,n){if(n===s.fittingTypes.SCALE_TO_FILL||n===s.fittingTypes.LEGACY_FULL){var r=Math.min(o/t,i/a),c=t*r,d=a*r,p={width:Math.round(c),height:Math.round(d),x:Math.round((o-c)/2),y:Math.round((i-d)/2)};return e.some(p)?p:null}return null}(d.width,d.height,g.width,g.height,l),g.title="",c(p("last_media_path_"+g.uri,r.path)),t.components.data.update(o,g,!0),l===a.imageTransform.fittingTypes.LEGACY_FULL&&t.components.properties.update(o,{displayMode:i.SCALE_TO_FILL},!0),t.history.add("Change Image"),v()}}})}function m(o){var i=t.store.getState(),n=t.components.data.get(o),r=e.get(n,["svgId"]),s=t.media.vectorImage.getSvgInfoFromCache(r),c=s.svgType,d=t.components.design.get(o),g="shape"===c?T:C,m=l(r)(i)||g;t.mediaServices.mediaManager.open(t.mediaServices.mediaManager.categories[f],{multiSelect:!1,callback:function(i,r){if(!e.isEmpty(i)){var c=e.get(i,[0,"title"],""),g=e.get(i,[0,"uri"]);t.media.vectorImage.fetchSvg(g,e.noop),t.documentServices.waitForChangesApplied(function(){var i=e.assign({},n,{svgId:g,title:c}),r=e.get(t.media.vectorImage.getSvgInfoFromCache(g),"svgType"),p=e.assign({},d,function(t,a,o){var i=e.assign(e.omit(a,"svgType"),e.get(t,"overrideColors")),n=e.get(t,["shapeStyle"]),r=e.get(n,["opacity"],y.opacity),s=i.color1&&!i.color2?i.color1:S.color1,c=void 0;switch(o){case"shape":c={overrideColors:{color1:s},shapeStyle:e.defaults(n,y)};break;case"tint":c={overrideColors:{color1:s},shapeStyle:{opacity:r}};break;case"color":c={overrideColors:null,shapeStyle:{opacity:r}};break;case"ugc":c={overrideColors:null,shapeStyle:{opacity:r}}}return c}(d,s,r));t.components.data.update(o,i,!0),t.components.design.update(o,p,!0),t.documentServices.waitForChangesApplied(function(){!function(e){var o=t.components.properties.get(e),i=a.imageTransform.fittingTypes;if(o.displayMode===i.SCALE_TO_FIT||o.displayMode===u){var n=t.media.vectorImage.getSvgOriginalAspectRatio(e);t.components.layout.resetCompLayoutToAspectRatio(e,n),t.components.properties.update(e,{displayMode:i.SCALE_TO_FIT},!0)}}(o),t.history.add("Change Vector Image")})}),t.store.dispatch(p("last_media_path_"+g,r.path||"")),v()}},path:m})}function v(){var e=window.document.querySelector("#editor");if(e){var t=window.document,a=t.documentElement.scrollTop||t.body.scrollTop;e.focus(),t.documentElement.scrollTop=t.body.scrollTop=a}}return{initMediaManager:function(a){t.mediaServices.mediaManager=n.create(e.assign(a,{origin:n.origins.EDITOR}))},mediaManager:null,setFocusToEditor:v,changeWPhoto:r,changeVectorImage:m,changeClipArt:function(o,i){var n=t.components.data.get(o),r=t.store.getState(),s=l(n.uri)(r);t.mediaServices.mediaManager.open(i,{multiSelect:!1,translation:{submitButton:a.translate("MMGR_submitbutton_onstage_clipart_freeclipart_choose")},path:s,callback:function(a,i){if(a){var n=e.pick(a[0],h);n.uri=a[0].fileName,n.originalImageDataRef=null,n.crop=null,t.store.dispatch(p("last_media_path_"+n.uri,i.path)),t.components.data.update(o,n,!0),t.history.add("Change Clipart"),v()}}})},changeVideo:function(a){var o=t.store,n=o.dispatch,r=o.getState,s=t.components.design.get(a),l=t.components.properties.get(a),m=e.get(s.background,["mediaRef","videoId"],""),u=g("last_media_path_"+m)(r());t.mediaServices.mediaManager.open(t.mediaServices.mediaManager.categories.VIDEO,{multiSelect:!1,callback:function(o,r){if(o){var g=c.getMediaPlayerVideoObject(o,r);e.get(l,"autoplay")&&(g.mute=!0,t.components.properties.update(a,{autoplay:!0,mute:!0})),s.background.mediaRef=g,t.components.design.update(a,s,!0);var m=t.components.getChildren(a),u=e.find(m,function(e){return"wysiwyg.viewer.components.MediaControls"===t.components.getType(e)}),h=t.components.properties.get(u),_=e.get(h,"showStoryboard");h.showStoryboard=c.getStoryboardDisplayValue(g,_),t.components.properties.update(u,h,!0),t.history.add("Change Video"),t.store.dispatch(i.editorPlugins.bi.actions.event(d.video_player_video_changed,c.getChangeVideoBiEventFields(o[0],"video_player_gfpp"))),n(p("last_media_path_"+g.videoId,r.path||"")),v()}},path:u})},changeShape:function(i){var n=t.mediaServices;n.mediaManager.open(n.mediaManager.categories.SHAPE,{multiSelect:!1,callback:function(n){if(!e.isEmpty(n)){var r=a.svgUrlParser.parseSvgSkinFromUrl(n[0].fileUrl),s=t.components.style.getId(i),c=t.theme.styles.get(s);if(r!==c.skin){c.skin=r;var d=o.styleManager.getStyleIdByDef(t.theme,t.components,c,t.components.getType(i));t.components.style.setId(i,d),t.history.add("Change Shape"),v()}}},translation:{submitButton:a.translate("Shape_Media_Change_Shape")}})}}}}});
//# sourceMappingURL=mediaServices.min.js.map