var cancellationErrorCode=-7799;(function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e(P);else if(typeof define=="function"&&define.amd)define("bluebird_extended",["bluebird"],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"&&(t=self),t.Promise=e(P)}})(function(e){function t(){e.CancellationError.apply(this,arguments),this.data={errorCode:cancellationErrorCode,errorDescription:"Canceled by user",errorInfo:{key:"wmp_error.canceled_by_user",args:[]}}}return e.CancellationError&&(t.prototype=Object.create(e.CancellationError.prototype)),e.newAbortable=function(n){var r,i=new e(function(){return r=arguments[1],n.apply(this,arguments)});return i.cancellable?(i=i.cancellable(),i.abort=function(){this.cancel(new t)}):i.abort=function(){r(new t)},i},e.defer=function(){var t,n,r=e.newAbortable(function(){t=arguments[0],n=arguments[1]});return{resolve:t,reject:n,promise:r}},e.CancellationError||(e.CancellationError=function(){Error.apply(this,arguments)},e.CancellationError.prototype=Object.create(Error.prototype)),["then","catch"].forEach(function(t){var n=e.prototype[t];e.prototype[t]=function(){var e=n.apply(this,arguments);return e.abort||(e.abort=this.abort),e}}),e.prototype.progress=function(e){return this._progressCallback=e,this},e.prototype.notify=function(e){return typeof this._progressCallback=="function"&&this._progressCallback(e),this},e}),define("utils/mappers",[],function(){"use strict";return{toObject:function(e){if(!e)return null;if(typeof e=="string"){if(["{","["].indexOf(e[0])>=0)try{return JSON.parse(e)}catch(t){return{error_code:-100,error_description:"Can`t parse JSON",error_info:{key:"wmp_error.cant_parse_json"}}}return{message:e}}return e},toError:function(e){var t=new Error;return t.code=e.status||e.code,t.message=e.statusText||e.message||e.data.message||e.data.error&&e.data.error.message||"",t.data=e.data&&(e.data.errors||e.data.error||e.data),t}}}),define("utils/utils",["bluebird_extended","./mappers"],function(e,t){"use strict";function n(e,t,n){var r;return n?(r=t.map(n),t[r.indexOf(Math[e].apply(null,r))]):Math[e].apply(this,t)}var r={extend:function(e){e=e||{};var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){typeof t=="object"&&t!==null&&Object.keys(t).forEach(function(n){e[n]=t[n]})}),e},extendDeep:function i(e){e=e||{};for(var t=1,n=arguments.length;t<n;++t){var r=arguments[t];if(!r)continue;for(var s in r){if(!r.hasOwnProperty(s))continue;if(r[s]===undefined)continue;if(Object.prototype.toString.call(r[s])==="[object Object]"){e[s]=i(e[s],r[s]);continue}e[s]=r[s]}}return e},get:function(e,t,n){if(!e||!t)return n||undefined;var r=Array.isArray(t)?t:t.split("."),i=r.reduce(function(e,t){return e&&e[t]?e[t]:undefined},e);return i?i:n||undefined},merge:function(){var e=Object.prototype.hasOwnProperty;return Array.prototype.reduce.call(arguments,function(t,n){return Object.keys(t).forEach(function(r){e.call(n,r)&&(t[r]=n[r])}),Object.keys(n).forEach(function(e){t[e]=n[e]}),t},{})},bytesToSize:function(e){if(e===0)return"0 Byte";var t=1024,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(t));return(e/Math.pow(t,r)).toPrecision(3)+" "+n[r]},partial:function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var n=Array.prototype.slice.call(arguments);return e.apply(this,t.concat(n))}},getParameterByName:function(e,t){var n,r;return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=n.exec(e),r?decodeURIComponent(r[1].replace(/\+/g," ")):""},snakeToCamel:function(e){return e=e[0].toLowerCase()+e.slice(1),e.replace(/[_]+$/g,"").replace(/([^_]?)[_]+([^_])/g,function(e,t,n){return t?t.toLowerCase()+n.toUpperCase():n.toLowerCase()})},camelToSnake:function(e){return e.replace(/([a-z]?)([A-Z])/g,function(e,t,n){return t?t+"_"+n.toLowerCase():e.toLowerCase()})},find:function(e,t){var n;return e.some(function(e){if(t(e)===!0)return n=e,!0}),n},encodeParams:function(e){var t=[],n=function(e,n){t[t.length]=encodeURIComponent(e)+"="+encodeURIComponent(n)};return Object.keys(e).forEach(function(t){n(t,e[t])}),t.join("&").replace(/%20/g,"+")},splitTags:function(e){return e?Array.isArray(e)?e:e.split(/\s*,\s*/):[]},normalizeUri:function(e){if(typeof e!="string")throw new Error("URI is not a string");return e.replace(/([a-z\-_0-9]+)\/\//gi,"$1/")},getScript:function(n){return e.newAbortable(function(e,r){var i=document.getElementsByTagName("head")[0],s=document.createElement("script"),o=!1;s.src=n,s.onload=s.onreadystatechange=function(){!o&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")?(o=!0,e(),s.onload=s.onreadystatechange=null,i&&s.parentNode&&i.removeChild(s)):r(t.toError())},i.insertBefore(s,i.firstChild)})},startsWithGuid:function(e){return/^\w{8}-(\w{4}-){3}\w{12}/.test(e)},sortBy:function(e,t,n){return e.slice().sort(function(e,r){var i=0;return e[t]<r[t]?i=-1:e[t]>r[t]&&(i=1),n==="desc"?-i:i})},objectValues:function(e){return e?Object.keys(e).map(function(t){return e[t]}):[]},getThumbnailsUrlsFromList:function(e,t){function n(e,t){return t.width>=e.width&&t.height>=e.height}function i(e,t){return t.width>=e.width||t.height>=e.height}if(!e.length)return{};var s=r.sortBy(e,"width");return Object.keys(t).reduce(function(e,o){var u=t[o],a=r.find(s,function(e){return u.mode==="fill"?n(u,e):i(u,e)});return e[o+"Url"]=a?a.url:s[s.length-1].url,e},{})},replaceHtml:function(e){return(e||"").replace(/<\/?[a-z]+.*?>/gi,"")},toTimeStamp:function(e){return e?Math.floor((new Date(e)).getTime()/1e3):null}};return r.min=r.partial(n,"min"),r.max=r.partial(n,"max"),r}),define("utils/http",["bluebird_extended","./utils","./mappers"],function(e,t,n){"use strict";function s(e){return typeof e=="string"&&(["{","["].indexOf(e[0])>=0?e=JSON.parse(e):e={message:e}),e}function o(e){return{status:e.status,statusText:e.statusText,responseSize:e.responseText.length,data:s(e.responseText)}}function u(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function a(e,t){if(!t)return e;var n=[];return Object.keys(t).forEach(function(e){var r=t[e];if(r===null||typeof r=="undefined")return;r instanceof Array||(r=[r]),r.forEach(function(t){t instanceof Date&&!isNaN(t.valueOf())?t=t.toISOString():typeof t=="object"&&(t=JSON.stringify(t)),n.push(u(e)+"="+u(t))})}),n.length>0&&(e+=(e.indexOf("?")===-1?"?":"&")+n.join("&")),e}function f(e,n){if(n.indexOf(r.JSON)!==-1)return JSON.stringify(e);if(n.indexOf(r.URL_ENCODED)!==-1)return t.encodeParams(e);if(n.indexOf(r.MULTIPART)!==-1){var i=new FormData;return Object.keys(e).forEach(function(t){var n=e[t],r=t==="file"?[t,n,n.name]:[t,n];return i.append.apply(i,r)}),i}}var r={JSON:"application/json",URL_ENCODED:"application/x-www-form-urlencoded",MULTIPART:"multipart/form-data"},i={withCredentials:!1,cache:!0,headers:{Accept:"application/json, text/plain, */*"}};return function(s){function l(e){u=t.extendDeep(u,e)}function c(r,i,s){var u=e.newAbortable(function(e,i){r.addEventListener("error",function(){i(n.toError(t.extend({},r,{message:"error",code:-201})))},!1),r.addEventListener("timeout",function(){i(n.toError(t.extend({},r,{message:"timeout_has_exceeded",code:408})))},!1),r.addEventListener("load",function(){r.status.toString().match(/^2\d+/i)?e(o(r)):i(n.toError(t.extend({},r,{message:"error",code:r.status,data:n.toObject(r.responseText)})))},!1)});return s?r.upload.onprogress=function(e){var t=Math.round(e.lengthComputable?e.loaded*100/e.total:0),n=t<=99?"uploading":"processing";u.notify({status:n,total:e.total,loaded:e.loaded})}:(r.addEventListener("loadstart",function(e){if(!e)return;u.notify({status:"uploading",total:e.total,loaded:e.loaded})},!1),r.addEventListener("loadend",function(e){if(!e)return;u.notify({status:"processing",total:e.total,loaded:e.loaded})},!1)),u.catch(function(t){t instanceof e.CancellationError&&r.abort()}),i(),u}function h(e,n,r){var i=new XMLHttpRequest;return r.cache===!1&&(n+=(n.indexOf("?")===-1?"?":"&")+"_="+Date.now()),i.open(e.toUpperCase(),t.normalizeUri(n)),r.responseType&&(i.responseType=r.responseType),i.withCredentials=r.withCredentials,Object.keys(r.headers).forEach(function(e){i.setRequestHeader(e,r.headers[e])}),i}function p(e,n,r){n=t.extend({},n,u.params);var s=h("get",a(e,n),t.extendDeep({},i,u,r));return c(s,function(){s.send(null)})}function d(e,n){n=n||{};var r=n.data||{},s=n.params||{},o=n.options||{},l=t.extendDeep({},i,{headers:{"Content-Type":"application/json; charset=utf-8"}},u,o);r=t.extend({},r,u.params),r=f(r,l.headers["Content-Type"]);var p=h("post",a(e,s),l);return c(p,function(){p.send(r)})}function v(e,n,s){var o=t.extendDeep({},i,s),a=h("post",e,o),l=t.extend({},n,u.params);return l=f(l,r.MULTIPART),c(a,function(){a.send(l)},!0)}function m(t,n){return function(){function o(){return t.apply(r,i)}var r=this,i=arguments,s;s=o();var u=e.newAbortable(function(e,t){s.then(e,function(e){return n!==undefined?n.call(this,e,o):e}).then(e,t)});return s.progress(function(e){u.notify(e)}),u.catch(function(t){t instanceof e.CancellationError&&s.abort()}),u}}function g(t){return m(t,function(t,n){return t instanceof e.CancellationError||t.code===406||t.code===403?e.reject(t):n()})}var u=t.extend({},s);return{get:g(p),post:g(d),upload:g(v),catchError:m,setRequestOptions:l}}}),define("events/notifier",["bluebird_extended"],function(e){"use strict";function n(){}function r(e,t){e.forEach(function(e){e(t)})}function i(e,t,n){e.forEach(function(e){e[t](n)})}function s(r,s,o){if(typeof t[s]=="undefined")return{resolveAt:n,rejectAt:n};var u=[],a=[];return t[s].forEach(function(t){var n=[],r=[],i=o.promises.map(function(){return new e(function(e,t){n.push(e),r.push(t)})});u.push(n),a.push(r),t(i,o)}),{resolveAt:function(e,t){i(u,e,t)},rejectAt:function(e,t){i(a,e,t)}}}function o(i,o,u){if(typeof i!="object"||i===null)throw new Error("target should be a function");if(typeof o!="string")throw new Error("eventName should be a string");u=u||{},u.eventTarget=i,u.eventName=o;if(u.promises&&u.promises.length)return s(i,o,u);if(typeof t[o]=="undefined")return{resolve:n,reject:n};var a=[],f=[];return t[o].forEach(function(t){var n=new e(function(e,t){a.push(e),f.push(t)});t(n,u)}),{resolve:function(e){r(a,e)},reject:function(e){r(f,e)}}}function u(t,n,r,i){var s=new e(function(e){e(i)});r.promises=[s];var u=o(t,n,r);return s.then(function(e){u.resolveAt(0,e)}),u}function a(e,n){typeof t[e]=="undefined"&&(t[e]=[]),t[e].push(n)}function f(e,n){if(t[e]){var r=t[e].indexOf(n);t[e].splice(r,1)}}var t={};return{emit:o,emitResolve:u,addListener:a,removeListener:f}}),define("sources/Source",["../utils/http","../events/notifier"],function(e,t){"use strict";return function(n,r){if(typeof n!="function")throw new Error("Source constructor should be a function");if(typeof r=="undefined"||typeof r=="object"&&r!==null){var i=e();return new n(r,t.emit,i)}throw new Error("Source settings should be an object")}}),define("sources/bigstock/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/bigstock"}}),define("sources/bigstock/mappers/folder",[],function(){"use strict";return function(e){return{id:e.id,name:e.name,mediaType:"picture",parentId:null,filesCount:null,createdAt:null}}}),define("sources/bigstock/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t){return t.data=(t.data||[]).map(e),t}}),define("sources/bigstock/folders",["./parsers/folders","bluebird_extended"],function(e,t){"use strict";return function(){function r(){return t.resolve(n)}var n=e({data:[{id:null,name:"All"},{id:"Abstract",name:"Abstract"},{id:"Animals",name:"Animals"},{id:"Architecture",name:"Architecture"},{id:"Backgrounds",name:"Backgrounds"},{id:"Business",name:"Business"},{id:"Communication",name:"Communication"},{id:"Computers",name:"Computers"},{id:"Conceptual",name:"Conceptual"},{id:"Editorial",name:"Editorial"},{id:"Education",name:"Education"},{id:"Food",name:"Food"},{id:"Health",name:"Health"},{id:"Holidays",name:"Holidays"},{id:"Industry",name:"Industry"},{id:"Internet",name:"Internet"},{id:"Landscapes",name:"Landscapes"},{id:"Maps",name:"Maps"},{id:"Miscellaneous",name:"Miscellaneous"},{id:"Musical",name:"Musical"},{id:"Nature",name:"Nature"},{id:"Objects",name:"Objects"},{id:"People",name:"People"},{id:"Places",name:"Places"},{id:"Sports",name:"Sports"},{id:"Transportation",name:"Transportation"}]});return{list:r}}}),define("sources/bigstock/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t){var n=e.find(t.formats,function(e){return e.size_code==="l"});return n||(n=t.formats.pop()),{id:t.id,name:t.title,folderId:null,mediaType:"picture",fileUrl:null,thumbnailUrl:e.normalizeUri(t.large_thumb.url),previewUrl:e.normalizeUri(t.preview.url),createdAt:null,tags:[],width:n.width,height:n.height}}}),define("sources/bigstock/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){var n=t.data.data,r=n.paging&&n.paging.page<n.paging.total_pages?n.paging.page+1:null,i=Number(n.paging.items_per_page);return t.data=(n.images||[]).map(e),t.paging={cursor:r,size:i},t}}),define("sources/bigstock/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){if(t.code===503&&t.data&&t.data.code==="search-critical")return{data:[],status:t.code,error:t.data};t.data=t.data||{};var n=t.data,r;return Array.isArray(n)?r=n[0].code||n[0]:r=n.code,t.data.message=r,e.reject(t)}}),define("sources/bigstock/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{},s.sort=s.sort||{};var o={limit:s.paging.size||50,page:s.paging.cursor||null,order:s.sort.field||null,category:i||null,orientation:s.orientation||null};return r.get(n.apiUrl+"/search",o,{headers:s.headers||{}}).then(e).catch(t)}function s(i,s,o){o=o||{},o.paging=o.paging||{},o.sort=o.sort||{};var u={q:s||null,limit:o.paging.size||50,page:o.paging.cursor||null,order:o.sort.field||null,category:i||null,orientation:o.orientation||null};return r.get(n.apiUrl+"/search",u,{headers:o.headers||{}}).then(e).catch(t)}return{list:i,search:s}}}),define("sources/decorators",["bluebird_extended","../events/notifier","../utils/utils"],function(e,t,n){"use strict";function r(i,s,o){var u={};return Object.keys(s).forEach(function(a){var f=n.snakeToCamel(a.toLowerCase());if(typeof o[f]=="object"&&o[f]!==null&&typeof s[a]=="object"&&s[a]!==null){u[f]=r(i,s[a],o[f]);return}if(typeof o[f]!="function")return;u[f]=function(){var n=[].slice.call(arguments),r=o[f].apply(o,n),u={arguments:n},l,c;return Array.isArray(r)?(u.promises=r,l=t.emit(i,s[a],u),r.forEach(function(e,t){var n=e.then(function(e){l.resolveAt(t,e)},function(e){l.rejectAt(t,e)});e.progress(function(e){n.notify(e)})}),r):(l=t.emit(i,s[a],u),c=r.then(function(e){return l.resolve(e),e},function(t){return l.reject(t),e.reject(t)}),r.progress(function(e){c.notify(e)}),c)}}),u}return{addEvents:r}}),define("events/list",[],function(){"use strict";return{FOLDERS:{LIST:"folders.list",REMOVE:"folders.remove",TRASH:{LIST:"folders.trash.list",RESTORE:"folders.trash.restore",REMOVE:"folders.trash.remove"}},FOLDER:{CREATE:"folder.create",UPDATE:"folder.update"},ITEMS:{LIST:"items.list",REMOVE:"items.remove",SEARCH:"items.search",SEARCH_BY_TAG:"items.searchByTag",TRASH:{LIST:"items.trash.list",RESTORE:"items.trash.restore",REMOVE:"items.trash.remove"},SITE_MEDIA:{LIST:"items.siteMedia.list",REMOVE:"items.siteMedia.remove",ADD:"items.siteMedia.add"}},ITEM:{GET:"item.get",UPDATE:"item.update",UPLOAD:"item.upload",UPLOAD_BY_URL:"item.uploadByUrl"},TRASH:{REMOVE:"trash.remove",RESTORE:"trash.restore"}}}),define("sources/bigstock/BigStock",["./settings","./folders","./items","../../utils/http","../../utils/utils","../decorators","../../events/list"],function(e,t,n,r,i,s,o){"use strict";return function(u){var a=i.extend({},e,u),f=r(),l=t(a,f),c=n(a,f);this.name="bigstock",this.folders=s.addEvents(this,o.FOLDERS,l),this.items=s.addEvents(this,o.ITEMS,c)}}),define("sources/shutterstock/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/shutterstock",itemsLimit:50}}),define("sources/shutterstock/mappers/folder",[],function(){"use strict";return function(e){return{id:e.id,name:e.name,mediaType:"picture",parentId:null,filesCount:null,createdAt:null}}}),define("sources/shutterstock/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t){return t.data=(t.data||[]).map(e),t}}),define("sources/shutterstock/folders",["./parsers/folders","bluebird_extended"],function(e,t){"use strict";return function(){function r(){return t.resolve(n)}var n=e({data:[{id:null,name:"All"},{id:0,name:"Transportation"},{id:1,name:"Animals/Wildlife"},{id:2,name:"Buildings/Landmarks"},{id:3,name:"Backgrounds/Textures"},{id:4,name:"Business/Finance"},{id:5,name:"Education"},{id:6,name:"Food and Drink"},{id:7,name:"Healthcare/Medical"},{id:8,name:"Holidays"},{id:9,name:"Objects"},{id:10,name:"Industrial"},{id:11,name:"The Arts"},{id:12,name:"Nature"},{id:13,name:"People"},{id:14,name:"Religion"},{id:15,name:"Science"},{id:16,name:"Technology"},{id:17,name:"Signs/Symbols"},{id:18,name:"Sports/Recreation"},{id:21,name:"Interiors"},{id:22,name:"Miscellaneous"},{id:24,name:"Vintage"},{id:25,name:"Parks/Outdoor"},{id:26,name:"Abstract"},{id:27,name:"Beauty/Fashion"},{id:30,name:"Model Released Only"},{id:31,name:"Celebrities"}]});return{list:r}}}),define("sources/shutterstock/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t){var n=e.normalizeUri(t.mosaic_url),r=e.normalizeUri(e.get(t,"assets.preview.url"));return{id:t.id,name:t.description,folderId:null,mediaType:"picture",fileUrl:null,thumbnailUrl:n,previewUrl:r,createdAt:null,tags:[],width:null,height:null}}}),define("sources/shutterstock/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){var n=t.data,r=n.total_count-n.page*n.per_page,i=r>0?n.page+1:null,s=n.per_page;return t.data=(n.data||[]).map(e),t.paging={cursor:i,size:s},t}}),define("sources/shutterstock/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){t.data=t.data||{};var n=t.data,r;return Array.isArray(n)?r=n[0].code||n[0]:r=n.code,t.data.message=r,e.reject(t)}}),define("sources/shutterstock/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(e){return e===null||typeof e=="undefined"?null:e}function s(s,o){o=o||{},o.paging=o.paging||{},o.sort=o.sort||{};var u={per_page:o.paging.size||n.itemsLimit,page:o.paging.cursor||null,order:o.sort.field||null,category:i(s),orientation:o.orientation||null};return r.get(n.apiUrl+"/search",u,{headers:o.headers||{}}).then(e).catch(t)}function o(s,o,u){u=u||{},u.paging=u.paging||{},u.sort=u.sort||{};var a={query:o||null,per_page:u.paging.size||n.itemsLimit,page:u.paging.cursor||null,order:u.sort.field||null,category:i(s),orientation:u.orientation||null};return r.get(n.apiUrl+"/search",a,{headers:u.headers||{}}).then(e).catch(t)}return{list:s,search:o}}}),define("sources/shutterstock/ShutterStock",["./settings","./folders","./items","../../utils/http","../../utils/utils","../decorators","../../events/list"],function(e,t,n,r,i,s,o){"use strict";return function(u){var a=i.extend({},e,u),f=r(),l=t(a,f),c=n(a,f);this.name="shutterstock",this.folders=s.addEvents(this,o.FOLDERS,l),this.items=s.addEvents(this,o.ITEMS,c)}}),define("sources/public/mappers/folder",[],function(){"use strict";return function(e,t){return{id:e.guid,name:e.title,mediaType:e.mediaType,parentId:t||null,filesCount:null,createdAt:null}}}),define("sources/public/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t){return t.data=(t.data.category.children||[]).map(e),t}}),define("sources/public/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return t.data=t.data||{},t.data.message=t.message,e.reject(t)}}),define("sources/public/folders",["../../utils/utils","./parsers/folders","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o){o=o||{};var u={levels:1,language:o.language};return e.startsWithGuid(s)?u.guid=s:u.legacyKey=s,i.get(r.apiUrl+"/categories",u,{withCredentials:!0,headers:o.headers||{}}).then(t).catch(n)}return{list:s}}}),define("services/thumbnail-generator/resize",["../../utils/utils"],function(e){"use strict";function t(e){return/\.(png|jpe?g|gif)/i.test(e)}function n(e){var t=e.split("/");return t.pop()||""}function r(e){var t=e.split("/");return t.length<=1?"":(t.pop(),t.join("/")+"/")}function s(e){return i[e]||e}function o(e,t){return e=e.replace(/[()\[\]\.^$|?+]/g,"\\$&"),new RegExp(e,t)}function u(e,t){return Object.keys(t).forEach(function(n){var r=o("#"+n+"#","g");e=e.replace(r,t[n])}),e}function l(e){return e.replace(f.VANGOGH,"").replace(f.VANBRANDT,"$1").replace(f.REMBRANDT,"$1$2")}var i={fill:"srz",fit:"srb"},a={vangogh:function(e){return r(e)+n(e)+"_#mode#_#width#_#height#_75_22_0.5_1.20_0.00_jpg_#mode#"},rembrandt:function(e){return r(e)+"v1/#mode#/w_#width#,h_#height#/"+n(e)},vanbrandt:function(e){return r(e)+n(e)+"/v1/#mode#/w_#width#,h_#height#/"+n(e)}},f={VANGOGH:/_sr[bz]_(?:[0-9\.]+_)+[a-z0-9]+_sr[bz]$/i,VANBRANDT:/([a-z0-9_\-]+\.[a-z0-9]+)\/v[0-9]+\/(?:fill|fit)\/[^\/]+\/\1$/i,REMBRANDT:/([a-z0-9_\-]+)\/v[0-9]+\/(?:fill|fit)\/[^\/]+(\/(?:\1|file)\.[a-z0-9_]+)$/i};return function(n,r,i){n=l(n);if(!t(n))return undefined;i=i||"rembrandt",r=e.extend({width:200,height:200,mode:"fill"},r),i==="vangogh"&&(r.mode=s(r.mode));var o=a[i](n),f=u(o,r);return e.normalizeUri(f)}}),define("services/thumbnail-generator/get-wix-thumbnails-urls",["../../utils/utils","./resize"],function(e,t){"use strict";function n(e,t){if(e.thumbnailUrl)return t+"/"+e.thumbnailUrl;switch(e.mediaType){case"picture":case"site_icon":case"watermark":case"secure_picture":return t+"/"+e.fileUrl;case"video":case"secure_video":if(e.fileOutput&&e.fileOutput.image&&e.fileOutput.image[2]&&e.fileOutput.image[2].url)return t+"/"+e.fileOutput.image[2].url;break;case"ufont":if(e.fileOutput&&e.fileOutput.image&&e.fileOutput.image[0]&&e.fileOutput.image[0].url)return t+"/"+e.fileOutput.image[0].url;break;default:}}function r(e,t){return Object.keys(e).reduce(function(e,n){return e[n+"Url"]=t,e},{})}function i(e,n,r){return Object.keys(e).reduce(function(i,s){var o=t(n,e[s],r);return o&&(i[s+"Url"]=o),i},{})}return function(t,s,o){var u=n(t,o.filesUrl),a={};return t.mediaType==="shape"?(t.thumbnailUrl=e.normalizeUri(o.filesUrl+"/"+t.thumbnailUrl),a=r(s,t.thumbnailUrl)):u&&(a=i(s,u,o.imageOperationsApi)),t.fileUrl&&(a.originalUrl=e.normalizeUri(o.filesUrl+"/"+t.fileUrl)),a}}),define("services/thumbnail-generator/get-wix-video-preview-urls",["../../utils/utils"],function(e){"use strict";return function(t,n){return!t.fileOutput||!t.fileOutput.video?null:t.fileOutput.video.filter(function(e){return e.quality<=n.videoPreviewQuality}).map(function(t){return e.normalizeUri(n.videoFilesUrl+"/"+t.url)})}}),define("sources/public/mappers/item",["../../../utils/utils","../../../services/thumbnail-generator/get-wix-thumbnails-urls","../../../services/thumbnail-generator/get-wix-video-preview-urls"],function(e,t,n){"use strict";return function(r,i,s){var o={id:r.guid,name:r.title,mediaType:r.mediaType,fileName:r.fileName,fileUrl:r.fileUrl,createdAt:null,tags:[],width:r.width,height:r.height,fileOutput:r.fileOutput||null,fileInput:r.fileInput||null,vendor:r.vendor||null,reference:r.reference||null,creator:r.creator||null,externalId:r.externalId||null};if(r.thumbnailUrl&&r.fileUrl){var u=r.fileUrl.split("/")[0];o.thumbnailUrl=u+"/"+r.thumbnailUrl}o.videoPreviewUrls=n(o,i);var a=e.extend({},i.thumbnailSizes,s);return e.extend(o,t(o,a,i)),o}}),define("sources/public/parsers/items",["../../../utils/utils","../mappers/item"],function(e,t){"use strict";return function(n,r,i){n.data.nextPage=n.data.nextPage||"";var s=e.getParameterByName(n.data.nextPage,"pageNumber")||null,o=e.getParameterByName(n.data.nextPage,"pageSize")||null;return n.data=(n.data.items||[]).map(function(e){return t(e,r,i)}),n.paging={cursor:s,size:o},n}}),define("sources/public/items",["../../utils/utils","./parsers/items","./parsers/error"],function(e,t,n){"use strict";return function(e,r){function i(i,s,o,u){return r.get(e.apiUrl+i,s,{withCredentials:!0,headers:u||{}}).then(function(n){return t(n,e,o)}).catch(n)}function s(t,n){n=n||{},n.paging=n.paging||{};var r={guid:t||null,language:n.language,pageSize:n.paging.size||e.itemsLimit,pageNumber:n.paging.cursor||1};return i("/items",r,n.thumbnails,n.headers)}function o(t,n,r){r=r||{},r.paging=r.paging||{};var s={guid:t||null,language:r.language,searchString:n||"",pageSize:r.paging.size||e.itemsLimit,pageNumber:r.paging.cursor||1};return i("/search",s,r.thumbnails,r.headers)}return{list:s,search:o}}}),define("sources/public/settings",[],function(){"use strict";return{apiUrl:"//publicmedia.wix.com/public",itemsLimit:50,imageOperationsApi:"vangogh",filesUrl:"//static.wixstatic.com",videoFilesUrl:"//video.wixstatic.com",thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"}},videoPreviewQuality:"480p"}}),define("sources/public/Public",["./folders","./items","../../utils/http","./settings","../../utils/utils","../../sources/decorators","../../events/list"],function(e,t,n,r,i,s,o){"use strict";return function(u){var a=i.extend({},r,u),f=n(),l=e(a,f),c=t(a,f);this.name="public",this.folders=s.addEvents(this,o.FOLDERS,l),this.items=s.addEvents(this,o.ITEMS,c)}}),define("sources/private/mappers/folder",[],function(){"use strict";return function(e){return{id:e.folder_id,parentId:e.parent_folder_id||null,name:e.folder_name,mediaType:e.media_type,filesCount:e.files_count,createdAt:e.created_ts}}}),define("sources/private/parsers/error",["bluebird_extended","../../../utils/mappers"],function(e){"use strict";return function(t){return t.status===403&&t.data&&t.data.error_description==="Missing Wix session"&&(t.status=401,t.data.message="Wix Session required"),e.reject(t)}}),define("sources/private/folders",["./mappers/folder","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(t){return t.data=(t.data.folders||[]).map(e),t}function s(e,s){return s=s||{},r.get(n.apiUrl+"/folders",{media_type:s.mediaType||"picture",folder_id:e||null},{headers:s.headers||{}}).then(i).catch(t)}function o(e,i){return r.post(n.apiUrl+"/folders/"+e+"/delete",{options:{headers:i.headers||{}}}).then(function(t){return t.data={id:e},t}).catch(t)}function u(e,t){return t=t||{},e.map(function(e){return o(e,t)})}return{list:s,remove:u}}}),define("sources/private/validators/new-props",[],function(){"use strict";return function(e){return typeof e!="object"||e===null?{valid:!1,message:"Please specify new props"}:typeof e.name!="undefined"&&!e.name?{valid:!1,message:"Please specify name"}:typeof e.folderId!="undefined"&&!e.folderId?{valid:!1,message:"Please specify folder id"}:typeof e.parentId!="undefined"&&!e.parentId?{valid:!1,message:"Please specify parent folder id"}:typeof e.tags!="undefined"&&!Array.isArray(e.tags)?{valid:!1,message:"Tags should be an array"}:{valid:!0}}}),define("sources/private/folder",["../../utils/mappers","../../utils/utils","./mappers/folder","./parsers/error","./validators/new-props"],function(e,t,n,r,i){"use strict";return function(s,o){function u(e){return e.data=n(e.data),e}function a(t,n){return t?(n=n||{},o.post(s.apiUrl+"/folders",{data:{folder_name:t,media_type:n.mediaType||"picture",parent_folder_id:n.parentId||null},options:{headers:n.headers||{}}}).then(u).catch(r)):r(e.toError({status:-200,statusText:"Internal JS Error",data:{message:"Please specify name"}}))}function f(n,u,a){var f=i(u);if(f.valid===!1)return r(e.toError({status:-200,statusText:"Internal JS Error",data:{message:f.message}}));var l={};return u.name&&(l.folder_name=u.name),u.parentId&&(l.parent_folder_id=u.parentId),a=a||{},o.post(s.apiUrl+"/folders/"+n.id+"/put",{data:l,options:{headers:a.headers||{}}}).then(function(e){return e.data=t.extend({},n,u),e}).catch(r)}return{create:a,update:f}}}),define("sources/private/mappers/item",["../../../utils/mappers","../../../utils/utils","../../../services/thumbnail-generator/get-wix-thumbnails-urls","../../../services/thumbnail-generator/get-wix-video-preview-urls"],function(e,t,n,r){"use strict";return function(i,s,o){var u=t.normalizeUri,a={id:i.file_name,folderId:i.parent_folder_id||null,fileSize:i.file_size,name:i.original_file_name,mediaType:i.media_type,fileUrl:i.file_url?u(i.file_url):null,createdAt:i.created_ts,readOnly:i.read_only||null,labels:i.labels||[],tags:t.splitTags(i.tags),width:i.width||null,height:i.height||null,fileInfo:i.file_info?e.toObject(i.file_info):null,fileInput:i.file_input?e.toObject(i.file_input):null,fileOutput:i.file_output?e.toObject(i.file_output):null,transcodingStatus:i.op_status},f=t.extend({},s.thumbnailSizes,o);return t.extend(a,n(a,f,s)),f.thumbnail&&!a.thumbnailUrl&&i.icon_url&&(a.thumbnailUrl=u(s.filesUrl+"/"+i.icon_url)),Object.keys(f).forEach(function(e){a[e+"Url"]||(a[e+"Url"]=a.thumbnailUrl)}),Object.keys(a).forEach(function(e){a[e]===undefined&&delete a[e]}),a.videoPreviewUrls=r(a,s)||null,a}}),define("sources/private/items",["bluebird_extended","../../utils/utils","./mappers/item","./parsers/error"],function(e,t,n,r){"use strict";return function(e,i){function s(t,r){return t.data=(t.data.files||[]).map(function(t){return n(t,e,r)}),t}function f(n,f){f=f||{};var l=t.extend({},u,f.sort),c=t.extend({},o,f.paging),h={page_size:c.size,cursor:c.cursor,parent_folder_id:n,media_type:f.mediaType||"picture"};return h.order=l.direction==="desc"?"-"+l.order:l.order,i.get(e.apiUrl+"/files/getpage",h,{headers:f.headers||{}}).then(function(e){return e.paging={size:c.size,cursor:a===e.data.cursor?null:e.data.cursor},a=e.data.cursor,s(e,f.thumbnails)}).catch(r)}function l(t,n){var s={};return e.ns&&(s.ns=e.ns),i.post(e.apiUrl+"/files/"+t+"/delete",{params:s,options:{headers:n.headers||{}}}).then(function(e){return e.data={id:t},e}).catch(r)}function c(e,t){return t=t||{},e.map(function(e){return l(e,t)})}function h(n,a){a=a||{};var f=t.extend({},u,a.sort),l=t.extend({},o,a.paging),c={page_size:l.size,cursor:l.cursor,media_type:a.mediaType||"picture",order:f.direction==="desc"?"-"+f.order:f.order};return i.get(e.apiUrl+"/files/get?tag="+n,c,{cache:!1,headers:a.headers||{}}).then(function(e){return e.paging={size:l.size,cursor:e.data.cursor},s(e,a.thumbnails)}).catch(r)}function p(n,a,f){f=f||{};var l=t.extend({},u,f.sort),c=t.extend({},o,f.paging);a=encodeURIComponent(a);var h={page_size:c.size,cursor:c.cursor,media_type:f.mediaType||"picture",parent_folder_id:n,order:l.direction==="desc"?"-"+l.order:l.order};return i.get(e.apiUrl+"/files/search/getpage?query="+a,h,{cache:!1,headers:f.headers||{}}).then(function(e){return e.paging={size:c.size,cursor:e.data.cursor},s(e,f.thumbnails)}).catch(r)}var o={size:50,cursor:null},u={order:"date",direction:"desc"},a=null;return{list:f,remove:c,searchByTag:h,search:p}}}),define("sources/private/item",["bluebird_extended","../../utils/utils","./mappers/item","./parsers/error","./validators/new-props","../../utils/mappers"],function(e,t,n,r,i,s){"use strict";var o="READY",u=15e3,a=6e5,f=4096;return function(l,c,h){function m(e){return l.uploadLimits[t.snakeToCamel(e)]}function g(e){return e.file.size>=m(e.mediaType)}function y(e,t){return e.data=n(e.data,l,t),e}function b(){p=!0,clearTimeout(d),h.off("message",v)}function w(e,n){return function(r){var i=t.get(r,"file.file_name");r.type==="status_update"&&t.get(r,"file.op_status")===o&&i===e&&n(i)}}function E(n,r){setTimeout(function(){if(p)return;k(n).then(function(i){if(t.get(i,"data.transcodingStatus")!==o)return e.reject();r(n)}).catch(function(){E(n,r)})},u)}function S(t){return new e(function(e,n){if(!t){n();return}E(t,e)})}function x(n){p=!1;var r=t.get(n,"data.payload.file_name")||t.get(n,"data.file_name"),i=new e(function(e){v=w(r,e),h.on("message",v)}),s=new e(function(e,t){d=setTimeout(function(){t({status:406,data:{message:"Not ready item"}})},a)});return e.race([i,S(r),s]).then(function(t){return b(),e.resolve(t)}).catch(function(t){return b(),e.reject(t)})}function T(e){function t(e){return e==="secure_music"?"music-goods/upload":e==="video"?"video/upload":"upload"}var n=e.file;return c.post(l.apiUrl+"/files/"+t(e.mediaType)+"/url",{data:{media_type:e.mediaType,file_name:n.name.toLowerCase(),file_size:n.size,content_type:n.type},options:{withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}}})}function N(e,n){n=n||{};var i={url:t.normalizeUri(e.url),media_type:e.mediaType,name:e.name||"Untitled",tags:e.tags?e.tags.join(","):null,parent_folder_id:e.folderId||null};l.siteMediaToken&&(i.siteMediaToken=l.siteMediaToken);var s=l.apiUrl+"/files/upload/external";if(l.asyncUploadByUrl){h.open();var o=s+"/async",u=t.extend({},n.headers,{"Content-Type":"application/x-www-form-urlencoded"});return c.post(o,{data:i,options:{headers:u}}).then(x).then(k).catch(r)}var a=c.get(s,i,{headers:n.headers||{}}).progress(function(e){a.notify(e)}).then(function(e){return y(e,n.thumbnails)});return a}function C(i,o){o=o||{};var u={parent_folder_id:i.folderId||null,file:i.file,media_type:i.mediaType};i.catalogCallbackUrl&&(u.cat_callback_url=i.catalogCallbackUrl),i.encodingOptions&&(u.encoding_options=JSON.stringify(i.encodingOptions)),l.vision&&(u.vision=l.vision.join(",")),l.siteMediaToken&&(u.siteMediaToken=l.siteMediaToken);if(g(i)){var a=t.bytesToSize(m(i.mediaType)),p=t.bytesToSize(i.file.size);return e.reject(s.toError({status:-406,statusText:"Not Acceptable",data:{error_code:-7752,error_description:"File size "+p+" exceeds upload limit of "+a,error_info:{key:"wmp_error.file_size_exceeded_limit",args:[p,a]}}}))}var d=l.asyncFontUpload,v=u.media_type==="ufont",y=t.get(u,"file.size")>f,b=d&&v&&y,w=T(i).then(function(e){var t=e.data;return u.upload_token=t.upload_token,b&&(h.open(),u.upload_async=!0),c.upload(t.upload_url,u,{headers:o.headers||{}}).progress(function(e){w.notify(e)})}).then(function(e){return e.data=e.data[0],b?x(e).then(k):(e.data=n(e.data,l),e)}).catch(r);return w}function k(e,t){return t=t||{},c.get(l.apiUrl+"/files/"+e,null,{cache:!1,headers:t.headers||{}}).then(function(e){return y(e,t.thumbnails)}).catch(r)}function L(e,n,o){var u=i(n);if(u.valid===!1)return r(s.toError({status:-200,statusText:"Internal JS Error",data:{message:u.message}}));var a={};return n.name&&(a.original_file_name=n.name),n.folderId&&(a.parent_folder_id=n.folderId),n.tags&&(a.tags=n.tags.join(",")),o=o||{},c.post(l.apiUrl+"/files/"+e.id+"/put",{data:a,options:{headers:o.headers||{}}}).then(function(r){return r.data=t.extend({},e,n),r}).catch(r)}var p,d,v;return{upload:C,uploadByUrl:N,get:k,update:L}}}),define("sources/private/trash",["./parsers/error"],function(e){"use strict";return function(t,n){function r(r){return n.post(t.apiUrl+"/trash/delete",{data:{media_type:r.mediaType||"picture",all_files:!0}}).catch(e)}function i(r){return n.post(t.apiUrl+"/trash/restore",{data:{media_type:r.mediaType||"picture",all_files:!0}}).catch(e)}return{remove:r,restore:i}}}),define("sources/private/items.trash",["bluebird_extended","../../utils/utils","./mappers/item","./parsers/error"],function(e,t,n,r){"use strict";return function(e,i){function s(t,r){return t.data=(t.data.trash_files||[]).map(function(t){var i=n(t,e,r);return i.isInTrash=!0,i}),t}function a(n,a){a=a||{};var f=t.extend({},u,a.sort),l=t.extend({},o,a.paging),c={page_size:l.size,cursor:l.cursor,parent_folder_id:n,media_type:a.mediaType||"picture"};return c.order=f.direction==="desc"?"-"+f.order:f.order,i.get(e.apiUrl+"/files/getpage/trash",c,{headers:a.headers||{}}).then(function(e){return e.paging={size:l.size,cursor:e.data.cursor},s(e,a.thumbnails)}).catch(r)}function f(t,n){return i.post(e.apiUrl+"/trash/files/"+t+"/delete",{options:{headers:n.headers||{}}}).then(function(e){return e.data={id:t},e}).catch(r)}function l(e,t){return t=t||{},e.map(function(e){return f(e,t)})}function c(t,n){return i.post(e.apiUrl+"/trash/files/"+t+"/restore",{options:{headers:n.headers||{}}}).then(function(e){return e.data={id:t},e}).catch(r)}function h(e,t){return t=t||{},e.map(function(e){return c(e,t)})}var o={size:50,cursor:null},u={order:"date",direction:"desc"};return{list:a,remove:l,restore:h}}}),define("sources/private/items.site-media",["bluebird_extended","../../utils/utils","./mappers/item","./parsers/error"],function(e,t,n,r){"use strict";return function(e,i){function s(t,r){return t.data=(t.data.files||[]).map(function(t){var i=n(t,e,r);return i.isInSiteMedia=!0,i}),t}function a(n,a){a=a||{};var f=t.extend({},u,a.sort),l=t.extend({},o,a.paging),c={page_size:l.size,cursor:l.cursor,parent_folder_id:n,media_type:a.mediaType||"picture",siteMediaToken:e.siteMediaToken};return c.order=f.direction==="desc"?"-"+f.order:f.order,i.get(e.apiUrl+"/files/getpage/site",c,{headers:a.headers||{}}).then(function(e){return e.paging={size:l.size,cursor:e.data.cursor},s(e,a.thumbnails)}).catch(r)}function f(t,n){var s={files:[t]};return i.post(e.apiUrl+"/files/site/remove?siteMediaToken="+e.siteMediaToken,{data:s,options:{headers:n.headers||{}}}).then(function(e){return e.data={id:t},e}).catch(r)}function l(e,t){return t=t||{},e.map(function(e){return f(e,t)})}function c(t,n){n=n||{};var s={files:t};return i.post(e.apiUrl+"/files/site/add?siteMediaToken="+e.siteMediaToken,{data:s,options:{headers:n.headers||{}}}).catch(r)}var o={size:50,cursor:null},u={order:"date",direction:"desc"};return{list:a,remove:l,add:c}}}),define("sources/private/folders.trash",["bluebird_extended","../../utils/utils","./mappers/folder","./parsers/error"],function(e,t,n,r){"use strict";return function(e,t){function i(e){return e.data=(e.data.trash_folders||[]).map(function(e){var t=n(e);return t.isInTrash=!0,t}),e}function s(n,s){s=s||{};var o={media_type:s.mediaType||"picture",folder_id:n||null,trash_type:"folder"};return t.get(e.apiUrl+"/files/getpage/trash",o,{headers:s.headers||{}}).then(i).catch(r)}function o(n,i){return t.post(e.apiUrl+"/trash/folders/"+n+"/delete",{options:{headers:i.headers||{}}}).then(function(e){return e.data={id:n},e}).catch(r)}function u(e,t){return t=t||{},e.map(function(e){return o(e,t)})}function a(n,i){return t.post(e.apiUrl+"/trash/folders/"+n+"/restore",{options:{headers:i.headers||{}}}).then(function(e){return e.data={id:n},e}).catch(r)}function f(e,t){return t=t||{},e.map(function(e){return a(e,t)})}return{list:s,remove:u,restore:f}}}),define("sources/private/settings",[],function(){"use strict";return{apiUrl:"//files.wix.com",imageOperationsApi:"vangogh",filesUrl:"//static.wixstatic.com",videoFilesUrl:"//video.wixstatic.com",refreshTokenUrl:null,requestOptions:{withCredentials:!0},uploadLimits:{"default":15728640,document:15728640,picture:15728640,music:52428800,secureMusic:377487360,video:524288e3,secureVideo:1610612736},thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"},original:{width:1e3,height:1e3,mode:"fit"}},channel:{withCredentials:!0,jsapiUrl:"/_ah/channel/jsapi",tokenUrl:"/users/channel"},blackArrow:{enabled:!1,wsUrl:"wss://ws.wixmp.com/ws",messageUrl:"https://ws.wixmp.com/message",tokenUrl:"/users/get-batoken"},asyncFontUpload:!1,asyncUploadByUrl:!1,asyncTranscoding:!1,videoPreviewQuality:"480p"}}),define("services/channel/channel",["bluebird_extended","../../utils/http","../../utils/utils","../../events/notifier","../../events/list"],function(e,t,n,r,i){"use strict";var s=15e5,o="READY";return function(u,a,f){function v(e){var t=r.emit(a,i.ITEM.UPDATE,{arguments:[e.data,e.data]});t.resolve(e)}function m(e){if(e.data==="server connected")return;try{e=JSON.parse(e.data)}catch(t){return}if(e.type==="status_update")if(n.get(e,"file.op_status")===o)a.item.get(n.get(e,"file.file_name")).then(v);else{var r=f(e.file,u,{},!0);v({data:r})}}function g(){c&&h&&(w(),y())}function y(){var t=u.apiUrl+n.get(u,"channel.tokenUrl"),r=n.get(u,"channel.withCredentials"),i=l.get(t,null,{withCredentials:r});return i.then(function(e){return c=new goog.appengine.Channel(e.data.token),h=c.open(),h.onmessage=m,h.onclose=g,h.onerror=g,d=setInterval(g,s),h}).catch(function(t){return e.reject(t)})}function b(){var t=e.defer();if(c&&h)t.resolve();else{var r;if(p)r=e.resolve();else{var i=n.get(u,"channel.jsapiUrl");r=n.getScript(u.apiUrl+i).then(function(){p=!0})}r.then(y).then(function(){t.resolve()}).catch(function(e){t.reject(e)})}return t.promise}function w(){h&&(c=null,h.close(),h=null,d&&clearInterval(d))}var l=t(),c=null,h=null,p=!1,d=null;return{open:b,close:w}}}),define("services/channel/black-arrow",["bluebird_extended","../../utils/http","../../utils/utils","../../events/notifier","../../events/list"],function(e,t,n,r,i){"use strict";var s=3e4,o="READY";return function(e,u,a){function g(e){var t=r.emit(u,i.ITEM.UPDATE,{arguments:[e.data,e.data]});t.resolve(e)}function y(e){return function(t){return t.name===e}}function b(e,t){typeof e=="string"&&(e=[e]),e.forEach(function(e){if(v.indexOf(e)<0)throw new Error("This event "+e+" is not supported by websocket");m.push({name:e,fn:t})})}function w(e,t){typeof e=="string"&&(e=[e]),m=m.filter(function(n){return!e.some(function(e){return n.name===e&&(!t||n.fn===t)})})}function E(e,t){var n=[].slice;t=arguments.length>=2?n.call(arguments,1):[],m.filter(y(e)).forEach(function(n){n.fn.apply({event:e},t)})}function S(){if(!e.blackArrow.enabled)return;if(l||h)return;h=!0,p=!0,clearInterval(d),c?T():f.get(e.apiUrl+e.blackArrow.tokenUrl,null,{withCredentials:!0}).then(function(e){c=n.get(e,"data.token"),T()}).catch(x),E("open")}function x(){h=!1,l=null,d=setInterval(function(){if(!p||l){clearInterval(d);return}S()},s)}function T(){if(!c)return;l=new WebSocket(e.blackArrow.wsUrl+"?token="+c),l.onmessage=C,l.onclose=x,l.onerror=x}function N(){p=!1,l&&(l.close(),h=!1,l=null,E("close"))}function C(t){try{t=JSON.parse(t.data)}catch(s){return}if(t.type==="status_update"&&e.asyncTranscoding)if(n.get(t,"file.op_status")===o)u.item.get(n.get(t,"file.file_name")).then(g);else{var f=a(t.file,e,{},!0);g({data:f})}t.type==="trash_file"&&r.emitResolve(u,i.ITEMS.REMOVE,{arguments:[[t.file_name]]},{data:{id:t.file_name}}),E("message",t)}function k(t,n,r){if(!c)return;if(!t)return;n=n||"broadcast",r==="post"||!l?f.post(e.blackArrow.messageUrl,{data:{token:c,action:n,message:JSON.stringify(t)},options:{headers:{"Content-Type":"application/x-www-form-urlencoded"}}}):l.send(JSON.stringify({action:n,message:t}))}var f=t(),l=null,c=null,h=!1,p,d,v=["open","close","message"],m=[];return{open:S,close:N,send:k,on:b,off:w}}}),define("sources/private/refresh-token-wrapper",["bluebird_extended","../../utils/http","../../utils/utils"],function(e,t,n){"use strict";var r=t();return function(t){function o(){return(new Date).valueOf()-s<1e4}var i={},s=0;return function(u){var a=function(){var e=(arguments[2]||{}).headers||{};return u.call(this,arguments[0],arguments[1]||{},n.merge(arguments[2]||{},{headers:n.merge(i,e)}))};return r.catchError(a,function(n,u){return n.code===403&&!o()?r.post(t).then(function(e){return i=e.data.set_headers||{},s=(new Date).valueOf(),u()}):e.reject(n)})}}}),define("sources/private/Private",["./folders","./folder","./items","./item","./trash","./items.trash","./items.site-media","./folders.trash","./mappers/item","./settings","../../utils/utils","../decorators","../../events/list","../../services/channel/channel","../../services/channel/black-arrow","./refresh-token-wrapper","../../utils/http"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){"use strict";return function(g){var y=l.extendDeep({},f,g),b=v(y.refreshTokenUrl),w=y.requestOptions;l.get(w,"params.ns")&&(y.ns=w.params.ns);var E=m(w),S=d(y,this,a,E),x={get:b(E.get),post:b(E.post),upload:b(E.upload)},T=y.refreshTokenUrl?x:E,N=e(y,T),C=t(y,T),k=n(y,T),L=r(y,T,S),A=i(y,T),O=s(y,T),M=o(y,T),_=u(y,T),D=p(y,this,a,E);N.trash=_,k.trash=O,k.siteMedia=M,this.name="private",this.folders=c.addEvents(this,h.FOLDERS,N),this.folder=c.addEvents(this,h.FOLDER,C),this.item=c.addEvents(this,h.ITEM,L),this.items=c.addEvents(this,h.ITEMS,k),this.trash=c.addEvents(this,h.TRASH,A),this.blackArrow=S,this.channel=D}}),define("sources/picasa/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/google",foldersLimit:500,itemsLimit:50}}),define("sources/picasa/mappers/folder",[],function(){"use strict";return function(e){return{id:e.gphoto$id.$t,name:e.title.$t,mediaType:"picture",thumbnailUrl:e.media$group.media$thumbnail[0].url,parentId:null,filesCount:e.gphoto$numphotos.$t,createdAt:e.published.$t}}}),define("sources/picasa/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t){return t.data=(t.data.feed.entry||[]).map(e),t}}),define("sources/picasa/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/picasa/folders",["./parsers/folders","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={thumbsize:"150c","max-results":s.paging.size||n.foldersLimit,"start-index":s.paging.cursor||1};return r.get(n.apiUrl+"/albums",o,{withCredentials:!0,headers:s.headers||{}}).then(e).catch(t)}return{list:i}}}),define("sources/picasa/mappers/item",["../../../utils/utils"],function(e){"use strict";function t(e){var t=e.media$thumbnail.filter(function(e){return!e.medium||e.medium!=="video"});return t[t.length-1].url||""}return function(n){var r,i,s,o,u;return r=t(n.media$group),i=Number(n.gphoto$width.$t||1024),s=Number(n.gphoto$height.$t||768),o=r.replace(/\/s[0-9]+/,"/w"+i+"-h"+s+"-no"),i>400?u=r.replace(/\/s[0-9]+(-c)?/,"/s400"):u=o,{id:n.id.$t,name:n.summary.$t||n.title.$t,mediaType:"picture",fileUrl:e.normalizeUri(o),thumbnailUrl:e.normalizeUri(r),previewUrl:e.normalizeUri(u),createdAt:n.published.$t,tags:[],width:i,height:s}}}),define("sources/picasa/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){var n={cursor:t.data.feed.openSearch$startIndex.$t+t.data.feed.openSearch$itemsPerPage.$t,size:t.data.feed.openSearch$itemsPerPage.$t};return t.data=(t.data.feed.entry||[]).map(e),t.paging=n,t}}),define("sources/picasa/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={album_id:i||null,kind:"photo",thumbsize:"150c","max-results":s.paging.size||n.itemsLimit,"start-index":s.paging.cursor||1};return r.get(n.apiUrl+"/photos",o,{withCredentials:!0,headers:s.headers||{}}).then(e).catch(t)}return{list:i}}}),define("sources/picasa/Picasa",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list"],function(e,t,n,r,i,s){"use strict";return function(){var o=r(),u=t(e,o),a=n(e,o);this.name="picasa",this.folders=i.addEvents(this,s.FOLDERS,u),this.items=i.addEvents(this,s.ITEMS,a)}}),define("sources/drive/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/gdrive",foldersLimit:500,itemsLimit:50}}),define("sources/drive/mappers/folder",[],function(){"use strict";return function(e){return{id:e.id,name:e.title,mediaType:"picture",parentId:e.parents[0].id,filesCount:1,createdAt:e.createdDate}}}),define("sources/drive/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t){return t.data=(t.data.items||[]).map(e),t}}),define("sources/drive/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/drive/folders",["./parsers/folders","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={"max-results":s.paging.size||n.foldersLimit,"start-index":s.paging.cursor||1};return i&&(o.album_id=i),r.get(n.apiUrl+"/albums",o,{withCredentials:!0}).then(e).catch(t)}return{list:i}}}),define("sources/drive/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t){return{id:t.id,name:t.title,mediaType:"picture",fileUrl:e.normalizeUri(t.fixedDownloadUrl||t.webContentLink),thumbnailUrl:t.thumbnailLink?e.normalizeUri(t.thumbnailLink):null,previewUrl:t.thumbnailLink?e.normalizeUri(t.thumbnailLink):null,createdAt:t.createdDate,tags:[],width:t.imageMediaMetadata.width,height:t.imageMediaMetadata.height}}}),define("sources/drive/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){return t.data=(t.data.items||[]).map(e),t.paging={},t}}),define("sources/drive/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={album_id:i||null,"max-results":s.paging.size||n.itemsLimit,"start-index":s.paging.cursor||1};return r.get(n.apiUrl+"/photos",o,{withCredentials:!0}).then(e,t)}return{list:i}}}),define("sources/drive/Drive",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list"],function(e,t,n,r,i,s){"use strict";return function(){var o=r(),u=t(e,o),a=n(e,o);this.name="drive",this.folders=i.addEvents(this,s.FOLDERS,u),this.items=i.addEvents(this,s.ITEMS,a)}}),define("sources/dropbox/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/dropbox",foldersLimit:500,itemsLimit:50}}),define("sources/dropbox/mappers/folder",[],function(){"use strict";return function(e){return{id:e.path,name:e.path.substr(e.path.lastIndexOf("/")+1),mediaType:"picture",parentId:null,filesCount:1,createdAt:e.modified}}}),define("sources/dropbox/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t){return t.data=(t.data||[]).map(e),t}}),define("sources/dropbox/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/dropbox/folders",["./parsers/folders","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={"max-results":s.paging.size||n.foldersLimit,"start-index":s.paging.cursor||1};return i&&(o.album_id=i),r.get(n.apiUrl+"/albums",o,{withCredentials:!0}).then(e).catch(t)}return{list:i}}}),define("sources/dropbox/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t){function r(e){return encodeURIComponent(e).replace("'","%27")}var n=t.path.substr(t.path.lastIndexOf("/")+1);return{id:t.path,name:n,mediaType:"picture",fileUrl:e.normalizeUri(t.fixedDownloadUrl),thumbnailUrl:e.normalizeUri("//pix.wix.com/services/dropbox/thumb?path="+r(t.path)+"&size=l"),previewUrl:e.normalizeUri("//pix.wix.com/services/dropbox/thumb?path="+r(t.path)+"&size=l"),createdAt:t.client_mtime,tags:[]}}}),define("sources/dropbox/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){return t.data=(t.data||[]).map(e),t.paging={},t}}),define("sources/dropbox/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={album_id:i||null,"max-results":s.paging.size||n.itemsLimit,"start-index":s.paging.cursor||1};return r.get(n.apiUrl+"/photos",o,{withCredentials:!0}).then(e,t)}return{list:i}}}),define("sources/dropbox/Dropbox",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list"],function(e,t,n,r,i,s){"use strict";return function(){var o=r(),u=t(e,o),a=n(e,o);this.name="dropbox",this.folders=i.addEvents(this,s.FOLDERS,u),this.items=i.addEvents(this,s.ITEMS,a)}}),define("sources/instagram/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/instagram",api2Url:"//pix.wix.com/services/instagram2",itemsLimit:50}}),define("sources/instagram/mappers/folder",[],function(){"use strict";return function(e){return{id:"Instagram",name:"Instagram",mediaType:"picture",parentId:null,filesCount:e.counts.media,createdAt:null}}}),define("sources/instagram/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t){return{data:[e(t)]}}}),define("sources/instagram/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return t.code===500&&(t.code=403,t.data={message:"Unauthorized",result:"error"}),e.reject(t)}}),define("sources/instagram/folders",["./parsers/folders","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(t){return e(t.data)}function s(e,s){return s=s||{},r.get(n.apiUrl+"/user",null,{withCredentials:!0,headers:s.headers||{}}).then(i).catch(t)}return{list:s}}}),define("sources/instagram/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t){return t.caption||(t.caption={text:""}),{id:t.id,name:t.caption.text,mediaType:"picture",fileUrl:e.normalizeUri(t.images.standard_resolution.url),thumbnailUrl:e.normalizeUri(t.images.low_resolution.url),previewUrl:e.normalizeUri(t.images.standard_resolution.url),createdAt:Number(t.created_time)*1e3,tags:e.splitTags(t.tags),width:t.images.standard_resolution.width,height:t.images.standard_resolution.height}}}),define("sources/instagram/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){t.data.next=t.data.next||{};var n=t.data.next.max_id||null,r=t.data.next.count||null;return t.data=(t.data.photos||[]).map(e),t.paging={cursor:n,size:r},t}}),define("sources/instagram/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={count:s.paging.size||n.itemsLimit,max_id:s.paging.cursor||null};return r.get(n.api2Url+"/photos",o,{withCredentials:!0,headers:s.headers||{}}).then(e).catch(t)}return{list:i}}}),define("sources/instagram/Instagram",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list"],function(e,t,n,r,i,s){"use strict";return function(){var o=r(),u=t(e,o),a=n(e,o);this.name="instagram",this.folders=i.addEvents(this,s.FOLDERS,u),this.items=i.addEvents(this,s.ITEMS,a)}}),define("sources/instagram-video/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/instagram2",itemsLimit:50,thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"}}}}),define("sources/instagram-video/mappers/folder",[],function(){"use strict";return function(){return{id:"InstagramVideo",name:"InstagramVideo",mediaType:"video",parentId:null,filesCount:null,createdAt:null}}}),define("sources/instagram-video/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(){return{data:[e()]}}}),define("sources/instagram-video/folders",["./parsers/folders","bluebird_extended"],function(e,t){"use strict";return function(){function n(){return t.resolve(e())}return{list:n}}}),define("sources/instagram-video/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t,n){var r={id:n.id,name:e.replaceHtml(n.caption?n.caption.text:n.id),fileName:n.id,previewUrl:n.images.thumbnail.url,thumbnailUrl:n.images.thumbnail.url,videoPreviewUrl:[n.videos.standard_resolution.url],embedHtml:'<video controls width="'+n.videos.standard_resolution.width+'" height="'+n.videos.standard_resolution.height+'" poster="'+n.images.thumbnail.url+'"><source src="'+n.videos.standard_resolution.url+'" type="video/mp4" /></video>',width:Number(n.videos.standard_resolution.width),height:Number(n.videos.standard_resolution.height),createdAt:Number(n.created_time),externalSources:{videos:n.videos,images:n.images},folderId:null,mediaType:"video"};if(!n.format)return r;var i=n.format.map(function(t){return e.extend({},t,{url:t.picture})}),s=e.getThumbnailsUrlsFromList(i,t.thumbnailSizes);return e.extend(r,s)}}),define("sources/instagram-video/parsers/items",["../mappers/item","../../../utils/utils"],function(e,t){"use strict";return function(n,r){var i=null,s=null;return r.data.paging&&r.data.paging.cursors&&r.data.paging.cursors.after&&r.data.paging.next&&(i=r.data.paging.cursors.after,s=Number(t.getParameterByName(r.data.paging.next,"limit"))),r.data=(r.data.videos||[]).map(t.partial(e,n)),r.paging={cursor:i,size:s},r}}),define("sources/instagram-video/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/instagram-video/items",["../../utils/utils","./parsers/items","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o){o=o||{},o.paging=o.paging||{};var u=o.thumbnailSizes?{thumbnailSizes:o.thumbnailSizes}:{},a=e.merge({},r,u),f={limit:o.paging.size||r.itemsLimit,after:o.paging.cursor||null};return i.get(r.apiUrl+"/videos",f,{withCredentials:!0,headers:o.headers||{}}).then(e.partial(t,a)).catch(n)}return{list:s}}}),define("sources/instagram-video/InstagramVideo",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list","../../utils/utils"],function(e,t,n,r,i,s,o){"use strict";return function(u){u=o.extend({},e,u);var a=r(),f=t(u,a),l=n(u,a);this.name="instagramVideo",this.folders=i.addEvents(this,s.FOLDERS,f),this.items=i.addEvents(this,s.ITEMS,l)}}),define("sources/facebook/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/facebook2",foldersLimit:50,itemsLimit:50}}),define("sources/facebook/mappers/folder",["../../../utils/utils"],function(e){"use strict";return function(t,n){return{id:t.id,name:t.name,mediaType:"picture",parentId:null,thumbnailUrl:e.normalizeUri(n.apiUrl+"/picture?type=album&album_id="+t.id),filesCount:t.count,createdAt:t.created_time}}}),define("sources/facebook/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t,n){return n.data=(n.data.data||[]).map(function(n){return e(n,t)}),n}}),define("sources/facebook/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return t.code===400&&t.data&&t.data.code===190&&(t.code=403),e.reject(t)}}),define("sources/facebook/folders",["../../utils/utils","./parsers/folders","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o){o=o||{},o.paging=o.paging||{};var u={limit:o.paging.size||r.foldersLimit,after:o.paging.cursor||null};return i.get(r.apiUrl+"/albums",u,{withCredentials:!0,headers:o.headers||{}}).then(e.partial(t,r)).catch(n)}return{list:s}}}),define("sources/facebook/mappers/item",["../../../utils/utils"],function(e){"use strict";function t(t,n,r){r=r||190,n=n||190;var i,s,o;return t.length===1?t[0].source:(i=t.filter(function(e){return e.width>n&&e.height>r}),o=e.min(i,function(e){return e.width+e.height}),o?o.source:(s=e.max(t,function(e){return e.width+e.height}),s.source))}return function(n){return{id:n.id,folderId:null,name:n.name||"",mediaType:"picture",fileUrl:e.normalizeUri(n.source),thumbnailUrl:e.normalizeUri(t(n.images)),previewUrl:e.normalizeUri(n.source),createdAt:n.created_time,tags:[],width:n.width,height:n.height}}}),define("sources/facebook/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){var n;return t.data.paging&&t.data.paging.cursors&&(n=t.data.paging.cursors.after),t.data=(t.data.data||[]).map(e),t.paging={cursor:n||null,size:null},t}}),define("sources/facebook/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={album_id:i,limit:s.paging.size||n.itemsLimit,after:s.paging.cursor||null};return r.get(n.apiUrl+"/photos",o,{withCredentials:!0,headers:s.headers||{}}).then(e).catch(t)}return{list:i}}}),define("sources/facebook/Facebook",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list"],function(e,t,n,r,i,s){"use strict";return function(){var o=r(),u=t(e,o),a=n(e,o);this.name="facebook",this.folders=i.addEvents(this,s.FOLDERS,u),this.items=i.addEvents(this,s.ITEMS,a)}}),define("sources/facebook-video/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/facebook2",itemsLimit:50,thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"}}}}),define("sources/facebook-video/mappers/folder",[],function(){"use strict";return function(){return{id:"FacebookVideo",name:"FacebookVideo",mediaType:"video",parentId:null,filesCount:null,createdAt:null}}}),define("sources/facebook-video/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(){return{data:[e()]}}}),define("sources/facebook-video/folders",["./parsers/folders","bluebird_extended"],function(e,t){"use strict";return function(){function n(){return t.resolve(e())}return{list:n}}}),define("sources/facebook-video/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t,n){function r(e,t){var n=new RegExp(t+'="(.+?)"',"i"),r=e.match(n);return r?r[1]:""}function i(t){var n=t.replace(/([+\-]\d\d)(\d\d)$/,"$1:$2");return e.toTimeStamp(n)}var s={id:Number(n.id),name:e.replaceHtml(n.title),iframeSrc:r(n.embed_html,"src"),embedHtml:n.embed_html,width:Number(r(n.embed_html,"width")),height:Number(r(n.embed_html,"height")),createdAt:i(n.created_time),folderId:null,mediaType:"video"};if(!n.format)return s;var o=n.format.map(function(t){return e.extend({},t,{url:t.picture})}),u=e.getThumbnailsUrlsFromList(o,t.thumbnailSizes);return e.extend(s,u)}}),define("sources/facebook-video/parsers/items",["../mappers/item","../../../utils/utils"],function(e,t){"use strict";return function(n,r){var i=null,s=null;return r.data.paging&&r.data.paging.cursors&&r.data.paging.cursors.after&&r.data.paging.next&&(i=r.data.paging.cursors.after,s=Number(t.getParameterByName(r.data.paging.next,"limit"))),r.data=(r.data.data||[]).map(t.partial(e,n)),r.paging={cursor:i,size:s},r}}),define("sources/facebook-video/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/facebook-video/items",["../../utils/utils","./parsers/items","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o){var u=o.thumbnailSizes?{thumbnailSizes:o.thumbnailSizes}:{},a=e.merge({},r,u);o=o||{},o.paging=o.paging||{};var f={limit:o.paging.size||r.itemsLimit,after:o.paging.cursor||null};return i.get(r.apiUrl+"/videos",f,{withCredentials:!0,headers:o.headers||{}}).then(e.partial(t,a)).catch(n)}return{list:s}}}),define("sources/facebook-video/FacebookVideo",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list","../../utils/utils"],function(e,t,n,r,i,s,o){"use strict";return function(u){var a=o.extend({},e,u),f=r(),l=t(a,f),c=n(a,f);this.name="facebookVideo",this.folders=i.addEvents(this,s.FOLDERS,l),this.items=i.addEvents(this,s.ITEMS,c)}}),define("sources/flickr/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/flickr",foldersLimit:50,itemsLimit:50}}),define("sources/flickr/mappers/folder",[],function(){"use strict";return function(e){return{id:e.id,name:e.title._content,mediaType:"picture",thumbnailUrl:e.primary_photo_extras.url_m||e.primary_photo_extras.url_s||e.primary_photo_extras.url_t,parentId:null,filesCount:Number(e.photos)+Number(e.videos),createdAt:Number(e.date_create)*1e3}}}),define("sources/flickr/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t){return t.data=(t.data.photosets.photoset||[]).map(e),t}}),define("sources/flickr/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/flickr/folders",["./parsers/folders","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={primary_photo_extras:"url_t,url_s,url_m,url_b,url_o",per_page:s.paging.size||n.foldersLimit,page:s.paging.cursor||null};return r.get(n.apiUrl+"/albums",o,{withCredentials:!0,headers:s.headers||{}}).then(e).catch(t)}return{list:i}}}),define("sources/flickr/mappers/item",["../../../utils/utils"],function(e){"use strict";function t(e){var t=e.url_m||e.url_s||e.url_t,n=e.url_b||t,r=e.url_o||n;return{fileUrl:r,thumbnailUrl:t,previewUrl:n}}return function(n){var r=t(n);return{id:n.id,name:n.title,folderId:null,mediaType:"picture",fileUrl:e.normalizeUri(r.fileUrl),thumbnailUrl:e.normalizeUri(r.thumbnailUrl),previewUrl:e.normalizeUri(r.previewUrl),createdAt:null,tags:[],width:Number(n.width_o||n.width_m||n.width_s||n.width_t),height:Number(n.height_o||n.height_m||n.height_s||n.height_t)}}}),define("sources/flickr/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){var n=t.data.photoset.page<t.data.photoset.pages?Number(t.data.photoset.page)+1:null,r=Number(t.data.photoset.perpage);return t.data=(t.data.photoset.photo||[]).map(e),t.paging={cursor:n,size:r},t}}),define("sources/flickr/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){s=s||{},s.paging=s.paging||{};var o={extras:"url_t,url_s,url_m,url_b,url_o",set_id:i,per_page:s.paging.size||n.itemsLimit,page:s.paging.cursor||null};return r.get(n.apiUrl+"/photoset",o,{withCredentials:!0,headers:s.headers||{}}).then(e).catch(t)}return{list:i}}}),define("sources/flickr/Flickr",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list"],function(e,t,n,r,i,s){"use strict";return function(){var o=r(),u=t(e,o),a=n(e,o);this.name="flickr",this.folders=i.addEvents(this,s.FOLDERS,u),this.items=i.addEvents(this,s.ITEMS,a)}}),define("sources/flickr-search/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/flickr",itemsLimit:50}}),define("sources/flickr-search/mappers/item",["../../../utils/utils"],function(e){"use strict";function t(e){var t=e.url_m||e.url_s||e.url_t,n=e.url_b||t,r=e.url_o||n;return{fileUrl:r,thumbnailUrl:t,previewUrl:n}}return function(n){var r=t(n);return{id:n.id,name:n.title,folderId:null,mediaType:"picture",fileUrl:e.normalizeUri(r.fileUrl),thumbnailUrl:e.normalizeUri(r.thumbnailUrl),previewUrl:e.normalizeUri(r.previewUrl),createdAt:null,tags:[],width:Number(n.width_o||n.width_m||n.width_s||n.width_t),height:Number(n.height_o||n.height_m||n.height_s||n.height_t)}}}),define("sources/flickr-search/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){var n=t.data.photos.page<t.data.photos.pages?t.data.photos.page+1:null,r=Number(t.data.photos.perpage);return t.data=(t.data.photos.photo||[]).map(e),t.paging={cursor:n,size:r},t}}),define("sources/flickr-search/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/flickr-search/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s,o){o=o||{},o.paging=o.paging||{};var u={extras:"url_t,url_s,url_m,url_b,url_o",text:s,per_page:o.paging.size||n.itemsLimit,page:o.paging.cursor||null};return r.get(n.apiUrl+"/search",u,{withCredentials:!1,headers:o.headers||{}}).then(e).catch(t)}return{search:i}}}),define("sources/flickr-search/FlickrSearch",["./settings","./items","../../utils/http","../decorators","../../events/list"],function(e,t,n,r,i){"use strict";return function(){var s=n(),o=t(e,s);this.name="flickrSearch",this.items=r.addEvents(this,i.ITEMS,o)}}),define("sources/google-search/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/gcs",itemsLimit:50}}),define("sources/google-search/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t){return{id:t.link,name:e.replaceHtml(t.title),folderId:null,mediaType:"picture",fileUrl:e.normalizeUri(t.link),thumbnailUrl:e.normalizeUri(t.image.thumbnailLink||t.link),previewUrl:e.normalizeUri(t.link),createdAt:null,tags:[],width:Number(t.image.width),height:Number(t.image.height)}}}),define("sources/google-search/parsers/items",["../mappers/item"],function(e){"use strict";return function(t){var n=null,r=null;return t.data.queries&&t.data.queries.nextPage&&t.data.queries.nextPage[0]&&(n=t.data.queries.nextPage[0].startIndex,r=t.data.queries.nextPage[0].count),t.data=(t.data.items||[]).map(e),t.paging={cursor:n>=92?null:n,size:r},t}}),define("sources/google-search/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/google-search/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s,o){o=o||{},o.paging=o.paging||{};var u={q:s,count:o.paging.size||n.itemsLimit,start:o.paging.cursor||null};return o.excludeQuery&&(u.filter=o.excludeQuery),r.get(n.apiUrl+"/images",u,{withCredentials:!1,headers:o.headers||{}}).then(e).catch(t)}return{search:i}}}),define("sources/google-search/GoogleSearch",["./settings","./items","../../utils/http","../decorators","../../events/list"],function(e,t,n,r,i){"use strict";return function(){var s=n(),o=t(e,s);this.name="googleSearch",this.items=r.addEvents(this,i.ITEMS,o)}}),define("sources/collection/settings",[],function(){"use strict";return{apiUrl:"//collections.wixstatic.com/collections",filesUrl:"//static.wixstatic.com",collectionId:"68c4b99f-d5b7-4583-b1d1-e00e31605678",imageOperationsApi:"vangogh",itemsLimit:50}}),define("sources/collection/mappers/folder",["../../../utils/utils","../../../sources/private/mappers/folder"],function(e,t){"use strict";return function(n,r){var i=e.extend({folder_id:n.id,folder_name:n.title,media_type:n.type,created_ts:n.date_created},n.public_properties),s=t(i);return n.public_properties.thumbnail_url&&!s.thumbnailUrl&&(s.thumbnailUrl=e.normalizeUri(r.filesUrl+"/"+n.public_properties.thumbnail_url)),s}}),define("sources/collection/parsers/selector",[],function(){"use strict";return function(e,t,n){return e.filter(function(e){return n?!e.public_properties.file_url&&(t?e.public_properties.parent_id===t:!e.public_properties.parent_id):e.public_properties.file_url&&(t?e.public_properties.folder_id===t:!e.public_properties.folder_id)})}}),define("sources/collection/parsers/folders",["../mappers/folder","./selector"],function(e,t){"use strict";return function(n,r,i,s){var o=t(n.data.collection.items,r,!0),u={cursor:i.cursor+i.size,size:o.length-i.cursor};return n.data=o.map(function(r){var i=e(r,s);return i.filesCount=i.filesCount||t(n.data.collection.items,i.id,!1).length,i}),u.size>0&&(n.paging=u),n}}),define("sources/collection/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/collection/folders",["./parsers/folders","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){return s=s||{},s.paging=s.paging||{},s.paging.cursor=s.paging.cursor||0,s.paging.size=s.paging.size||n.itemsLimit,r.get(n.apiUrl+"/"+n.collectionId+".json",{},{withCredentials:!1,headers:s.headers||{}}).then(function(t){return e(t,i,s.paging,n)}).catch(t)}return{list:i}}}),define("sources/collection/mappers/item",["../../../utils/mappers","../../../utils/utils","../../../sources/private/mappers/item"],function(e,t,n){"use strict";return function(e,r,i){var s=t.extend({file_name:e.id,original_file_name:e.title,media_type:e.type,created_ts:e.date_created},e.public_properties);return n(s,r,i)}}),define("sources/collection/parsers/items",["../mappers/item","./selector"],function(e,t){"use strict";return function(n,r,i,s,o){var u=t(n.data.collection.items,r,!1),a={cursor:i.cursor+i.size,size:u.length-i.cursor};return n.data=u.map(function(t){return e(t,s,o)}),a.size>0&&(n.paging=a),n}}),define("sources/collection/items",["./parsers/items","./parsers/error"],function(e,t){"use strict";return function(n,r){function i(i,s){return s=s||{},s.paging=s.paging||{},s.paging.cursor=s.paging.cursor||0,s.paging.size=s.paging.size||n.itemsLimit,r.get(n.apiUrl+"/"+n.collectionId+".json",{},{withCredentials:!1,headers:s.headers||{}}).then(function(t){return e(t,i,s.paging,n,s.thumbnails)}).catch(t)}return{list:i}}}),define("sources/collection/Collection",["./settings","./folders","./items","../../utils/http","../decorators","../../utils/utils","../../events/list"],function(e,t,n,r,i,s,o){"use strict";return function(u){var a=s.extend({},e,u),f=r(),l=t(a,f),c=n(a,f);this.name="collection",this.folders=i.addEvents(this,o.FOLDERS,l),this.items=i.addEvents(this,o.ITEMS,c)}}),define("sources/vimeo/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/vimeo2",itemsLimit:50,thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"}}}}),define("sources/vimeo/mappers/folder",[],function(){"use strict";return function(){return{id:"Vimeo",name:"Vimeo",mediaType:"video",parentId:null,filesCount:null,createdAt:null}}}),define("sources/vimeo/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(){return{data:[e()]}}}),define("sources/vimeo/folders",["./parsers/folders","bluebird_extended"],function(e,t){"use strict";return function(){function n(){return t.resolve(e())}return{list:n}}}),define("sources/vimeo/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t,n){function r(e){var t=e.match(/src="(.+?)"/i);return t?t[1]:""}function i(e){return Math.floor((new Date(e)).getTime()/1e3)}function s(e){return e===null||!e.length?[]:e.reduce(function(e,t){return t&&e.push(t.tag),e},[])}function o(e){return Number(e.match(/\/videos\/(\d+)/i)[1])}var u={id:o(n.uri),name:e.replaceHtml(n.name),description:e.replaceHtml(n.description),link:e.normalizeUri(n.link),iframeSrc:r(n.embed.html),embedHtml:n.embed.html,tags:s(n.tags),width:Number(n.width)||0,height:Number(n.height)||0,createdAt:i(n.created_time),folderId:null,mediaType:"video"};if(!n.pictures||!n.pictures.sizes)return u;var a=n.pictures.sizes.map(function(t){return e.extend({},t,{url:t.link})}),f=e.getThumbnailsUrlsFromList(a,t.thumbnailSizes);return e.extend(u,f)}}),define("sources/vimeo/parsers/items",["../mappers/item","../../../utils/utils"],function(e,t){"use strict";return function(n,r){var i=null,s=null;return r.data.paging&&r.data.paging.next&&(i=Number(r.data.paging.next.match(/\&page\=(\d+)/i)[1]),s=r.data.per_page),r.data=(r.data.data||[]).filter(function(e){return e&&e.embed&&e.embed.html}).map(t.partial(e,n)),r.paging={cursor:i,size:s},r}}),define("sources/vimeo/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/vimeo/items",["../../utils/utils","./parsers/items","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o){var u=o.thumbnailSizes?{thumbnailSizes:o.thumbnailSizes}:{},a=e.merge({},r,u);o=o||{},o.paging=o.paging||{};var f={per_page:o.paging.size||r.itemsLimit,page:o.paging.cursor||null};return i.get(r.apiUrl+"/videos",f,{withCredentials:!0,headers:o.headers||{}}).then(e.partial(t,a)).catch(n)}return{list:s}}}),define("sources/vimeo/Vimeo",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list","../../utils/utils"],function(e,t,n,r,i,s,o){"use strict";return function(u){var a=o.extend({},e,u),f=r(),l=t(a,f),c=n(a,f);this.name="vimeo",this.folders=i.addEvents(this,s.FOLDERS,l),this.items=i.addEvents(this,s.ITEMS,c)}}),define("sources/vimeo-search/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/vimeo2",itemsLimit:50,thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"}}}}),define("sources/vimeo-search/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t,n){function r(e){var t=e.match(/src="(.+?)"/i);return t?t[1]:""}function i(e){return e===null||!e.length?[]:e.reduce(function(e,t){return t&&e.push(t.tag),e},[])}function s(e){return Number(e.match(/\/videos\/(\d+)/i)[1])}var o={id:s(n.uri),name:e.replaceHtml(n.name),description:e.replaceHtml(n.description),link:e.normalizeUri(n.link),iframeSrc:r(n.embed.html),embedHtml:n.embed.html,tags:i(n.tags),width:Number(n.width)||0,height:Number(n.height)||0,createdAt:e.toTimeStamp(n.created_time),folderId:null,mediaType:"video"};if(!n.pictures||!n.pictures.sizes)return o;var u=n.pictures.sizes.map(function(t){return e.extend({},t,{url:t.link})}),a=e.getThumbnailsUrlsFromList(u,t.thumbnailSizes);return e.extend(o,a)}}),define("sources/vimeo-search/parsers/items",["../mappers/item","../../../utils/utils"],function(e,t){"use strict";return function(n,r){var i=null,s=null;return r.data.paging&&r.data.paging.next&&(i=Number(r.data.paging.next.match(/\&page\=(\d+)/i)[1]),s=r.data.per_page),r.data=(r.data.data||[]).filter(function(e){return e&&e.embed&&e.embed.html}).map(t.partial(e,n)),r.paging={cursor:i,size:s},r}}),define("sources/vimeo-search/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/vimeo-search/items",["../../utils/utils","./parsers/items","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o,u){var a=u.thumbnailSizes?{thumbnailSizes:u.thumbnailSizes}:{},f=e.merge({},r,a);u=u||{},u.paging=u.paging||{};var l={query:o,per_page:u.paging.size||r.itemsLimit,page:u.paging.cursor||null};return i.get(r.apiUrl+"/search",l,{withCredentials:!1,headers:u.headers||{}}).then(e.partial(t,f)).catch(n)}return{search:s}}}),define("sources/vimeo-search/VimeoSearch",["./settings","./items","../../utils/http","../decorators","../../events/list","../../utils/utils"],function(e,t,n,r,i,s){"use strict";return function(o){var u=n();o=s.extend({},e,o);var a=t(o,u);this.name="vimeoSearch",this.items=r.addEvents(this,i.ITEMS,a)}}),define("sources/youtube/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/youtube",foldersLimit:50,itemsLimit:50,thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"}}}}),define("sources/youtube/mappers/folder",["../../../utils/utils"],function(e){"use strict";return function(t,n){var r=t.snippet,i=Object.keys(r.thumbnails).map(function(e){return r.thumbnails[e]}),s=e.getThumbnailsUrlsFromList(i,n.thumbnailSizes);return e.extend({id:t.id,name:r.title,mediaType:"video",parentId:null,filesCount:null,createdAt:e.toTimeStamp(r.publishedAt)},s)}}),define("sources/youtube/parsers/folders",["../mappers/folder"],function(e){"use strict";return function(t,n){var r=null,i=null;return n.data&&n.data.nextPageToken&&(r=n.data.nextPageToken,i=n.data.pageInfo.resultsPerPage),n.data=(n.data.items||[]).map(function(n){return e(n,t)}),n.paging={cursor:r,size:i},n}}),define("sources/youtube/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return t.code===404&&t.data&&t.data.message==="Channel not found."?{data:[],status:t.code,error:t.data}:e.reject(t)}}),define("sources/youtube/folders",["../../utils/utils","./parsers/folders","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o){var u=o.thumbnailSizes?{thumbnailSizes:o.thumbnailSizes}:{},a=e.merge({},r,u);o=o||{},o.paging=o.paging||{};var f={maxResults:o.paging.size||r.foldersLimit,pageToken:o.paging.cursor||null};return i.get(r.apiUrl+"/myplaylists",f,{withCredentials:!0,headers:o.headers||{}}).then(e.partial(t,a)).catch(n)}return{list:s}}}),define("sources/youtube/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t,n){function s(e){return"//www.youtube.com/embed/"+e}var r=t.snippet,i=t.contentDetails.videoId,o=Object.keys(r.thumbnails).map(function(e){return r.thumbnails[e]}),u=e.getThumbnailsUrlsFromList(o,n.thumbnailSizes);return e.extend({},{id:i,name:e.replaceHtml(r.title),iframeSrc:s(i),folderId:null,mediaType:"video",createdAt:e.toTimeStamp(r.publishedAt)},u)}}),define("sources/youtube/parsers/items",["../mappers/item"],function(e){"use strict";return function(t,n){var r=null,i=null;return n.data&&n.data.nextPageToken&&(r=n.data.nextPageToken,i=n.data.pageInfo.resultsPerPage),n.data=(n.data.items||[]).filter(function(e){return e&&e.snippet&&e.snippet.thumbnails}).map(function(n){return e(n,t)}),n.paging={cursor:r,size:i},n}}),define("sources/youtube/items",["../../utils/utils","./parsers/items","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o){var u=o.thumbnailSizes?{thumbnailSizes:o.thumbnailSizes}:{},a=e.merge({},r,u);o=o||{},o.paging=o.paging||{};var f={playlistId:s,maxResults:o.paging.size||r.itemsLimit,pageToken:o.paging.cursor||null};return i.get(r.apiUrl+"/myplaylistitems",f,{withCredentials:!0,headers:o.headers||{}}).then(e.partial(t,a)).catch(n)}return{list:s}}}),define("sources/youtube/YouTube",["./settings","./folders","./items","../../utils/http","../decorators","../../events/list","../../utils/utils"],function(e,t,n,r,i,s,o){"use strict";return function(u){var a=o.extend({},e,u),f=r(),l=t(a,f),c=n(a,f);this.name="youtube",this.folders=i.addEvents(this,s.FOLDERS,l),this.items=i.addEvents(this,s.ITEMS,c)}}),define("sources/youtube-search/settings",[],function(){"use strict";return{apiUrl:"//pix.wix.com/services/youtube",itemsLimit:50,thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"}}}}),define("sources/youtube-search/mappers/item",["../../../utils/utils"],function(e){"use strict";return function(t,n){function s(e){return"//www.youtube.com/embed/"+e}var r=n.snippet,i=n.id.videoId,o=Object.keys(r.thumbnails).map(function(e){return r.thumbnails[e]}),u=e.getThumbnailsUrlsFromList(o,t.thumbnailSizes);return e.extend({},{id:i,name:e.replaceHtml(r.title),iframeSrc:s(i),folderId:null,mediaType:"video"},u)}}),define("sources/youtube-search/parsers/items",["../mappers/item","../../../utils/utils"],function(e,t){"use strict";return function(n,r){var i=null,s=null;return r.data&&r.data.nextPageToken&&(i=r.data.nextPageToken,s=r.data.pageInfo.resultsPerPage),r.data=(r.data.items||[]).map(t.partial(e,n)),r.paging={cursor:i,size:s},r}}),define("sources/youtube-search/parsers/error",["bluebird_extended"],function(e){"use strict";return function(t){return e.reject(t)}}),define("sources/youtube-search/items",["../../utils/utils","./parsers/items","./parsers/error"],function(e,t,n){"use strict";return function(r,i){function s(s,o,u){var a=u.thumbnailSizes?{thumbnailSizes:u.thumbnailSizes}:{},f=e.merge({},r,a);u=u||{},u.paging=u.paging||{};var l={f:"ext",q:o,maxResults:u.paging.size||r.itemsLimit,pageToken:u.paging.cursor||null};return i.get(r.apiUrl+"/search",l,{withCredentials:!1,headers:u.headers||{}}).then(e.partial(t,f)).catch(n)}return{search:s}}}),define("sources/youtube-search/YouTubeSearch",["./settings","./items","../../utils/http","../decorators","../../events/list","../../utils/utils"],function(e,t,n,r,i,s){"use strict";return function(o){var u=s.extend({},e,o),a=n(),f=t(u,a);this.name="youtubeSearch",this.items=r.addEvents(this,i.ITEMS,f)}}),define("sources/list",["./bigstock/BigStock","./shutterstock/ShutterStock","./public/Public","./private/Private","./picasa/Picasa","./drive/Drive","./dropbox/Dropbox","./instagram/Instagram","./instagram-video/InstagramVideo","./facebook/Facebook","./facebook-video/FacebookVideo","./flickr/Flickr","./flickr-search/FlickrSearch","./google-search/GoogleSearch","./collection/Collection","./vimeo/Vimeo","./vimeo-search/VimeoSearch","./youtube/YouTube","./youtube-search/YouTubeSearch"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){"use strict";var b={BIGSTOCK:e,SHUTTERSTOCK:t,PUBLIC:n,PRIVATE:r,PICASA:i,DRIVE:s,DROPBOX:o,INSTAGRAM:u,INSTAGRAM_VIDEO:a,FACEBOOK:f,FACEBOOK_VIDEO:l,FLICKR:c,FLICKR_SEARCH:h,GOOGLE_SEARCH:p,COLLECTION:d,VIMEO:v,VIMEO_SEARCH:m,YOUTUBE:g,YOUTUBE_SEARCH:y};return b}),define("events/events",["./notifier","./list","../utils/utils"],function(e,t,n){"use strict";function i(e,t){Object.defineProperty(r,e,{enumerable:!1,value:t})}var r=n.merge(t);return i("on",e.addListener),i("off",e.removeListener),r}),define("connector/connector-settings",[],function(){"use strict";return{PICASA:{connectUrl:"//pix.wix.com/services/google/connect",disconnectUrl:"//pix.wix.com/services/google/disconnect",parameterName:"goglact"},DRIVE:{connectUrl:"//pix.wix.com/services/gdrive/connect",disconnectUrl:"//pix.wix.com/services/gdrive/disconnect",parameterName:"gdrvact"},DROPBOX:{connectUrl:"//pix.wix.com/services/dropbox/connect",disconnectUrl:"//pix.wix.com/services/dropbox/disconnect",parameterName:"dbact"},INSTAGRAM:{connectUrl:"//pix.wix.com/services/instagram/connect",disconnectUrl:"//pix.wix.com/services/instagram/disconnect",parameterName:"instact"},INSTAGRAM_VIDEO:{connectUrl:"//pix.wix.com/services/instagram/connect",disconnectUrl:"//pix.wix.com/services/instagram/disconnect",parameterName:"instact"},FACEBOOK:{connectUrl:"//pix.wix.com/services/facebook/connect",disconnectUrl:"//pix.wix.com/services/facebook/disconnect",parameterName:"fbact"},FACEBOOK_VIDEO:{connectUrl:"//pix.wix.com/services/facebook/connect",disconnectUrl:"//pix.wix.com/services/facebook/disconnect",parameterName:"fbact"},FLICKR:{connectUrl:"//pix.wix.com/services/flickr/connect",disconnectUrl:"//pix.wix.com/services/flickr/disconnect",parameterName:"flact"},YOUTUBE:{connectUrl:"//pix.wix.com/services/youtube/connect",disconnectUrl:"//pix.wix.com/services/youtube/disconnect",parameterName:"ytact"},VIMEO:{connectUrl:"//pix.wix.com/services/vimeo/connect",disconnectUrl:"//pix.wix.com/services/vimeo/disconnect",parameterName:"vmact"}}}),define("connector/connector",["bluebird_extended","./connector-settings","../utils/http","../utils/utils","../utils/mappers"],function(e,t,n,r,i){"use strict";return function(s,o){function f(){return u.parameterName}function l(){return Boolean(localStorage.getItem(u.parameterName))}function c(){return localStorage.removeItem(u.parameterName),a.get(u.disconnectUrl,null,{withCredentials:!0})}function h(){var t;return window.open(u.connectUrl+"?return_url="+o.redirectUrl,"connector","width=950,height=550"),t=new e(function(e,t){window.connectService=function(n){var s,o;s=r.getParameterByName(n,f()),o=r.getParameterByName(n,"status"),s&&(!o||o!=="FAIL")?e(s):t(i.toError({code:401,message:"Not Authorized"}))}}),t.then(function(e){localStorage.setItem(u.parameterName,e)},function(e){return e}),t}var u=t[s],a=n();if(typeof u!="object")throw new Error("Invalid source");return{isConnected:l,disconnect:c,connect:h}}}),define("services/bi/event-ids",[],function(){"use strict";return{severity:{info:10,warning:20,error:30,fatal:40},BIEventsIds:{responseTime:"110",uploadSpeed:"142",uploadQueueStarted:"303",uploadQueueFinished:"304"},BIAdaptersIds:{"private":"01","public":"02",facebook:"03",flickr:"04",instagram:"05",picasa:"06",flickrSearch:"07",googleSearch:"08",bigStock:"09",collection:"10",drive:"11",dropbox:"12",facebookVideo:"13",instagramVideo:"14",vimeo:"15",vimeoSearch:"16",youtube:"17",youtubeSearch:"18"},BIAdaptersRequestsIds:{"folders.list":"01","folders.remove":"02","folders.trash.list":"03","folders.trash.restore":"04","folders.trash.remove":"05","folder.create":"06","folder.update":"07","items.list":"11","items.remove":"12","items.search":"13","items.searchByTag":"14","items.trash.list":"15","items.trash.restore":"16","items.trash.remove":"17","item.get":"18","item.update":"19","item.upload":"20","item.uploadByUrl":"21","trash.remove":"22","trash.restore":"23"}}}),define("services/bi/send-request",["../../utils/utils"],function(e){"use strict";function t(){return/\.wixpress\.com/i.test(document.location.host)||/local\./i.test(document.location.host)?"//frog.wixpress.com":"//frog.wix.com"}return function(n,r){var i=document.createElement("img");i.setAttribute("src",t()+n+"?"+e.encodeParams(r)),i=null}}),define("services/bi/benchmarks",["./event-ids","./send-request"],function(e,t){"use strict";function n(){return(new Date).getTime()}function r(r,i,s){var o=r.name+"("+i+")",u=n()-s.startedAt;t("/mg",{evid:e.BIEventsIds.responseTime,call_name:o||"",result:s.isSuccess?"success":"fail",response_speed:Math.floor((s.responseSize||0)/(u/1e3)),response_time:u||0,response_size:s.responseSize})}function i(e,t){var i=n();e.then(function(e){r(t.eventTarget,t.eventName,{startedAt:i,responseSize:e.responseSize,isSuccess:!0})}).catch(function(e){r(t.eventTarget,t.eventName,{startedAt:i,responseSize:e.responseSize,isSuccess:!1})})}function s(r,i){var s=n(),o=i.arguments[0].file.size;if(o<10240)return;r.then(function(){var r=(n()-s)/1e3;if(r<1)return;t("/mg",{evid:e.BIEventsIds.uploadSpeed,time_seconds:Math.floor(r),size_bytes:o,bytes_per_second:Math.floor(o/r)})}).catch(function(e){console.warn(e)})}return{response:i,upload:s}}),define("services/bi/errors",["./event-ids","./send-request"],function(e,t){"use strict";var n={"default":0,"private":1,"public":2,bigstock:4,drive:5,dropbox:6,facebook:7,flickr:8,instagram:9,picasa:10};return function(r,i,s,o){var u=s.code||"000",a=e.BIAdaptersIds[r]||"00",f=e.BIAdaptersRequestsIds[i]||"00",l=r+" "+i+": "+s.message,c=a+f+u,h=r+"."+i+"."+u;return t("/trg",{src:25,evid:10,cat:n[r]||n.default,iss:1,sev:e.severity.error,errc:c||"0000000",errn:h||"",ver:o.version||"VERSION",did:o.siteId||"",p1:u||"000",ts:o.requestTimeMs||"",dsc:l||""})}}),define("services/upload/file-to-upload",["bluebird_extended"],function(e){"use strict";function t(t){return t.then?t:e.resolve(t)}function n(t){return t.status==="waiting"||t.status==="uploading"&&e.prototype.cancellable}function r(e){e.deferred.promise.catch(function(t){e.status="failed",e.error=t}),e.deferred.promise.abort()}function i(e,n){e.status="uploading",e.uploadPromise=t(n.uploadFn(e.source)).progress(function(t){e.deferred.promise.notify(t)}).then(function(t){e.deferred.resolve(t)}).catch(function(t){e.status="failed",e.error=t,e.deferred.reject(t)}),e.uploadPromise.notify({status:e.status,total:e.getFileSize(),loaded:0})}function s(){return e.defer()}function o(t){return{source:t.source,status:"waiting",bytesLoaded:0,deferred:s(),isAborted:!1,error:{},upload:function(){return this.isAborted||i(this,t),this.deferred.promise},abort:function(){if(!n(this))return;this.isAborted=!0;if(this.status==="waiting"){r(this);return}this.uploadPromise.abort()},canRetry:function(){if(this.error instanceof e.CancellationError)return!0;var t=[-201,401,403,408];return this.status==="failed"&&t.indexOf(this.error.code)!==-1},signUpForRetry:function(){this.status="waiting",this.isAborted=!1,this.error={},this.deferred=s()},canAbort:function(){return n(this)},getFileSize:function(){return this.source.file?this.source.file.size:1}}}return o}),define("services/upload/upload-collection",["bluebird_extended","../../utils/utils","./file-to-upload"],function(e,t,n){"use strict";function l(e){return function(t){return t.name===e}}function c(e,t){typeof e=="string"&&(e=[e]),e.forEach(function(e){if(!(a.indexOf(e)>=0))throw new Error("This event "+e+" is not supported by multiple file uploader");f.push({name:e,fn:t})})}function h(e,t){typeof e=="string"&&(e=[e]);for(var n=f.length-1;n>=0;n-=1){var r=f[n];e.forEach(function(e){r.name===e&&(!t||r.fn===t)&&f.splice(n,1)})}}function p(e,t){var n=[].slice;t=arguments.length>=2?n.call(arguments,1):[],f.filter(l(e)).forEach(function(n){n.fn.apply({event:e},t)})}function d(){return i.some(function(e){return e.status==="waiting"})}function v(){return i.filter(function(e){return e.status==="waiting"})}function m(){return i.some(function(e){return e.canRetry()})}function g(){return i.filter(function(e){return["uploading","processing"].indexOf(e.status)>=0}).length}function y(){return i.some(function(e){return["uploading","processing"].indexOf(e.status)>=0})}function b(){!d()&&!y()&&u.resolve();var e=r-g();if(e<=0)return u.promise;var t=v().slice(0,e);return t.forEach(function(e){e.upload().then(function(e){return b(),e}).catch(function(e){b(),console.warn(e)})}),u.promise}function w(){return i.reduce(function(e,t){return e+t.getFileSize()},0)}function E(e,t){switch(t.status){case"uploading":if(t.loaded<=e.getFileSize())return t.loaded;return e.getFileSize();case"succeeded":case"processing":return e.getFileSize();case"failed":return 0;default:return 0}}function S(e){return function(t){["failed","succeeded"].indexOf(e.status)===-1?e.status=t.status:t.status=e.status;var n=e.getFileSize();e.bytesLoaded=t.loaded>=n?n:t.loaded,t.file=e,p("fileStatusChanged",{bytesTotalUploaded:o+E(e,t),bytesTotal:w(),currentFileProgress:t,currentFileQueueIdx:i.indexOf(e),queue:i})}}function x(){if(s){b();return}u=e.defer(),s=!0,p("uploadQueueStarted",i),b().then(function(){s=!1,p("uploadQueueFinished",i)}).catch(function(e){console.warn(e)})}function T(e){var t=S(e),n=e.getFileSize();e.deferred.promise.progress(t).then(function(r){e.serverResponse=r,t({status:"succeeded",total:n,loaded:n}),o+=n}).catch(function(r){e.serverResponse=r,t({status:"failed",total:n,loaded:0})})}function N(e){var t=e.signUpForRetry;e.signUpForRetry=function(){t.apply(this,arguments),T(e),x()}}function C(){if(s)throw new Error("Upload queue can not be cleared while upload is running");i.length=0,o=0}function k(e){e=e||[],!s&&!m()&&C();var t=e.map(n).map(function(e){return T(e),N(e),i.push(e),e});return p("queueChanged",i),x(),t}var r=1,i=[],s=!1,o=0,u,a=["queueChanged","fileStatusChanged","uploadQueueStarted","uploadQueueFinished"],f=[];return{on:c,off:h,upload:k,clearQueue:C,set maxParallelUploads(e){r=Number(e)||1},get maxParallelUploads(){return r},get uploadQueue(){return i},get uploadIsInProgress(){return s},get currentUploadedTotal(){return o}}}),define("services/bi/upload-queue",["./event-ids","./send-request","../../utils/utils"],function(e,t){"use strict";function r(){var e="";while(e.length<32)e+=Math.floor(Math.random()*1e16);return[e.slice(0,8),e.slice(8,12),e.slice(12,16),e.slice(16,20),e.slice(20,32)].join("-")}function i(){n=r(),t("/mg",{evid:e.BIEventsIds.uploadQueueStarted,upload_queue_id:n})}function s(r){t("/mg",{evid:e.BIEventsIds.uploadQueueFinished,upload_queue_id:n,files_count:r.length})}var n="";return{start:i,finish:s}}),define("services/bi/bi",["../../events/notifier","../../events/list","./benchmarks","./errors","../upload/upload-collection","./upload-queue","../../utils/utils"],function(e,t,n,r,i,s,o){"use strict";return function(u,a){function f(){return(new Date).getTime()}var l=function(e,t){Array.isArray(e)&&(e=Promise.all(e)),n.response(e,t);var i=function(){},s=f(),u=function(e){var n=o.extend({requestTimeMs:f()-s},a);r(t.eventTarget.name,t.eventName,e,n)};return e.then(i,u)};Object.keys(t).forEach(function(n){Object.keys(t[n]).forEach(function(r){u===!0?e.addListener(t[n][r],l):e.removeListener(t[n][r],l)})}),u===!0?e.addListener(t.ITEM.UPLOAD,n.upload):e.removeListener(t.ITEM.UPLOAD,n.upload),u===!0&&(i.on("uploadQueueStarted",s.start),i.on("uploadQueueFinished",s.finish))}}),define("services/thumbnail-generator/thumbnail-generator",["./resize","./get-wix-thumbnails-urls","./get-wix-video-preview-urls"],function(e,t,n){"use strict";return{resize:e,getWixThumbnailsUrls:t,getWixVideoPreviewUrls:n,APIS:{REMBRANDT:"rembrandt",VANBRANDT:"vanbrandt",VANGOGH:"vangogh"},MODES:{FILL:"fill",FIT:"fit"}}}),define("wixmp",["./sources/Source","./sources/list","./events/events","./connector/connector","./services/bi/bi","./services/upload/upload-collection","./services/thumbnail-generator/thumbnail-generator"],function(e,t,n,r,i,s,o){"use strict";return{Source:e,sources:t,events:n,thumbnailGenerator:o,bi:i,connectExternalSource:r,Uploader:s}});